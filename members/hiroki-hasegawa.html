<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon shortcut" type="image/png" href="https://blog.3-shake.com/logo.png"/><title>é•·è°·å· åºƒæ¨¹ | 3-shake Engineers&#x27; Blogs</title><meta property="og:title" content="é•·è°·å· åºƒæ¨¹"/><meta property="og:url" content="https://blog.3-shake.com/members/hiroki-hasegawa"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:site" content="3-shake Engineers&#x27; Blogs"/><meta property="og:image" content="https://blog.3-shake.com/og.png"/><link rel="canonical" href="https://blog.3-shake.com/members/hiroki-hasegawa"/><meta name="next-head-count" content="10"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/ca0df06cc4f85fc8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ca0df06cc4f85fc8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-b671ab60a2eabb59.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aef75d70891be704.js" defer=""></script><script src="/_next/static/chunks/983-1a3a8624e5fc5412.js" defer=""></script><script src="/_next/static/chunks/pages/members/%5Bid%5D-fa4563d96c58aa0a.js" defer=""></script><script src="/_next/static/3JhdoGcpT3YqpAgsKOghX/_buildManifest.js" defer=""></script><script src="/_next/static/3JhdoGcpT3YqpAgsKOghX/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap">@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlvAA.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTVOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTUGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTVOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTUGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTVOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTUGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v40/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v32/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><header class="site-header"><div class="content-wrapper"><div class="site-header__inner"><a class="site-header__logo-link" href="/"><img src="/logo.svg" alt="3-shake Engineers&#x27; Blogs" class="site-header__logo-img"/><span class="site-header__logo-text">3-shake<br/>Engineers&#x27; Blogs</span></a><div class="site-header__links"><a class="site-header__link" href="/feed.xml">RSS</a><a href="https://jobs-3-shake.com/" class="site-header__link">Recruit</a><a href="https://3-shake.com/" class="site-header__link">Company</a></div></div></div></header><section class="member"><div class="content-wrapper"><header class="member-header"><div class="member-header__avatar"><img src="/avatars/hirokihasegawa.png" alt="é•·è°·å· åºƒæ¨¹" width="100" height="100" class="member-header__avatar-img"/></div><h1 class="member-header__name">é•·è°·å· åºƒæ¨¹</h1><p class="member-header__bio">é¡”ç”»åƒã¯è‘—ä½œæ¨©ãƒ•ãƒªãƒ¼ã§ã™ã®ã§ã©ã†ã</p><div class="member-header__links"><a href="https://twitter.com/Hiroki__IT" class="member-header__link"><img src="/icons/twitter.svg" alt="Twitterã®ãƒ¦ãƒ¼ã‚¶ãƒ¼@Hiroki__IT" width="22" height="22"/></a><a href="https://github.com/hiroki-it" class="member-header__link"><img src="/icons/github.svg" alt="GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼@hiroki-it" width="22" height="22"/></a><a href="https://hiroki-it.github.io/tech-notebook/" class="member-header__link"><img src="/icons/link.svg" alt="ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ãƒªãƒ³ã‚¯" width="22" height="22"/></a></div></header><div class="member-posts-container"><div class="post-list"><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2024-07-01T03:00:00.000Z" class="post-link__date">2 months ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2024/07/01/120000" class="post-link__main-link"><h2 class="post-link__title">ã€Kubernetesâ˜¸ï¸ã€‘&quot;Findy é–‹ç™ºç”Ÿç”£æ€§ Conference&quot; ã«ç™»å£‡</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2024-06-28T04:00:00.000Z" class="post-link__date">2 months ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/marutipurodakutonozu-zhi-demaikurosabisuakitekutiyawozhi-erucicdpuratutohuomushe-ji" class="post-link__main-link"><h2 class="post-link__title">â™¾ï¸ ãƒãƒ«ãƒãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çµ„ç¹”ã§ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ”¯ãˆã‚‹CICDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2024-01-15T16:34:04.000Z" class="post-link__date">8 months ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2024/01/16/013404" class="post-link__main-link"><h2 class="post-link__title">ã€Istioâ›µï¸ã€‘Istioã«ã‚ˆã£ã¦æŠ½è±¡åŒ–ã•ã‚Œã‚‹Envoyã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®ä»•çµ„ã¿</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-12-21T05:00:00.000Z" class="post-link__date">9 months ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/kubernetesnomarutitenantopatantoargocdnoshi-jian-tenantoshe-ji" class="post-link__main-link"><h2 class="post-link__title">ğŸ™ Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã®å®Ÿè·µãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-12-21T03:00:00.000Z" class="post-link__date">9 months ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/12/21/833414" class="post-link__main-link"><h2 class="post-link__title">ã€ArgoCDğŸ™ã€‘&quot;Kubernetes Novice Tokyo&quot; ã«ç™»å£‡</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-10-25T03:00:00.000Z" class="post-link__date">a year ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/10/25/550144" class="post-link__main-link"><h2 class="post-link__title">ã€TerraformğŸ§‘ğŸ»â€ğŸš€ã€‘&quot;Findy Terraform æ´»ç”¨å¤§å…¨ - IaCã®ä»Š&quot; ã«ç™»å£‡</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-10-24T04:00:00.000Z" class="post-link__date">a year ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/tfstate-nofen-ge-hatantoteirekutorigou-cheng-henoshi-yong" class="post-link__main-link"><h2 class="post-link__title">ğŸ§‘â€ğŸš€ tfstate ã®åˆ†å‰²ãƒã‚šã‚¿ãƒ¼ãƒ³ã¨ãƒ†ã‚™ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-08-18T02:06:46.000Z" class="post-link__date">a year ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/08/18/110646" class="post-link__main-link"><h2 class="post-link__title">ã€ArgoCDğŸ™ï¸ã€‘Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã®å®Ÿè·µãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-07-04T15:17:56.000Z" class="post-link__date">a year ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/07/05/001756" class="post-link__main-link"><h2 class="post-link__title">ã€TerraformğŸ§‘ğŸ»â€ğŸš€ã€‘tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-05-02T05:42:57.000Z" class="post-link__date">a year ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/05/02/145115" class="post-link__main-link"><h2 class="post-link__title">ã€ArgoCDğŸ™ã€‘ArgoCDã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä»•çµ„ã¿</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-02-26T11:25:48.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/02/26/202548" class="post-link__main-link"><h2 class="post-link__title">ã€Istioâ›µï¸ã€‘Istioã‚’å®‰å…¨ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã‚«ãƒŠãƒªã‚¢æ–¹å¼ã¨ãã®ä»•çµ„ã¿</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2023-01-14T13:38:15.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2023/01/14/223815" class="post-link__main-link"><h2 class="post-link__title">ã€Istioâ›µï¸ã€‘ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ç™»å ´çµŒç·¯ã¨Istioã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2022-12-24T21:00:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2022/12/25/060000" class="post-link__main-link"><h2 class="post-link__title">ã€Istioâ›µï¸ã€‘Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2022-12-15T05:00:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/istioniyorusahisuteisukaharinoshi-zu-mi" class="post-link__main-link"><h2 class="post-link__title">â›µï¸ Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2022-12-15T03:00:00.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://hiroki-hasegawa.hatenablog.jp/entry/2022/12/15/025523" class="post-link__main-link"><h2 class="post-link__title">ã€Istioâ›µï¸ã€‘&quot;3-shake SRE Tech Talk&quot; ã«ç™»å£‡</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=hiroki-hasegawa.hatenablog.jp" width="14" height="14" class="post-link__site-favicon"/>hiroki-hasegawa.hatenablog.jp</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2021-10-22T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/ke-guan-ce-xing-niru-men-siyou" class="post-link__main-link"><h2 class="post-link__title">ğŸ” å¯è¦³æ¸¬æ€§ã«å…¥é–€ã—ã‚ˆã†</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2021-08-06T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/domeinqu-dong-she-ji-toyi-cun-xing-ni-zhuan-falseyuan-ze" class="post-link__main-link"><h2 class="post-link__title">ğŸ—ï¸ ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã¨ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2021-06-25T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/yi-cun-guan-xi-toyi-cun-obuziekutozhu-ru" class="post-link__main-link"><h2 class="post-link__title">ğŸ¤ğŸ» ä¾å­˜é–¢ä¿‚ã¨ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2021-05-27T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/goniru-men-siyou" class="post-link__main-link"><h2 class="post-link__title">ğŸ­ Goã«å…¥é–€ã—ã‚ˆã†</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2021-05-07T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/sreniru-men-siyou" class="post-link__main-link"><h2 class="post-link__title">â™¾ï¸ SREã«å…¥é–€ã—ã‚ˆã†</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/hiroki-hasegawa"><img src="/avatars/hirokihasegawa.png" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">é•·è°·å· åºƒæ¨¹</div><time dateTime="2021-03-26T04:00:00.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://speakerdeck.com/hiroki_hasegawa/lambdaguan-shu-wogodeshi-zhuang-sitemitahua" class="post-link__main-link"><h2 class="post-link__title">ğŸ­ Lambdaé–¢æ•°ã‚’Goã§å®Ÿè£…ã—ã¦ã¿ãŸè©±</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=speakerdeck.com" width="14" height="14" class="post-link__site-favicon"/>speakerdeck.com</div></a></article></div></div></div></section><footer class="site-footer"><div class="content-wrapper"><p>Â© <!-- -->3-shake Inc.</p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"member":{"id":"hiroki-hasegawa","name":"é•·è°·å· åºƒæ¨¹","role":"ãªã‚“ã‚‰ã‹ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢","bio":"é¡”ç”»åƒã¯è‘—ä½œæ¨©ãƒ•ãƒªãƒ¼ã§ã™ã®ã§ã©ã†ã","avatarSrc":"/avatars/hirokihasegawa.png","sources":["https://hiroki-hasegawa.hatenablog.jp/feed","https://speakerdeck.com/hiroki_hasegawa.rss"],"includeUrlRegex":"","twitterUsername":"Hiroki__IT","githubUsername":"hiroki-it","websiteUrl":"https://hiroki-it.github.io/tech-notebook/"},"postItems":[{"title":"ã€Kubernetesâ˜¸ï¸ã€‘\"Findy é–‹ç™ºç”Ÿç”£æ€§ Conference\" ã«ç™»å£‡","contentSnippet":"ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆå°å…¥ã®ãŸã‚ã«ã€æ¨ªæ–­çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã‚ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã§ã€ãƒãƒ«ãƒãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ç”Ÿç”£æ€§ã‚’æ”¯ãˆã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã§ã€å„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®ç”Ÿç”£æ€§ã‚’æ”¯ãˆã‚‹ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã‚¤ãƒ™ãƒ³ãƒˆåç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆè¬è¾ã‚¤ãƒ™ãƒ³ãƒˆåã‚ªãƒƒã‚¹ï¼ã‚ªãƒ©é•·è°·å·ï¼âœ‹ğŸ»ã€ãƒãƒ«ãƒãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çµ„ç¹”ã§ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ”¯ãˆã‚‹CICDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆã€ã¦ã„ã†ãƒ†ãƒ¼ãƒã§ã€ Findy é–‹ç™ºç”Ÿç”£æ€§ Conference ã«ç™»å£‡ã—ãŸãï¼ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã¿ã‚“ãªï¼ã‚¹ãƒ©ã‚¤ãƒ‰ãœã£ã¦ã‡è¦‹ã¦ãã‚Œã‚ˆãªï¼ã€Findyé–‹ç™ºç”Ÿç”£æ€§Conferenceã€ã®ç™ºè¡¨è³‡æ–™ã§ã™âœŠğŸ»ã‚ªãƒ©ãŸã¡ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°äº‹ä¾‹ã‚’ç´¹ä»‹ã—ã¦ã£ã‹ã‚‰ã€ãœã£ã¦ã‡è¦‹ã¦ãã‚Œã‚ˆãªï¼âœ‹ğŸ»#é–‹ç™ºç”Ÿç”£æ€§con_findyhttps://t.co/DjqztPn9z4â€” é•·è°·å· åºƒæ¨¹ (åœ°ä¸‹å¼·åˆ¶åŠ´åƒè€…) (@Hiroki__IT) June 28, 2024 ã¡ãªã€ç™ºè¡¨å†…å®¹ã¯ã“ã®è¨˜äº‹ã«ã‚‚é–¢é€£ã—ã¦ã‚‹ãœï¼ã‚¤ãƒ™ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆ@shinri_koda ã•ã‚“ãŒæ›¸ã„ã¦ãã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚‚ãœã£ã¦ã‡è¦‹ã¦ãã‚Œã‚ˆãªï¼âœŠğŸ»(ãƒ¯ãƒ¼ãƒ‰ã‚»ãƒ³ã‚¹ãŒã‚ã‚Šéãã¦ã€å€‹äººãƒ–ãƒ­ã‚°å§‹ã‚ãŸã‚‰äººæ°—ã«ãªã‚Šãã†)ã‚»ãƒ³ã‚¹ã‚ã‚‹é¢ç™½ã„ä¸€æ–‡ğŸ˜‚ã“ã‚Œã¯ã€ä»Šã™ãã«æ—¥è¨˜ãƒ–ãƒ­ã‚°ã‚’å§‹ã‚ã‚‹ã¹ã https://t.co/9SVo516apI pic.twitter.com/MApAcqxWoQâ€” é•·è°·å· åºƒæ¨¹ (åœ°ä¸‹å¼·åˆ¶åŠ´åƒè€…) (@Hiroki__IT) July 6, 2024 è¬è¾æ„Ÿè¬ã™ã‚‹ãœï¼ã‚¤ãƒ™ãƒ³ãƒˆã§å‡ºä¼šãˆãŸå…¨ã¦ã®æ–¹ã€…ã«ï¼ï¼ï¼ğŸ«¶ğŸ»æ ªå¼ä¼šç¤¾ã‚¹ãƒªãƒ¼ã‚·ã‚§ã‚¤ã‚¯ã®ãƒ–ãƒ¼ã‚¹ã«ãŠé‚ªé­”ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸğŸ™Œ#3shake_inc pic.twitter.com/W7ufgaKfbSâ€” ã™ã¦ã«ã‚ƒã‚“ (@stefafafan) June 29, 2024","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2024/07/01/120000","isoDate":"2024-07-01T03:00:00.000Z","dateMiliSeconds":1719802800000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"â™¾ï¸ ãƒãƒ«ãƒãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çµ„ç¹”ã§ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ”¯ãˆã‚‹CICDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆ","contentSnippet":"\"Findyé–‹ç™ºç”Ÿç”£æ€§Conference\" ã®ç™ºè¡¨è³‡æ–™ã§ã™âœŠğŸ»\r\rç”Ÿç”£æ€§ã‚’æ”¯ãˆã‚‹ãŸã‚ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°äº‹ä¾‹ã¨ã—ã¦ã€ä»¥ä¸‹ã®ï¼“ã¤ã®å–ã‚Šçµ„ã¿ã‚’ç´¹ä»‹ã—ã¾ã—ãŸï¼\r\rãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆå°å…¥ã®ãŸã‚ã«ã€æ¨ªæ–­çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã‚ã‚‹\rãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã§ã€ãƒãƒ«ãƒãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ç”Ÿç”£æ€§ã‚’æ”¯ãˆã‚‹\rãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã§ã€å„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®ç”Ÿç”£æ€§ã‚’æ”¯ãˆã‚‹\r\rğŸ¦ ãƒ„ã‚¤ãƒ¼ãƒˆï¼šhttps://x.com/Hiroki__IT/status/1806559579180011572\r\râœğŸ» ç¤¾å†…ãƒ¬ãƒãƒ¼ãƒˆï¼šhttps://note.3-shake.com/n/n8efac1be167d","link":"https://speakerdeck.com/hiroki_hasegawa/marutipurodakutonozu-zhi-demaikurosabisuakitekutiyawozhi-erucicdpuratutohuomushe-ji","isoDate":"2024-06-28T04:00:00.000Z","dateMiliSeconds":1719547200000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€Istioâ›µï¸ã€‘Istioã«ã‚ˆã£ã¦æŠ½è±¡åŒ–ã•ã‚Œã‚‹Envoyã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®ä»•çµ„ã¿","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Istioã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ã‚’é¡Œæã«ã—ãŸEnvoyã®è¨­å®šã®æŠ½è±¡åŒ–ã«ã¤ã„ã¦æ§˜ã€…ãªã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ« (ç‰¹ã«ã€Istioã€Consulã€Ciliumãªã©) ã§ã‚‚æµç”¨ã§ãã‚‹Envoyã®çŸ¥è­˜ã«ã¤ã„ã¦ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. æ§˜ã€…ãªãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã‚‹Envoyè¨­å®šã®æŠ½è±¡åŒ–ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPS03. istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹HTTPSå‡¦ç†Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã®ä»•çµ„ã¿ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPS04. Envoyã«ã‚ˆã‚‹HTTPSå‡¦ç†Envoyã®è¨­å®šã®ç¨®é¡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ä¸€è¦§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã®ä»•çµ„ã¿05. ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‹ã‚‰Envoyè¨­å®šã¸ã®ç¿»è¨³å„ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®é–¢ä¿‚ä¸€è¦§ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSEnvoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®å¯¾å¿œé–¢ä¿‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã‚‹ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSEnvoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®å¯¾å¿œé–¢ä¿‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPSEnvoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®å¯¾å¿œé–¢ä¿‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã‚‹06. ç¿»è¨³ã•ã‚ŒãŸEnvoyè¨­å®šå€¤ã‚’è¦‹ã¦ã¿ã‚‹Envoyã®ç¾åœ¨ã®è¨­å®šã‚’å‡ºåŠ›ã™ã‚‹ãƒªã‚¹ãƒŠãƒ¼ã‚’å‡ºåŠ›ã™ã‚‹ãƒ«ãƒ¼ãƒˆã‚’å‡ºåŠ›ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å‡ºåŠ›ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‡ºåŠ›ã™ã‚‹è¨¼æ˜æ›¸ã‚’å‡ºåŠ›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSé€ä¿¡å…ƒPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠå®›å…ˆPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSé€ä¿¡å…ƒPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠå®›å…ˆPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPSé€ä¿¡å…ƒPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠå®›å…ˆPod (Istio EgressGateway Pod) å´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠ07. ãŠã‚ã‚Šã«è¬è¾è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«ã©ã†ã‚‚ã€ä¿º (REMIX) feat. Istioãƒ‹ã‚­ a.k.a. ã„ã™ã¦ãƒç”·ã§ã™ã€‚Istioã¯ã€Envoyã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã‚’å®Ÿè£…ã—ã¾ã™ã€‚IstioãŒKubernetesãƒªã‚½ãƒ¼ã‚¹ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«åŸºã¥ã„ã¦Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¦ãã‚Œã‚‹ãŸã‚ã€é–‹ç™ºè€…ã¯Envoyã‚’ã‚ˆã‚Šç°¡å˜ã«è¨­å®šã§ãã¾ã™ã€‚Envoyã®è¨­å®šã®æŠ½è±¡åŒ–ã¯ã€Envoyã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ (ä¾‹ï¼šIstioã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥/ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆãƒ¡ãƒƒã‚·ãƒ¥ã€Consulã€Istioã‹ã‚‰å¾—ã‚‰ã‚ŒãŸå­¦ã³ã‚’åœŸå°ã«ç™»å ´ã—ãŸCiliumã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ•ãƒªãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ãªã©) ã«å…±é€šã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€æ¬¡ã€…ã«ç™»å ´ã™ã‚‹Envoyã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ«ã«æŒ¯ã‚Šå›ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯ã€ãƒ„ãƒ¼ãƒ«ãŒã©ã®ã‚ˆã†ã«Envoyã‚’æŠ½è±¡åŒ–ã™ã‚‹ã®ã‹ã‚’ç†è§£ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§ä»Šå›ã¯ã€Istioã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ãŒEnvoyã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã‚’ã©ã®ã‚ˆã†ã«æŠ½è±¡åŒ–ã™ã‚‹ã®ã‹ã‚’è§£èª¬ã—ã¾ã™ã€‚ã¾ãŸã€æŠ½è±¡åŒ–ã•ã‚ŒãŸEnvoyãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ä»•çµ„ã¿ã‚‚ä¸€ç·’ã«è§£èª¬ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®çŸ¥è­˜ã¯ã€æ§˜ã€…ãªã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ«ã§æµç”¨ã§ãã‚‹ã¯ãšã§ã™ã€‚ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. æ§˜ã€…ãªãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã‚‹Envoyè¨­å®šã®æŠ½è±¡åŒ–ã¾ãšã¯ã€ã©ã®ã‚ˆã†ãªãƒªã‚½ãƒ¼ã‚¹ãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã«é–¢ä¿‚ã—ã¦ã„ã‚‹ã®ã‹ã‚’ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ–¹å‘ã«åˆ†ã‘ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚„Envoyã«ã¤ã„ã¦ã¯ã€æ¬¡ç« ä»¥é™ã§è§£èª¬ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰å†…ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã€ãƒªã‚½ãƒ¼ã‚¹ãŒä»¥ä¸‹ã®é †ã§ç´ä»˜ãã€Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚flowchart TD    é€ä¿¡å…ƒ -.-\u003e|HTTPS| Gateway    Gateway([â›µï¸ Gateway]) -.-\u003e VirtualService    VirtualService([â›µï¸ VirtualService]) -.-\u003e DestinationRule    DestinationRule([â›µï¸ DestinationRule]) -.-\u003e Service    Service([â˜¸ï¸ Service]) -.-\u003e Endpoints    Endpoints([â˜¸ï¸ Endpoints]) -.-\u003e|HTTPS| å®›å…ˆ    classDef sly fill: #CCFFFF, stroke: black;    class é€ä¿¡å…ƒ sly    classDef yellow fill: #FFFF88, stroke: black;    class å®›å…ˆ yellow    classDef blue fill: #326CE5, color: white, stroke: black;    class Gateway,VirtualService,DestinationRule,Service,Endpoints blueå„ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¯ã€Istio IngressGateway Podã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¤–ã‹ã‚‰Istio IngressGateway Podã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«ã€Service (ä¾‹ï¼šNodePort Service) ãŒå¿…è¦ã§ã™ã€‚Istio IngressGateway Podã¯ã€å®›å…ˆPodã¨ã®é–“ã§ç›¸äº’TLSèªè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚Istio IngressGateway Podã¯ã€Kubernetesãƒªã‚½ãƒ¼ã‚¹ (Serviceã€Endpoints) ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ (VirtualServiceã€DestinationRule) ã«å¿œã˜ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆPodã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚Istio Ingress vs. Kubernetes Ingress â€“ Daniel Watrous on Software and Cloud Engineeringãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å†…ã®Podã‹ã‚‰åˆ¥ã®Podã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã€ãƒªã‚½ãƒ¼ã‚¹ãŒä»¥ä¸‹ã®é †ã§ç´ä»˜ãã€Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚flowchart TD    é€ä¿¡å…ƒ -.-\u003e|HTTPS| VirtualService    VirtualService([â›µï¸ VirtualService]) -.-\u003e DestinationRule    DestinationRule([â›µï¸ DestinationRule]) -.-\u003e Service    Service([â˜¸ï¸ Service]) -.-\u003e Endpoints    Endpoints([â˜¸ï¸ Endpoints]) -.-\u003e|HTTPS| å®›å…ˆ    classDef sly fill: #CCFFFF, stroke: black;    class é€ä¿¡å…ƒ sly    classDef yellow fill: #FFFF88, stroke: black;    class å®›å…ˆ yellow    classDef blue fill: #326CE5, color: white, stroke: black;    class VirtualService,DestinationRule,Service,Endpoints blueå„ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodã¯ã€å®›å…ˆPodã¨ã®é–“ã§ç›¸äº’TLSèªè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodã¯ã€Kubernetesãƒªã‚½ãƒ¼ã‚¹ (Serviceã€Endpoints) ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ (VirtualServiceã€DestinationRule) ã®è¨­å®šã«å¿œã˜ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆPodã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚Istioæµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ-èµµåŒ–å†°çš„åšå®¢ | Zhaohuabing Blogã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å†…ã®Podã‹ã‚‰å¤–ã®ã‚·ã‚¹ãƒ†ãƒ  (ä¾‹ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼å§”è­²å…ˆã®å¤–éƒ¨API) ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã€ãƒªã‚½ãƒ¼ã‚¹ãŒä»¥ä¸‹ã®é †ã§ç´ä»˜ãã€Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚è¤‡æ•°ã®VirtualServiceã¨DestinationãŒç™»å ´ã™ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã«ã¯ä¾¿å®œä¸Š X ã¨ Y ã‚’ã¤ã‘ã¦ã„ã¾ã™ã€‚flowchart TD    é€ä¿¡å…ƒ -.-\u003e|HTTPS| VirtualServiceX    VirtualServiceX([â›µï¸ VirtualService X]) -.-\u003e DestinationRuleX    DestinationRuleX([â›µï¸ DestinationRule X]) -.-\u003e Service    Service([â˜¸ï¸ Service]) -.-\u003e Endpoints    Endpoints([â˜¸ï¸ Endpoints]) -.-\u003e Gateway    Gateway([â›µï¸ Gateway]) -.-\u003e VirtualServiceY    VirtualServiceY([â›µï¸ VirtualService Y]) -.-\u003e DestinationRuleY    DestinationRuleY([â›µï¸ DestinationRule Y]) -.-\u003e ServiceEntry    ServiceEntry([â›µï¸ ServiceEntry]) -.-\u003e|HTTPS| å®›å…ˆ    classDef sly fill: #CCFFFF, stroke: black;    class é€ä¿¡å…ƒ sly    classDef yellow fill: #FFFF88, stroke: black;    class å®›å…ˆ yellow    classDef blue fill: #326CE5, color: white, stroke: black;    class Gateway,VirtualServiceX,VirtualServiceY,DestinationRuleX,DestinationRuleY,Service,Endpoints,ServiceEntry blueå„ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãŒServiceEntryã§ã‚¨ãƒ³ãƒˆãƒªæ¸ˆã¿ã‹å¦ã‹ã®è¨­å®šã«å¿œã˜ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚å®›å…ˆãŒã‚¨ãƒ³ãƒˆãƒªæ¸ˆã¿ã§ã‚ã‚Œã°ã€é€ä¿¡å…ƒPodã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã«Istio EgressGateway Podã‚’é¸æŠã—ã¾ã™ã€‚å®›å…ˆãŒæœªã‚¨ãƒ³ãƒˆãƒªã§ã‚ã‚Œã°ã€é€ä¿¡å…ƒPodã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã«å¤–ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’é¸æŠã—ã¾ã™ã€‚é€ä¿¡å…ƒPodã¯ã€Istio EgressGateway Podã¨ã®é–“ã§ç›¸äº’TLSèªè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚(1) ã§å®›å…ˆãŒã‚¨ãƒ³ãƒˆãƒªæ¸ˆã§ã‚ã£ãŸã¨ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‘ãå…ˆã‚’Istio EgressGateway Podã«å¤‰æ›´ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodã¯ã€Kubernetesãƒªã‚½ãƒ¼ã‚¹ (Serviceã€Endpoints) ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ (VirtualServiceã€DestinationRule) ã®è¨­å®šã«å¿œã˜ã¦ã€Istio EgressGateway Podã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚Istio EgressGateway Podã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¨ãƒ³ãƒˆãƒªæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚Using Istio to MITM our usersâ€™ traffic | Steven ReitsmaIngress, egress, ServiceEntry DATA Flow issues for ISTIO API Gateway? - Discuss Istioâ–¶ï¸ Istio EgressGatewayã®å¿…è¦æ€§ã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’çµŒç”±ã›ãšã«å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã«ç›´æ¥HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã„ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ãŒä½ããªã‚Šã¾ã™ã€‚ä»–ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®ç‰¹å®šã®é€šä¿¡ã‚’è­˜åˆ¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚Istio / Accessing External ServicesIstioldie 1.10 / Egress Gateway Performance Investigation03. istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹HTTPSå‡¦ç†å‰ç« ã§ã¯ã€Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã£ã¦æŠ½è±¡åŒ–ã•ã‚ŒãŸEnvoyã¾ã§è¨€åŠã—ã¾ã›ã‚“ã§ã—ãŸã€‚æœ¬ç« ã§ã¯ã€è§£èª¬ã‚’ã‚‚ã†å°‘ã—å…·ä½“åŒ–ã—ã¾ã™ã€‚Istioã¯ã€Envoyãƒ—ãƒ­ã‚»ã‚¹ã‚’æŒã¤istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ç”¨ã—ã¦ã©ã®ã‚ˆã†ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã¦ã„ã‚‹ã®ã‹ã‚’ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ–¹å‘ã«åˆ†ã‘ã¦è§£èª¬ã—ã¾ã™ã€‚Envoyã®è¨­å®šã«ã¤ã„ã¦ã¯ã€æ¬¡ç« ä»¥é™ã§è§£èª¬ã—ã¾ã™ã€‚Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã®ä»•çµ„ã¿Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹è²¬å‹™ã‚’æ‹…ã†ã®ã¯ã€Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ (discoveryã‚³ãƒ³ãƒ†ãƒŠ) ã§ã™ã€‚Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯ç•°ãªã‚‹è²¬å‹™ã‚’æ‹…ã†è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼å      è²¬å‹™    Config ingestionãƒ¬ã‚¤ãƒ¤ãƒ¼            kube-apiserverã‹ã‚‰Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’å–å¾—ã—ã¾ã™ã€‚Istioã®åˆæœŸã‹ã‚‰åå‰ã¯å¤‰ã‚ã£ã¦ã„ã¾ã›ã‚“ã€‚          Config translationãƒ¬ã‚¤ãƒ¤ãƒ¼                   ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’Envoyè¨­å®šã«å¤‰æ›ã—ã¾ã™ã€‚Istioã®åˆæœŸã§ã¯Config Data Modelãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã„ã†åå‰ã§ã€åŸ·ç­†æ™‚ç‚¹ (2024/01/16) ã§åå‰ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚          Config servingãƒ¬ã‚¤ãƒ¤ãƒ¼            Envoyã®è¨­å®šã‚„è¨¼æ˜æ›¸ã‚’Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«é…å¸ƒã—ã¾ã™ã€‚Istioã®åˆæœŸã§ã¯ã€Proxy Servingãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã„ã†åå‰ã§ã€åŸ·ç­†æ™‚ç‚¹ (2024/01/16) ã§åå‰ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚          å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚Config ingestionãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¦ã€ Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯kube-apiserverã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã“ã§ã€Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’å–å¾—ã—ã¾ã™ã€‚Config translationãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¦ã€å–å¾—ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’Envoyã®è¨­å®šã«å¤‰æ›ã—ã¾ã™ã€‚Config servingãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¦ã€Envoyã®è¨­å®šã‚„è¨¼æ˜æ›¸ã‚’Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«é…å¸ƒã—ã¾ã™ã€‚åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°RPCã®ãŸã‚ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒConfig servingãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ã“ã‚Œã‚‰ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚istio/architecture/networking/pilot.md at 1.20.2 Â· istio/istio Â· GitHubä¸€æ–‡å¸¦ä½ å½»åº•å˜æ¸… Isito ä¸­çš„è¯ä¹¦å·¥ä½œæœºåˆ¶-èµµåŒ–å†°çš„åšå®¢ | Zhaohuabing Blogâ–¶ï¸ Config servingãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹XDS-APIã«ã¤ã„ã¦â–¶ï¸ Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã¤ã„ã¦istio/architecture/networking/pilot.md at 1.20.2 Â· istio/istio Â· GitHubã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰å†…ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚å„ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯ã€ç¿»è¨³ã•ã‚ŒãŸEnvoyã®è¨­å®šã‚’Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«æä¾›ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¯ã€Istio IngressGateway Podã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¤–ã‹ã‚‰Istio IngressGateway Podã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«ã€Service (ä¾‹ï¼šNodePort Service) ãŒå¿…è¦ã§ã™ã€‚Istio IngressGateway Podå†…ã®iptablesã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«é€ä¿¡ã—ã¾ã™ (ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¯ä¸è¦)ã€‚Istio IngressGateway Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€å®›å…ˆPodã‚’æ±ºå®šã—ã€ã¾ãŸã“ã®Podã«å¯¾ã—ã¦ç›¸äº’TLSèªè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚Istio IngressGateway Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆPodã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚å®›å…ˆPodå†…ã®iptablesã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚å®›å…ˆPodå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡ã—ã¾ã™ã€‚Istio Ingress vs. Kubernetes Ingress â€“ Daniel Watrous on Software and Cloud Engineeringâ–¶ï¸ Podå†…ã®iptablesã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’çµŒç”±ã™ã‚‹ã‚ˆã†ã«ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚iptablesã®ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹ã®ã¯istio-initã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚Istioã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¨åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€istio-initã‚³ãƒ³ãƒ†ãƒŠã‚’Podã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã—ã¾ã™ (Istio IngressGatewayã¨Istio EgressGatewayã®Podã¯é™¤ãã¾ã™)ã€‚ç”»åƒå¼•ç”¨å…ƒï¼šSoByteistio-initã‚³ãƒ³ãƒ†ãƒŠã¯ã€istio-iptablesã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€iptablesã®ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚ã¾ãŸã€istio-initã‚³ãƒ³ãƒ†ãƒŠã¯ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ›ãˆãŸå¾Œã«çµ‚äº†ã™ã‚‹ãŸã‚ã€Podã®èµ·å‹•å¾Œã«Podå†…ã«æ®‹ã‚Šã¾ã›ã‚“ğŸ‘ğŸ»$ istio-iptables \\    -p 15001 \\    -z 15006 \\    -u 1337 \\    -m REDIRECT \\    -i * \\    -x \\    -b * \\    -d 15090,15020Sidecar injection, transparent traffic hijacking, and routing process in Istio explained in detail | by Jimmy Song | MediumIstio / pilot-agentâ–¶ï¸ Istio IngressGateway Podå†…ã®iptablesã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€Istioã¯iptablesã®ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹istio-initã‚³ãƒ³ãƒ†ãƒŠã‚’Istio IngressGateway Podã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã—ã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€Istio IngressGateway Podå†…ã®iptablesã®ãƒ«ãƒ¼ãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã«ãªã£ã¦ã„ã¾ã™ğŸ‘ğŸ»ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å†…ã®Podã‹ã‚‰åˆ¥ã®Podã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚å„ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯ã€ç¿»è¨³ã•ã‚ŒãŸEnvoyã®è¨­å®šã‚’Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«æä¾›ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå†…ã®iptablesã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€å®›å…ˆPodã‚’æ±ºå®šã—ã€ã¾ãŸã“ã®Podã«å¯¾ã—ã¦ç›¸äº’TLSèªè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆPodã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚å®›å…ˆPodå†…ã®iptablesã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚å®›å…ˆPodå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡ã—ã¾ã™ã€‚Istioæµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ-èµµåŒ–å†°çš„åšå®¢ | Zhaohuabing Blogã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å†…ã®Podã‹ã‚‰å¤–ã®ã‚·ã‚¹ãƒ†ãƒ  (ä¾‹ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼å§”è­²å…ˆã®å¤–éƒ¨API) ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚å„ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯ã€ç¿»è¨³ã•ã‚ŒãŸEnvoyã®è¨­å®šã‚’Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«æä¾›ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå†…ã®iptablesã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€å®›å…ˆPodã‚’æ±ºå®šã—ã€ã¾ãŸã“ã®Podã«å¯¾ã—ã¦ç›¸äº’TLSèªè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ã“ã®æ™‚ã€ServiceEntryã§å®›å…ˆãŒã‚¨ãƒ³ãƒˆãƒªæ¸ˆã¿ã‹å¦ã‹ã«å¿œã˜ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚å®›å…ˆãŒã‚¨ãƒ³ãƒˆãƒªæ¸ˆã¿ã§ã‚ã‚Œã°ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã«Istio EgressGateway Podã‚’é¸æŠã—ã¾ã™ã€‚å®›å…ˆãŒæœªã‚¨ãƒ³ãƒˆãƒªã§ã‚ã‚Œã°ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã«å¤–ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’é¸æŠã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€å®›å…ˆãŒã‚¨ãƒ³ãƒˆãƒªæ¸ˆã§ã‚ã£ãŸã¨ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’Istio EgressGateway Podã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚Istio EgressGateway Podå†…ã®iptablesã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«é€ä¿¡ã—ã¾ã™ (ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¯ä¸è¦)ã€‚Istio EgressGateway Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¨ãƒ³ãƒˆãƒªæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚â–¶ï¸ Istio EgressGateway Podå†…ã®iptablesã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€Istioã¯iptablesã®ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹istio-initã‚³ãƒ³ãƒ†ãƒŠã‚’Istio EgressGateway Podã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã—ã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€Istio EgressGateway Podå†…ã®iptablesã®ãƒ«ãƒ¼ãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã«ãªã£ã¦ã„ã¾ã™ğŸ‘ğŸ»Using Istio to MITM our usersâ€™ traffic | Steven ReitsmaIngress, egress, ServiceEntry DATA Flow issues for ISTIO API Gateway? - Discuss Istio04. Envoyã«ã‚ˆã‚‹HTTPSå‡¦ç†å‰ç« ã§ã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã®è¨­å®šã¾ã§ã€è¨€åŠã—ã¾ã›ã‚“ã§ã—ãŸã€‚æœ¬ç« ã§ã¯ã€ã‚‚ã£ã¨å…·ä½“åŒ–ã—ã¾ã™ã€‚EnvoyãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚Envoyã®è¨­å®šã®ç¨®é¡HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã€Envoyã®è¨­å®šãŒä»¥ä¸‹ã®é †ã§ç´ä»˜ãã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡å…ƒã‹ã‚‰å®›å…ˆã¾ã§å±Šã‘ã¾ã™ã€‚flowchart TD    é€ä¿¡å…ƒ -.-\u003e|HTTPS| ãƒªã‚¹ãƒŠãƒ¼    ãƒªã‚¹ãƒŠãƒ¼(ãƒªã‚¹ãƒŠãƒ¼) -.-\u003e ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼    subgraph  \"\"      ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼(ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼) -.-\u003e ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼      ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼) -.-\u003e HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼    end    HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼(HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼) -.-\u003e ãƒ«ãƒ¼ãƒˆ    ãƒ«ãƒ¼ãƒˆ(ãƒ«ãƒ¼ãƒˆ) -.-\u003e ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼    ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼(ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼) -.-\u003e ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ(ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ) -.-\u003e|HTTPS| å®›å…ˆclassDef sly fill: #CCFFFF, stroke: black;class é€ä¿¡å…ƒ slyclassDef yellow fill: #FFFF88, stroke: black;class å®›å…ˆ yellowclassDef red fill: #EA6B66, font-weight :bold, stroke: black;class ãƒªã‚¹ãƒŠãƒ¼,ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼,ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼,HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼,ãƒ«ãƒ¼ãƒˆ,ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼,ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ redå„å‡¦ç†ãŒã©ã®ã‚ˆã†ãªè²¬å‹™ã‚’æ‹…ã£ã¦ã„ã‚‹ã®ã‹ã‚’ã‚‚ã†å°‘ã—è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€EnvoyãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚é€ä¿¡å…ƒã‹ã‚‰ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚é€šä¿¡ã®ç¨®é¡ (ä¾‹ï¼šHTTPã€HTTPSã€TCPã€UDPã€Unixãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆãªã©) ã«å¿œã˜ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã€å„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‡¦ç†ã—ã¾ã™ã€‚ã‚‚ã—HTTPSã§ã‚ã‚Œã°ã€é€ä¿¡å…ƒã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆã‚„ãƒ‘ã‚¹ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚è¨­å®šã—ãŸè² è·åˆ†æ•£æ–¹å¼ (ä¾‹ï¼šãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ãªã©) ã«å¿œã˜ã¦ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é…ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é¸ã³ã¾ã™ã€‚å®›å…ˆã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ã€‚ãã—ã¦ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚Life of a Request â€” envoy 1.32.0-dev-c8f58b documentationâ–¶ TCPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«ã¤ã„ã¦flowchart TD    é€ä¿¡å…ƒ -.-\u003e|TCP| ãƒªã‚¹ãƒŠãƒ¼    ãƒªã‚¹ãƒŠãƒ¼(ãƒªã‚¹ãƒŠãƒ¼) -.-\u003e ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼    subgraph  \"\"      ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼(ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼) -.-\u003e ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼    end    ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼) -.-\u003e ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼    ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼(ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼) -.-\u003e ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ(ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ) -.-\u003e|TCP| å®›å…ˆclassDef sly fill: #CCFFFF, stroke: black;class é€ä¿¡å…ƒ slyclassDef yellow fill: #FFFF88, stroke: black;class å®›å…ˆ yellowclassDef red fill: #EA6B66, font-weight :bold, stroke: black;class ãƒªã‚¹ãƒŠãƒ¼,ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼,ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼,ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼,ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ redDebugging Your Debugging Tools: What to do When Your Service Mesh Goes Down | PPTãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ä¸€è¦§Envoyã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ã€Envoyã®æ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹ãŸã‚ã®è¨­å®šã§ã™ã€‚HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ã¯ã€ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ã¨ã„ã£ãŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚å…¨ã¦ã¯è§£èª¬ã—ãã‚Œãªã„ãŸã‚ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®ä»£è¡¨çš„ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã„ãã¤ã‹æŠœç²‹ã—ã¾ã—ãŸã€‚ãŸã ã€ Istioã¯ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã«ã—ã¦ãã‚Œã¦ã„ã‚‹ ãŸã‚ã€é–‹ç™ºè€…ãŒEnvoyã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¨­å®šã™ã‚‹å ´é¢ã¯å°‘ãªã„ã§ã™ã€‚é€†ã‚’ã„ãˆã°ã€Istioã‚’ä»‹ã•ãšã«Envoyã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹å ´åˆã€é–‹ç™ºè€…ãŒEnvoyã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è‡ªå‰ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ğŸ‘ğŸ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ç¨®é¡      HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã«å¿…è¦ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼(ä¸€éƒ¨æŠœç²‹)      èª¬æ˜    ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼      Original Destination      istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‰ã®å®›å…ˆæƒ…å ±ã‚’EnvoyãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚Podå†…ã®iptablesãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã¨ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãŒistio-proxyã‚³ãƒ³ãƒ†ãƒŠã«å¤‰ã‚ã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãŸã ã—ã€iptablesã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‰ã®å®›å…ˆã‚’ã‚«ãƒ¼ãƒãƒ«ä¸Šã®SO_ORIGINAL_DSTã¨ã„ã†å®šæ•°ã«æ ¼ç´ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚Envoyã¯ã€ã‚«ãƒ¼ãƒãƒ«ä¸Šã®SO_ORIGINAL_DSTã‹ã‚‰æœ¬æ¥ã®å®›å…ˆã‚’å–å¾—ã—ã€ãƒ—ãƒ­ã‚­ã‚·ã—ã¾ã™ã€‚    HTTP Inspector      EnvoyãŒHTTPã‚’æ¤œçŸ¥ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚    TLS Inspector      EnvoyãŒTLSã‚’æ¤œçŸ¥ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚TLSã‚’æ¤œçŸ¥ã—ãŸå ´åˆã€Envoyã¯TLSã«é–¢ã™ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ä¾‹ãˆã°ã€DownstreamTlsContextã¯ã€ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç›´å¾Œã«ã€é€ä¿¡å…ƒã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚ã¾ãŸã€UpstreamTlsContextã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å‡¦ç†æ™‚ã«ã€å®›å…ˆã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ã€‚    ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼      HTTP connection manager      EnvoyãŒã€L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€ã¾ãŸå¾Œç¶šã®HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚    HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼      Router      EnvoyãŒãƒãƒ¼ãƒˆç•ªå·ã§ãƒ«ãƒ¼ãƒˆã€ãƒ›ã‚¹ãƒˆã‚„ãƒ‘ã‚¹ã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚    gRPC-Web      EnvoyãŒHTTP/1.1ã§å—ä¿¡ã—ãŸHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’HTTP/2ã«å¤‰æ›ã—ã€gRPCã‚µãƒ¼ãƒãƒ¼ã«ãƒ—ãƒ­ã‚­ã‚·ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚    Filters â€” envoy 1.32.0-dev-c091ca documentationâ–¶ï¸ IstioãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã«ã™ã‚‹Envoyã®è¨­å®šã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«ã€ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠã„ãŸEnvoyã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ„ã¿è¾¼ã¿ã¾ã™ã€‚ãã®ãŸã‚ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã¯ã€å¤šãã®è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã«ã§ãã¾ã™ã€‚Istioã‚’åˆ©ç”¨ã™ã‚‹é–‹ç™ºè€…ãŒã€EnvoyãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æœ‰åŠ¹ã«ã—ãªãã¦ã‚ˆã„ã®ã‚‚ã€Istioã®ãŠã‹ã’ã§ã™ã€‚Istioã»ã‚“ã¾ã«ã‚ã‚ŠãŒã¨ãªğŸ™ğŸ™ğŸ™  istio/pilot/docker/Dockerfile.proxyv2 at 1.20.2 Â· istio/istio Â· GitHubistio/tools/packaging/common/envoy_bootstrap.json at 1.20.2 Â· istio/istio Â· GitHubãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã®ä»•çµ„ã¿Envoyã¯ã€è¤‡æ•°ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‹ã‚‰ãªã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã‚’å®Ÿè¡Œã—ã€HTTPSã‚’å‡¦ç†ã—ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€Envoyã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚å„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®æ©Ÿèƒ½ã¯ã€å‰è¿°ã—ãŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ä¸€è¦§ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ğŸ™‡ğŸ»ãƒªã‚¹ãƒŠãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (Original Destinationã€HTTP Inspectorã€TLS Inspectorãªã©) ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚(1) ã§TLS InspectorãŒTLSã‚’æ¤œçŸ¥ã—ãŸå ´åˆã€DownstreamTlsContextã§å®›å…ˆã¨TLSãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’å®Ÿè¡Œã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (HTTP connection managerãªã©) ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (Routerã€gRPC-Webãªã©) ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚Life of a Request â€” envoy 1.32.0-dev-c8f58b documentationâ–¶ TCPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«ã¤ã„ã¦TCP proxy â€” envoy 1.32.0-dev-c091ca documentation05. ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‹ã‚‰Envoyè¨­å®šã¸ã®ç¿»è¨³ã„ã‚ˆã„ã‚ˆã§ã™ğŸ”¥IstioãŒå„ãƒªã‚½ãƒ¼ã‚¹ã‚’ã„ãšã‚Œã®Envoyã®è¨­å®šã«ç¿»è¨³ã—ã¦ã„ã‚‹ã®ã‹ã‚’è§£èª¬ã—ã¾ã™ã€‚è¡¨ã§å¯¾å¿œé–¢ä¿‚ã®ä¸€è¦§ã‚’ç¤ºã—ãŸå¾Œã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã¾ã—ãŸã€‚å„ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®é–¢ä¿‚ä¸€è¦§Istioã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã¯ã€Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚„Istioã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’Envoyã®è¨­å®šã«ç¿»è¨³ã—ã€å‡¦ç†ã®æµã‚Œã«å½“ã¦ã¯ã‚ã¾ã™ã€‚ä»¥ä¸‹ã®é€šã‚Šã€å„ãƒªã‚½ãƒ¼ã‚¹ãŒã„ãšã‚Œã®Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ã®ã‹ã‚’æ•´ç†ã—ã¾ã—ãŸã€‚ãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã£ã¦ã¯ã€Envoyã®è¤‡æ•°ã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚ãªãŠã€Istioã®ç”¨æ„ã—ãŸEnvoyã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å¤‰æ›´ã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒå°‘ãªã„ãŸã‚ã€ã“ã‚Œã‚’æŠ½è±¡åŒ–ã™ã‚‹EnvoyFilterã«ã¤ã„ã¦ã¯è¨€åŠã—ã¾ã›ã‚“ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹      Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹    Envoyã®è¨­å®š      Service      Endpoints      Gateway      VirtualService      DestinationRule      ServiceEntry      PeerAuthentication    ãƒªã‚¹ãƒŠãƒ¼      âœ…            âœ…      âœ…                  âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…                  âœ…                      ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                        âœ…      âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…                  âœ…      âœ…          Debugging Your Debugging Tools: What to do When Your Service Mesh Goes Down | PPT- YouTubeã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSEnvoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«é–¢ä¿‚ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’æŠœç²‹ã—ã¾ã—ãŸã€‚Gatewayã¯ã€Istio IngressGatewayã®ä¸€éƒ¨ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚ServiceEntryã¯ã€ä½¿ç”¨ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã®ãŸã‚ã€Ã—ã¨ã—ã¦ã„ã¾ã™ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹      Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹    Envoyã®è¨­å®š      Service      Endpoints      Gateway      VirtualService      DestinationRule      ServiceEntry      PeerAuthentication    ãƒªã‚¹ãƒŠãƒ¼      âœ…            âœ…      âœ…            Ã—      âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…                  âœ…            Ã—          ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                        âœ…      Ã—      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…                  âœ…      Ã—          ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®å¯¾å¿œé–¢ä¿‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã«åˆ†ã‘ã‚‹ã¨ã€å„ãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚è©±ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«ã€é€ä¿¡å…ƒã¨å®›å…ˆã¯åŒã˜Namespaceã«ã‚ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚é€ä¿¡å…ƒEnvoyã§HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã‚’æ±ºã‚ã‚‹è¨­å®šã€ã¾ãŸã¯å®›å…ˆEnvoyã§HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹è¨­å®šã‚’ã€åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒæŠ½è±¡åŒ–ã—ã¾ã™ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹       Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹     Envoyã®è¨­å®š      Service      Endpoints      Gateway      VirtualService      DestinationRule      PeerAuthentication    é€ä¿¡å…ƒ      ãƒªã‚¹ãƒŠãƒ¼      âœ…            âœ…      âœ…            âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…                  âœ…                ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                        âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…                  âœ…          å®›å…ˆ      ãƒªã‚¹ãƒŠãƒ¼      âœ…                  âœ…            âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…                  âœ…                ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                        âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…                  âœ…          â–¶ï¸ é€ä¿¡å…ƒã¨å®›å…ˆã®Namespaceã«ã¤ã„ã¦istio-ingress) ã«ãŠã„ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ç•°ãªã‚‹Namespaceã«Istio IngressGatewayã‚’ç½®ãã“ã¨ã§ã€Istio IngressGatewayã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã‚„ã™ããªã£ãŸã‚Šã€ä»–ã‹ã‚‰éšœå®³ã®å½±éŸ¿ã‚’å—ã‘ã«ãããªã‚Šã¾ã™ğŸ™†ğŸ»â€â™‚ï¸istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã‚‹ã“ã®è¡¨ã‚’ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä»•çµ„ã¿ã®ä¸­ã«å½“ã¦ã¯ã‚ã‚‹ã¨ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚å¼•ç”¨ã—ãŸå‰è¿°ã®è§£èª¬ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ´ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã§ã»ã¨ã‚“ã©åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒç™»å ´ã—ã¾ã™ãŒã€ Gatewayã¯é€ä¿¡å…ƒEnvoyã ã‘ã§ç™»å ´ã—ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã ã‘ã«ç€ç›®ã™ã‚‹ã¨ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚GatewayãŒé€ä¿¡å…ƒEnvoyã ã‘ã§ç™»å ´ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã—ãŸã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSEnvoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å†…ã®Podã‹ã‚‰åˆ¥ã®Podã¸ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«é–¢ä¿‚ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’æŠœç²‹ã—ã¾ã—ãŸã€‚Gatewayã¨ServiceEntryã¯ã€ä½¿ç”¨ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã®ãŸã‚ã€Ã—ã¨ã—ã¦ã„ã¾ã™ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹      Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹    Envoyã®è¨­å®š      Service      Endpoints      Gateway      VirtualService      DestinationRule      ServiceEntry      PeerAuthentication    ãƒªã‚¹ãƒŠãƒ¼      âœ…            Ã—      âœ…            Ã—      âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…            Ã—      âœ…            Ã—          ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…            Ã—            âœ…      Ã—      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…      Ã—            âœ…      Ã—          ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®å¯¾å¿œé–¢ä¿‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã«åˆ†ã‘ã‚‹ã¨ã€å„ãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚è©±ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«ã€é€ä¿¡å…ƒã¨å®›å…ˆã¯åŒã˜Namespaceã«ã‚ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚é€ä¿¡å…ƒEnvoyã§HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã‚’æ±ºã‚ã‚‹è¨­å®šã€ã¾ãŸã¯å®›å…ˆEnvoyã§HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹è¨­å®šã‚’ã€åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒæŠ½è±¡åŒ–ã—ã¾ã™ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹       Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹     Envoyã®è¨­å®š      Service      Endpoints      VirtualService      DestinationRule      PeerAuthentication    é€ä¿¡å…ƒ      ãƒªã‚¹ãƒŠãƒ¼      âœ…            âœ…            âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…            âœ…                ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                  âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…            âœ…          å®›å…ˆ      ãƒªã‚¹ãƒŠãƒ¼      âœ…            âœ…            âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…            âœ…                ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                  âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…            âœ…          istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã‚‹ã“ã®è¡¨ã‚’ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä»•çµ„ã¿ã®ä¸­ã«å½“ã¦ã¯ã‚ã‚‹ã¨ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚å¼•ç”¨ã—ãŸå‰è¿°ã®è§£èª¬ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ´ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã§ã€åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒç™»å ´ã—ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã ã‘ã«ç€ç›®ã™ã‚‹ã¨ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã§åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒç™»å ´ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã—ãŸã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPSEnvoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å†…ã®Podã‹ã‚‰å¤–ã®ã‚·ã‚¹ãƒ†ãƒ  (ä¾‹ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼å§”è­²å…ˆã®å¤–éƒ¨API) ã¸ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«é–¢ä¿‚ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’æŠœç²‹ã—ã¾ã—ãŸã€‚Gatewayã¯ã€Istio EgressGatewayã®ä¸€éƒ¨ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹      Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹    Envoyã®è¨­å®š      Service      Endpoints      Gateway      VirtualService      DestinationRule      ServiceEntry      PeerAuthentication    ãƒªã‚¹ãƒŠãƒ¼      âœ…            âœ…      âœ…                  âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…                  âœ…                      ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                        âœ…      âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…                  âœ…      âœ…          ãƒªã‚½ãƒ¼ã‚¹ã¨Envoyã®è¨­å®šã®å¯¾å¿œé–¢ä¿‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã«åˆ†ã‘ã‚‹ã¨ã€å„ãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«Envoyã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚è©±ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«ã€é€ä¿¡å…ƒã¨å®›å…ˆã¯åŒã˜Namespaceã«ã‚ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚ä»–ã®å ´åˆã¨ã¯ç•°ãªã‚Šã€é€ä¿¡å…ƒEnvoyã§HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆã‚’æ±ºã‚ã‚‹è¨­å®šã€ã¾ãŸã¯å®›å…ˆEnvoyã§HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹è¨­å®šã‚’ã€ç•°ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹ãŒæŠ½è±¡åŒ–ã—ã¾ã™ã€‚PeerAuthenticationã ã‘ã¯ã€è©±ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«é€ä¿¡å…ƒã¨å®›å…ˆãŒåŒã˜Namespaceã§ã‚ã‚‹ã¨ä»®å®šã—ã¦ã„ã‚‹ã®ã§ã€åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒæŠ½è±¡åŒ–ã—ã¾ã™ã€‚é€ä¿¡å…ƒEnvoyã®è¨­å®šã®æŠ½è±¡åŒ–ã§ç™»å ´ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ãŒå®›å…ˆã§ã¯ç™»å ´ã›ãšã€é€†ã‚‚ç„¶ã‚Šã§ã™ã€‚      Kubernetes â˜¸ï¸ãƒªã‚½ãƒ¼ã‚¹       Istio â›µï¸ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹     Envoyã®è¨­å®š      Service      Endpoints      Gateway      VirtualServiceX      ã€ƒY      DestinationRuleX      ã€ƒY      ServiceEntry      PeerAuthentication    é€ä¿¡å…ƒ      ãƒªã‚¹ãƒŠãƒ¼      âœ…                  âœ…                              âœ…    ãƒ«ãƒ¼ãƒˆ      âœ…                  âœ…                                  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼      âœ…                              âœ…                  âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ            âœ…                        âœ…                      å®›å…ˆ      ãƒªã‚¹ãƒŠãƒ¼                  âœ…            âœ…                        âœ…    ãƒ«ãƒ¼ãƒˆ                              âœ…                            ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼                                          âœ…      âœ…      âœ…    ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                                          âœ…      âœ…          â–¶ï¸ é€ä¿¡å…ƒã¨å®›å…ˆã®Namespaceã«ã¤ã„ã¦istio-egress) ã«ãŠã„ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ç•°ãªã‚‹Namespaceã«Istio EgressGatewayã‚’ç½®ãã“ã¨ã§ã€Istio EgressGatewayã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã‚„ã™ããªã£ãŸã‚Šã€ä»–ã‹ã‚‰éšœå®³ã®å½±éŸ¿ã‚’å—ã‘ã«ãããªã‚Šã¾ã™ğŸ™†ğŸ»â€â™‚ï¸istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã«å½“ã¦ã¯ã‚ã‚‹ã“ã®è¡¨ã‚’ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä»•çµ„ã¿ã®ä¸­ã«å½“ã¦ã¯ã‚ã‚‹ã¨ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚å¼•ç”¨ã—ãŸå‰è¿°ã®è§£èª¬ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ´ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã§åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒç™»å ´ã—ã¾ã›ã‚“ ã€‚ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã ã‘ã«ç€ç›®ã™ã‚‹ã¨ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚é€ä¿¡å…ƒã¾ãŸã¯å®›å…ˆEnvoyã§åŒã˜ãƒªã‚½ãƒ¼ã‚¹ãŒç™»å ´ã—ãªã„ã“ã¨ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã—ãŸã€‚06. ç¿»è¨³ã•ã‚ŒãŸEnvoyè¨­å®šå€¤ã‚’è¦‹ã¦ã¿ã‚‹å‰ç« ã§ã¯ã€Envoyã®å…·ä½“çš„ãªè¨­å®šå€¤ã¾ã§ã€è¨€åŠã—ã¾ã›ã‚“ã§ã—ãŸã€‚æœ¬ç« ã§ã¯ã€ã•ã‚‰ã«å…·ä½“åŒ–ã—ã¾ã™ã€‚å„ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã®ç¿»è¨³ã«ã‚ˆã£ã¦ã€Envoyã®å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªè¨­å®šå€¤ã«ãªã£ã¦ã„ã‚‹ã®ã‹ã‚’è§£èª¬ã—ã¾ã™ã€‚Envoyã®ç¾åœ¨ã®è¨­å®šã‚’å‡ºåŠ›ã™ã‚‹Envoyã¯ã€ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (/config_dump) ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€å…·ä½“çš„ãªè¨­å®šå€¤ã‚’å‡ºåŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ğŸ‘ğŸ»ãƒªã‚¹ãƒŠãƒ¼ã‚’å‡ºåŠ›ã™ã‚‹/config_dumpã®ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«resource={dynamic_listeners}ã‚’ã¤ã‘ã‚‹ã¨ã€Envoyã®ãƒªã‚¹ãƒŠãƒ¼ã‚’å‡ºåŠ›ã§ãã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_listeners}\" | yq -PAdministration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationâ–¶ å®›å…ˆæƒ…å ±ã‚’è¦‹ã‚„ã™ãã™ã‚‹yqã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦yqã‚³ãƒãƒ³ãƒ‰ã§YAMLã«å¤‰æ›ã™ã‚‹ã¨è¦‹ã‚„ã™ããªã‚Šã¾ã™ğŸ‘ãƒ«ãƒ¼ãƒˆã‚’å‡ºåŠ›ã™ã‚‹/config_dumpã®ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«resource={dynamic_route_configs}ã‚’ã¤ã‘ã‚‹ã¨ã€Envoyã®ãƒ«ãƒ¼ãƒˆã‚’å‡ºåŠ›ã§ãã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_route_configs}\" | yq -PAdministration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å‡ºåŠ›ã™ã‚‹/config_dumpã®ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«resource={dynamic_active_clusters}ã‚’ã¤ã‘ã‚‹ã¨ã€Envoyã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å‡ºåŠ›ã§ãã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_active_clusters}\" | yq -PAdministration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‡ºåŠ›ã™ã‚‹/config_dumpã®ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«include_edsã‚’ã¤ã‘ã‚‹ã¨ã€Envoyã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‡ºåŠ›ã§ãã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?include_eds\" | yq -PAdministration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationSupported load balancers â€” envoy 1.32.0-dev-c091ca documentationè¨¼æ˜æ›¸ã‚’å‡ºåŠ›ã™ã‚‹/config_dumpã®ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«resource={dynamic_active_secrets}ã‚’ã¤ã‘ã‚‹ã¨ã€è¨¼æ˜æ›¸ã‚’å‡ºåŠ›ã§ãã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_active_secrets}\" | yq -PConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã‹ã‚‰ã®HTTPSã“ã“ã§ã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã¨ã—ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠé€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50000) ã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š0.0.0.0_50000) ã€‚HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚ã¾ãŸã€å®›å…ˆã¨TLSãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’å®Ÿè¡Œã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50000) ã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒ«ãƒ¼ãƒˆã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š50000) ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆ (ä¾‹ï¼šfoo-service.foo-namespace.svc.cluster.local) ã‚„ãƒ‘ã‚¹ (ä¾‹ï¼š/) ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã‚„ãƒ›ã‚¹ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šoutbound|50010|foo-service.foo-namespace.svc.cluster.local) ã€‚è¨­å®šã—ãŸè² è·åˆ†æ•£æ–¹å¼ (ä¾‹ï¼šãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ãªã©) ã«å¿œã˜ã¦ã€Serviceé…ä¸‹ã®Podã‚’é¸ã³ã¾ã™ã€‚Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’Podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š\u003cPodã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\u003e:50000) ã€‚å®›å…ˆã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ã€‚ãã—ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆPodã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚å®›å…ˆPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠL7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã•ã‚ŒãŸHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50000) ã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š0.0.0.0_50000)HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50000) ã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒ«ãƒ¼ãƒˆã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šinbound|50000||) ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆ (ä¾‹ï¼šexample.com) ã‚„ãƒ‘ã‚¹ (ä¾‹ï¼š/) ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šinbound|50000||) ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é¸ã³ã¾ã™ã€‚Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã‚„å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š127.0.0.6:50000) ã€‚  ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚çµæœçš„ã«ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãã¾ã™ã€‚Istio Ingress vs. Kubernetes Ingress â€“ Daniel Watrous on Software and Cloud Engineeringâ–¶ï¸ istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ãƒ—ãƒ­ã‚­ã‚·å…ˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã‚’127.0.0.6ã¨ã—ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€127.0.0.1ã‚’æŒ‡å®šã—ã¦ã—ã¾ã†ã¨ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®é€šä¿¡ãŒiptablesä¸Šã§ãƒ«ãƒ¼ãƒ—ã—ã¦ã—ã¾ã†ãŸã‚ã§ã™ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®é€šä¿¡ã§ã¯ã€æ­£ã—ãã¯iptablesä¸Šã§ISTIO_OUTPUTã‹ã‚‰POSTROUTINGã«é€šä¿¡ã‚’æ¸¡ã—ã¾ã™ã€‚ä¸€æ–¹ã§ã€ã‚‚ã—ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆãŒ127.0.0.1ã§ã‚ã‚‹ã¨ã€ISTIO_OUTPUTã‹ã‚‰ISTIO_IN_REDIRECTã«é€šä¿¡ã‚’æ¸¡ã™ã“ã¨ã«ãªã‚Šã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«å†ã³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã—ã¾ã„ã¾ã™ã€‚hatappi1225ã•ã‚“ã®è§£èª¬ãŒé¬¼ã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ğŸ™ğŸ™ğŸ™ç”»åƒå¼•ç”¨å…ƒï¼šmercari engineeringInbound Forwarding - Google ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆiptables ã‹ã‚‰ç†è§£ã™ã‚‹ Istio 1.10 ã‹ã‚‰å¤‰æ›´ã•ã‚ŒãŸ Inbound Forwarding | ãƒ¡ãƒ«ã‚«ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®HTTPSã“ã“ã§ã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã¨ã—ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠé€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50010) ã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š0.0.0.0_50010) ã€‚HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚ã¾ãŸã€å®›å…ˆã¨TLSãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’å®Ÿè¡Œã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50010) ã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒ«ãƒ¼ãƒˆã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š50010) ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆ (ä¾‹ï¼šfoo-service.foo-namespace.svc.cluster.local) ã‚„ãƒ‘ã‚¹ (ä¾‹ï¼š/) ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã‚„ãƒ›ã‚¹ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šoutbound|50010|foo-service.foo-namespace.svc.cluster.local) ã€‚è¨­å®šã—ãŸè² è·åˆ†æ•£æ–¹å¼ (ä¾‹ï¼šãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ãªã©) ã«å¿œã˜ã¦ã€Serviceé…ä¸‹ã®Podã‚’é¸ã³ã¾ã™ã€‚Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’Podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š\u003cPodã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\u003e:50010) ã€‚å®›å…ˆã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ã€‚ãã—ã¦ã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®›å…ˆPodã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚å®›å…ˆPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠL7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã•ã‚ŒãŸHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50010) ã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š0.0.0.0_50010)HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š50010) ã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒ«ãƒ¼ãƒˆã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šinbound|50010||) ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆ (ä¾‹ï¼šexample.com) ã‚„ãƒ‘ã‚¹ (ä¾‹ï¼š/) ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šinbound|50010||) ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é¸ã³ã¾ã™ã€‚Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã‚„å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š127.0.0.6:50010) ã€‚  ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚çµæœçš„ã«ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãã¾ã™ã€‚Istioæµé‡ç®¡ç†å®ç°æœºåˆ¶æ·±åº¦è§£æ-èµµåŒ–å†°çš„åšå®¢ | Zhaohuabing Blogã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å¤–ã¸ã®HTTPSã“ã“ã§ã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã¨ã—ã¾ã™ã€‚å›³ä¸­ã®ç•ªå·ã«æ²¿ã£ã¦ã€é€šä¿¡ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚é€ä¿¡å…ƒPodå´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠé€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š443) ã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š0.0.0.0_443) ã€‚HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚ã¾ãŸã€å®›å…ˆã¨TLSãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’å®Ÿè¡Œã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š443) ã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒ«ãƒ¼ãƒˆã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š443) ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆ (ä¾‹ï¼šistio-egressgateway-service.foo-namespace.svc.cluster.local) ã‚„ãƒ‘ã‚¹ (ä¾‹ï¼š/) ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’Istio EgressGateway å®›å…ˆãƒãƒ¼ãƒˆã‚„ãƒ›ã‚¹ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šoutbound|443|istio-egressgateway-service.foo-namespace.svc.cluster.local) ã€‚è¨­å®šã—ãŸè² è·åˆ†æ•£æ–¹å¼ (ä¾‹ï¼šãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ãªã©) ã«å¿œã˜ã¦ã€Istio EgressGateway Serviceé…ä¸‹ã®Podã‚’é¸ã³ã¾ã™ã€‚Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’Podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š\u003cPodã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\u003e:443) ã€‚å®›å…ˆã¨ã®é–“ã§TLSæ¥ç¶šã‚’ç¢ºç«‹ã—ã€ãƒ‘ã‚±ãƒƒãƒˆã®L7ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ã€‚ãã—ã¦ã€Istio EgressGateway Podã«L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚å®›å…ˆPod (Istio EgressGateway Pod) å´ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠL7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã•ã‚ŒãŸHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š443) ã§ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š0.0.0.0_443)HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒãƒ¼ãƒˆ (ä¾‹ï¼š443) ã§ã€ãƒ«ãƒ¼ãƒˆã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ãƒ«ãƒ¼ãƒˆã‚’å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šinbound|50010||) ã€‚HTTPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã‚ˆã‚Šã€HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆãƒ›ã‚¹ãƒˆ (ä¾‹ï¼šexternal.com) ã‚„ãƒ‘ã‚¹ (ä¾‹ï¼š/) ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµã‚Šè¾¼ã¿ã¾ã™ã€‚Envoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å®›å…ˆãƒãƒ¼ãƒˆã‚„ãƒ›ã‚¹ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼šoutbound|443|external.com) ã€‚ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é¸ã³ã¾ã™ã€‚Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã‚¨ãƒ³ãƒˆãƒªæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„å®›å…ˆãƒãƒ¼ãƒˆã§ç®¡ç†ã—ã¦ã„ã¾ã™ (ä¾‹ï¼š:50010) ã€‚ã‚¨ãƒ³ãƒˆãƒªæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€é–‹ç™ºè€…ãŒè¨­å®šã™ã‚‹å¿…è¦ã¯ãªãã€EnvoyãŒDNSã‹ã‚‰å‹•çš„ã«å–å¾—ã—ã¾ã™ã€‚  ã‚¨ãƒ³ãƒˆãƒªæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚Using Istio to MITM our usersâ€™ traffic | Steven ReitsmaIngress, egress, ServiceEntry DATA Flow issues for ISTIO API Gateway? - Discuss Istio07. ãŠã‚ã‚Šã«Istioã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ãŒEnvoyã®HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã‚’ã©ã®ã‚ˆã†ã«æŠ½è±¡åŒ–ã™ã‚‹ã®ã‹ã€ã¾ãŸEnvoyãŒã©ã®ã‚ˆã†ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã®ã‹ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚æ¬¡ã€…ã¨ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ«ãŒç™»å ´ã—ãŸã¨ã—ã¦ã‚‚ã€ãã‚ŒãŒEnvoyã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã§ã‚ã‚‹é™ã‚Šã€æœ€çµ‚çš„ã«ã¯Envoyã®è¨­å®šå€¤ã«è¡Œãç€ãã¾ã™ã€‚ãã®ãŸã‚ã€æŠ½è±¡åŒ–ã•ã‚ŒãŸEnvoyãŒã©ã®ã‚ˆã†ã«é€šä¿¡ã‚’æ‰±ã†ã®ã‹ã‚’ä¸€åº¦ã§ã‚‚ç†è§£ã™ã‚Œã°ã€æ§˜ã€…ãªã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ«ã§çŸ¥è­˜ã‚’æµç”¨ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚Istioã¯ã‚‚ã¡ã‚ã‚“ã€ä»–ã®Envoyã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ« (Consulã€Ciliumãªã©) ã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã®å‚è€ƒã«ã‚‚ãªã‚Œã°å¹¸ã„ã§ã™ğŸ‘ğŸ»è¬è¾ä»Šå›ã€Kubernetesã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’èª¿æŸ»ã™ã‚‹ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®æ–¹ã«çŸ¥è¦‹ã‚’ã”æ•™æˆã„ãŸã ãã¾ã—ãŸã€‚@ken5owata ã•ã‚“ã“ã®å ´ã§æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ğŸ™‡ğŸ»â€è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±Istio in Action (English Edition)ä½œè€…:Posta, Christian E.,Maloku, RinorManningAmazonIstio: Up and Running: Using a Service Mesh to Connect, Secure, Control, and Observeä½œè€…:Calcote, Lee,Butcher, ZackO'ReillyAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2024/01/16/013404","isoDate":"2024-01-15T16:34:04.000Z","dateMiliSeconds":1705336444000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ™ Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã®å®Ÿè·µãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ","contentSnippet":"ã€Kubernetes Novice Tokyoã€ã®ç™»å£‡è³‡æ–™ã§ã™\r\rãƒ»Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¨®é¡\rãƒ»ArgoCDã®AppProjectãƒ†ãƒŠãƒ³ãƒˆã¨Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰\rãƒ»ArgoCDã®ãƒ†ãƒŠãƒ³ãƒˆãŒé˜²ã„ã§ãã‚Œã‚‹èª¤ã£ãŸæ“ä½œã®å…·ä½“ä¾‹\r\rã‚’ç´¹ä»‹ã—ã¾ã—ãŸ\r\rArgoCDã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®å®Ÿè£…ä¾‹ã‚’è§£èª¬ã§ãã¾ã›ã‚“ã§ã—ãŸã®ã§ã€ãœã²å…ƒè¨˜äº‹ (Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã®å®Ÿè·µãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ) ã‚‚ã”å‚ç…§ãã ã•ã„ğŸ‘ğŸ»\r\rğŸ¦ ãƒ„ã‚¤ãƒ¼ãƒˆï¼šhttps://x.com/Hiroki__IT/status/1737778249021952458","link":"https://speakerdeck.com/hiroki_hasegawa/kubernetesnomarutitenantopatantoargocdnoshi-jian-tenantoshe-ji","isoDate":"2023-12-21T05:00:00.000Z","dateMiliSeconds":1703134800000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€ArgoCDğŸ™ã€‘\"Kubernetes Novice Tokyo\" ã«ç™»å£‡","contentSnippet":"ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¨®é¡ArgoCDã®AppProjectãƒ†ãƒŠãƒ³ãƒˆã¨Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ArgoCDã®ãƒ†ãƒŠãƒ³ãƒˆãŒé˜²ã„ã§ãã‚Œã‚‹èª¤ã£ãŸæ“ä½œã®å…·ä½“ä¾‹ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã‚¤ãƒ™ãƒ³ãƒˆåç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆåã‚ªãƒƒã‚¹ï¼ã‚ªãƒ©é•·è°·å·ï¼âœ‹ğŸ»ã€Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã®å®Ÿè·µãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆã€ã¦ã„ã†ãƒ†ãƒ¼ãƒã§ã€ Kubernetes Novice Tokyo ã«ç™»å£‡ã—ãŸãï¼ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã¿ã‚“ãªï¼ã‚¹ãƒ©ã‚¤ãƒ‰ãœã£ã¦ã‡è¦‹ã¦ãã‚Œã‚ˆãªï¼Kubernetes Novice Tokyo ã®ç™»å£‡è³‡æ–™ã§ã™ï¼ã‚­ãƒŸã ã‘ã®æœ€å¼·ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚’ä½œã‚ã†âœŒï¸#k8snovicehttps://t.co/qNEhnkA7WZâ€” é•·è°·å· åºƒæ¨¹ (åœ°ä¸‹å¼·åˆ¶åŠ´åƒè€…) (@Hiroki__IT) December 21, 2023 ã¡ãªã€ç™ºè¡¨å†…å®¹ã®è©³ç´°ã¯ã“ã®è¨˜äº‹ã‚’ã¿ã¦ãã‚Œã‚ˆãªï¼","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/12/21/833414","isoDate":"2023-12-21T03:00:00.000Z","dateMiliSeconds":1703127600000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€TerraformğŸ§‘ğŸ»â€ğŸš€ã€‘\"Findy Terraform æ´»ç”¨å¤§å…¨ - IaCã®ä»Š\" ã«ç™»å£‡","contentSnippet":"ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Terraformã®tfstateã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³tfstateåˆ†å‰²ã‚’ãƒªãƒã‚¸ãƒˆãƒªã‚„ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨ã™ã‚‹æ–¹æ³•ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã‚¤ãƒ™ãƒ³ãƒˆåç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆåã‚ªãƒƒã‚¹ï¼ã‚ªãƒ©é•·è°·å·ï¼âœ‹ğŸ»ã€ tfstate ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨ã€ã¦ã„ã†ãƒ†ãƒ¼ãƒã§ã€ Findy Terraform æ´»ç”¨å¤§å…¨ - IaCã®ä»Š ã«ç™»å£‡ã—ãŸãï¼ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã¿ã‚“ãªï¼ã‚¹ãƒ©ã‚¤ãƒ‰ãœã£ã¦ã‡è¦‹ã¦ãã‚Œã‚ˆãªï¼ã€Terraformæ´»ç”¨å¤§å…¨ - IaCã®ä»Šã€‚ã€ã®ç™»å£‡è³‡æ–™ã§ã™!!tfstateã‚’åˆ†å‰²ã—ã¦ã¿ã‚“ãªã§æœ€é«˜ã«ãªã‚ã†âœŒğŸ»#Terraform_findyhttps://t.co/NteGvKdMEEâ€” é•·è°·å· åºƒæ¨¹ (åœ°ä¸‹å¼·åˆ¶åŠ´åƒè€…) (@Hiroki__IT) October 25, 2023 ã¡ãªã€ç™ºè¡¨å†…å®¹ã®è©³ç´°ã¯ã“ã®è¨˜äº‹ã‚’ã¿ã¦ãã‚Œã‚ˆãªï¼","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/10/25/550144","isoDate":"2023-10-25T03:00:00.000Z","dateMiliSeconds":1698202800000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ§‘â€ğŸš€ tfstate ã®åˆ†å‰²ãƒã‚šã‚¿ãƒ¼ãƒ³ã¨ãƒ†ã‚™ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨","contentSnippet":"ã€Terraformæ´»ç”¨å¤§å…¨ - IaCã®ä»Šã€ã®ç™»å£‡è³‡æ–™ã§ã™\r\r\rãƒ»Terraformã®tfstateã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³\rãƒ»tfstateåˆ†å‰²ã‚’ãƒªãƒã‚¸ãƒˆãƒªã‚„ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨ã™ã‚‹æ–¹æ³•\r\rã‚’ç´¹ä»‹ã—ã¾ã—ãŸ\r\rã‚¹ãƒ©ã‚¤ãƒ‰ã§ã¯å°‘ã—ã—ã‹åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç´¹ä»‹ã§ãã¾ã›ã‚“ã§ã—ãŸã®ã§ã€ãœã²å…ƒè¨˜äº‹ (tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨) ã‚‚ã”å‚ç…§ãã ã•ã„ğŸ‘ğŸ»\r\rğŸ¦ ãƒ„ã‚¤ãƒ¼ãƒˆï¼šhttps://x.com/Hiroki__IT/status/1717030862452384047","link":"https://speakerdeck.com/hiroki_hasegawa/tfstate-nofen-ge-hatantoteirekutorigou-cheng-henoshi-yong","isoDate":"2023-10-24T04:00:00.000Z","dateMiliSeconds":1698120000000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€ArgoCDğŸ™ï¸ã€‘Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã®å®Ÿè·µãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¨®é¡ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ArgoCDã§å®Ÿè·µã™ã‚‹å ´åˆã«ã‚ªã‚¹ã‚¹ãƒ¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ (â˜…ã§è¡¨ç¾)ArgoCDã®Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ã¨Clusterã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ArgoCDã®ãƒ†ãƒŠãƒ³ãƒˆãŒé˜²ã„ã§ãã‚Œã‚‹èª¤ã£ãŸæ“ä½œã®å…·ä½“ä¾‹è¨˜äº‹ã®ã–ã£ãã‚Šã—ãŸå†…å®¹ã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã§ãã¡ã‚ƒã„ã¾ã™ï¼    ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. ãªãœãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãŒå¿…è¦ãªã®ã‹ã‚·ãƒ³ã‚°ãƒ«ãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆ03. Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§Clusters as-a-ServiceControl Planes as-a-ServiceNamespaces as-a-Serviceã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆ04. ArgoCDã§ã®ãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µä¸€è¦§04-02. Clusters as-a-Service å®Ÿè·µå®ŸClusterãƒ†ãƒŠãƒ³ãƒˆã‚ªã‚¹ã‚¹ãƒ¡ã—ãªã„ç†ç”±04-03. Control Planes as-a-Service å®Ÿè·µä»®æƒ³Clusterãƒ†ãƒŠãƒ³ãƒˆ - â˜…ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±04-04. Namespaces as-a-Service å®Ÿè·µ04-05. ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆã®å®Ÿè·µAppProjectãƒ†ãƒŠãƒ³ãƒˆCLãƒ¢ãƒ¼ãƒ‰ vs. NSãƒ¢ãƒ¼ãƒ‰05. CLãƒ¢ãƒ¼ãƒ‰ãªArgoCDCLãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¨ã¯AppProjectArgoCDã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ConfigMap (argocd-cmd-params-cm)ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm)ã‚ªã‚¹ã‚¹ãƒ¡ã—ãªã„ç†ç”±05-02. NSãƒ¢ãƒ¼ãƒ‰ãªArgoCD - â˜…â˜…NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¨ã¯AppProjectArgoCDã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ConfigMap (argocd-cmd-params-cm)ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm)ç‰¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±AppProjectãƒ†ãƒŠãƒ³ãƒˆä¾‹ã®ä¸€è¦§ãƒ†ãƒŠãƒ³ãƒˆä¾‹1Namespace (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥)ã€AppProject (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥)ã‚ªã‚¹ã‚¹ãƒ¡ã—ãªã‹ã£ãŸç†ç”±ãƒ†ãƒŠãƒ³ãƒˆä¾‹2 - â˜…Namespace (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥)ã€AppProject (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥)ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±ãƒ†ãƒŠãƒ³ãƒˆä¾‹3 - â˜…â˜…Namespace (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥)ã€AppProject (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥)ç‰¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±06. ã©ã®ã‚ˆã†ãªèª¤ã£ãŸæ“ä½œã‚’é˜²ã„ã§ãã‚Œã‚‹ã®ã‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶é™ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹å ´åˆ(ğŸš«åˆ¶é™ä¾‹1) ç„¡èªå¯ã®Namespaceã§Applicationã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ãŸå ´åˆ(ğŸš«åˆ¶é™ä¾‹2) ç„¡èªå¯ã®AppProjectã§Applicationã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ãŸå ´åˆ(ğŸš«åˆ¶é™ä¾‹3) ç„¡èªå¯ã®Clusterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã—ã‚ˆã†ã¨ã—ãŸå ´åˆ(ğŸš«åˆ¶é™ä¾‹4) ç„¡èªå¯ã®Namespaceã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã—ã‚ˆã†ã¨ã—ãŸå ´åˆã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®Reconciliationåˆ¶é™ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’Reconciliationã§ãã‚‹å ´åˆ(ğŸš«åˆ¶é™ä¾‹1) ç„¡èªå¯ã®Namespaceã«Reconciliationã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ãŸå ´åˆ07. ãŠã‚ã‚Šã«è¬è¾è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«ã©ã†ã‚‚ã€ç†Ÿæˆã‚¢ãƒ«ãƒˆãƒã‚¤ã‚¨ãƒ«ãƒ³ã§ã™ã€‚ç”»åƒå¼•ç”¨å…ƒï¼šArgo Projectã•ã¦æœ€è¿‘ã®æ¥­å‹™ã§ã€å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®æŠ€è¡“åŸºç›¤é–‹ç™ºãƒãƒ¼ãƒ ã«æºã‚ã£ã¦ãŠã‚Šã€å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå…±æœ‰ã®ArgoCDğŸ™ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåŒ–ã‚’æ‹…å½“ã—ã¾ã—ãŸã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãŒç¨¼åƒã™ã‚‹Kubernetes ClusterãŒæ•°åå€‹ã‚ã‚Šã€Clusterã«ã‚ˆã£ã¦ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ ãŒåˆè¨ˆ100å€‹ä»¥ä¸Šã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‹•ã‹ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå¤§è¦æ¨¡ãªãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚·ã‚¹ãƒ†ãƒ ãŒã„ãã¤ã‚‚ã‚ã‚‹çŠ¶æ³ä¸‹ã§ã€ArgoCDã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆã®çŸ¥è¦‹ã‚’æ·±ã‚ã‚‰ã‚ŒãŸãŸã‚ã€è¨˜äº‹ã§è§£èª¬ã—ã¾ã—ãŸã€‚æ›¸ããŸã„ã“ã¨ã‚’å…¨éƒ¨æ›¸ã„ãŸã¨ã“ã‚ã€æƒ…å ±é‡ãŒã‚¨ã‚°ã„ã“ã¨ã«ãªã£ã¦ã—ã¾ã£ãŸãŸã‚ã€æ°—ã«ãªã‚‹ç« ã ã‘ã§ã‚‚æ‹¾ã£ã¦å¸°ã£ã¦ã„ãŸã ã‘ã‚‹ã¨ãƒãƒƒãƒ”ãƒ¼ã§ã™ğŸ™Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ (3ç« )ArgoCDã§ã®ãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µä¸€è¦§ (4ç« )ArgoCDã®Clusterã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ã¨Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ (5ç« )ã©ã®ã‚ˆã†ãªèª¤ã£ãŸæ“ä½œã‚’é˜²ã„ã§ãã‚Œã‚‹ã®ã‹ (6ç« )ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. ãªãœãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãŒå¿…è¦ãªã®ã‹ã‚·ãƒ³ã‚°ãƒ«ãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆãã‚‚ãã‚‚ã€ãªãœArgoCDã«ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãŒå¿…è¦ãªã®ã§ã—ã‚‡ã†ã‹ã€‚ä¾‹ãˆã°ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¨ãªã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Cluster (ä¾‹ï¼šfooã€barã€baz) ãŒã‚ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚ArgoCDã‚’ã‚·ãƒ³ã‚°ãƒ«ãƒ†ãƒŠãƒ³ãƒˆã«ã™ã‚‹å ´åˆã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ã®æ“ä½œã™ã‚‹Applicationã‚’åŒã˜ãƒ†ãƒŠãƒ³ãƒˆã«å…±å­˜ã•ã›ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€å˜ä¸€ã®argocd-server (ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰) ã‹ã‚‰å…¨ã¦ã®Applicationã‚’æ“ä½œã§ãã¦ä¾¿åˆ©ã§ã™ã€‚ã—ã‹ã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusteræ•°ãŒå¢—ãˆã¦ã„ãã«ã¤ã‚Œã¦ã€å•é¡ŒãŒèµ·ã“ã‚Šå§‹ã‚ã¾ã™ã€‚ä¾‹ãˆã°ã€ã„ãšã‚Œã‹ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ãŒèª¤ã£ãŸApplicationã‚’æ“ä½œã—ã€çµæœçš„ã«èª¤ã£ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€ã‚·ã‚¹ãƒ†ãƒ ã§ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚’èµ·ã“ã—ã¦ã‚„ã‚ã†ã¨ã„ã†æ‚ªæ„ã‚’æŒã£ãŸäººãŒã€èª¤ã£ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã‚’æ„å›³çš„ã«é¸ã¶å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ğŸ˜ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆãã®ä¸€æ–¹ã§ã€ã„ã„æ„Ÿã˜ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã«ã—ãŸã¨ã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ã¯ã€èªå¯ã•ã‚ŒãŸãƒ†ãƒŠãƒ³ãƒˆã«æ‰€å±ã™ã‚‹Applicationã«ã®ã¿ã‚’æ“ä½œã§ãã€åå¯¾ã«ç„¡èªå¯ã®ãƒ†ãƒŠãƒ³ãƒˆã®Applicationã¯æ“ä½œã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€èª¤ã£ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚’é˜²ã’ã¾ã™ã€‚03. Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€è¦§ArgoCDã®ãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆã‚’å®Ÿè·µã™ã‚‹å‰ã«ã€Kubernetesã«ã¯ã©ã‚“ãªãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ä»¥ä¸‹ã«å¤§åˆ¥ã§ãã¾ã™ã€‚         Clustersas-a-Service         Control Planesas-a-Service         Namespacesas-a-Service         ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆ      ãƒ†ãƒŠãƒ³ãƒˆå˜ä½         å®ŸCluster         ä»®æƒ³Cluster         Namespace         ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®è«–ç†ç©ºé–“      ãƒ†ãƒŠãƒ³ãƒˆé–“ã§Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ†é›¢ã§ãã‚‹ã‹         Clusterã‚¹ã‚³ãƒ¼ãƒ—ãƒªã‚½ãƒ¼ã‚¹         âœ…         âœ…         âœ…         ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹      Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒªã‚½ãƒ¼ã‚¹         âœ…         âœ…                  ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹      ãƒ„ãƒ¼ãƒ«         AWS EKSGCP GKEAzure AKEKubeadmãªã©         Kcptensile-kubevclusterVirtualClusterãªã©         Namespaceã‚’å¢—ã‚„ã™ã ã‘ãªã®ã§ç‰¹åˆ¥ãªãƒ„ãƒ¼ãƒ«ä¸è¦         ArgoCDã®AppProjectCapsuleã®Tenantkioskã®AccountKubeZooã®Tenantãªã©      â–¶ ä»–ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã®åˆ†é¡æ–¹æ³•ã«ã¤ã„ã¦\"ã‚½ãƒ•ãƒˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ã‚·ãƒ¼\" ã¨ \"ãƒãƒ¼ãƒ‰ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ã‚·ãƒ¼\" ã¨ã„ã£ãŸåˆ†é¡æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®åˆ†é¡æ–¹æ³•ã§ã¯ã€ãƒ†ãƒŠãƒ³ãƒˆé–“ã®åˆ†é›¢åº¦ã®è¦³ç‚¹ã§å„ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚’ç¨®åˆ¥ã—ã¾ã™ã€‚ã‚½ãƒ•ãƒˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ã‚·ãƒ¼ã¯ã€äº’ã„ã«ä¿¡é ¼ã§ãã‚‹å‰æã®ä¸Šã§ã€ãƒ†ãƒŠãƒ³ãƒˆé–“ã‚’å¼±ãåˆ†é›¢ã—ã¾ã™ã€‚ãã®ä¸€æ–¹ã§ã€ãƒãƒ¼ãƒ‰ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ã‚·ãƒ¼ã¯ã€äº’ã„ã«ä¿¡é ¼ã§ããªã„å‰æã®ä¸Šã§ãƒ†ãƒŠãƒ³ãƒˆé–“ã‚’å¼·ãåˆ†é›¢ã—ã¾ã™ã€‚åˆ†é›¢åº¦ãŒã‚½ãƒ•ãƒˆã¨ãƒãƒ¼ãƒ‰ã®ã„ãšã‚Œã§ã‚ã‚‹ã‹ã«å®¢è¦³çš„ãªæŒ‡æ¨™ãŒãªãã€ã‚„ã‚„æ›–æ˜§ãªç¨®åˆ¥ã«ãªã£ã¦ã—ã¾ã†ãŸã‚ã€æœ¬è¨˜äº‹ã® X as-a-Service ã®æ–¹ãŒå€‹äººçš„ã«ã¯å¥½ã¿ã§ã™â™¡â™¡â™¡The Kubernetes Book: 2024 Edition (English Edition)Multi-tenancy | KubernetesMulti-tenancy - EKS Best Practices GuidesClusters as-a-ServiceClusters as-a-Serviceã¯ã€ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸClusterã‚’æä¾›ã—ã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã€AWS EKSã€GCP GKEã€Azure AKEã€Kubeadmãªã©ãŒã‚ã‚Šã¾ã™ã€‚Three Tenancy Models For Kubernetes | KubernetesWhat are the three tenancy models for Kubernetes?Control Planes as-a-ServiceControl Planes as-a-Serviceã¯ã€ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ (è¨€ã„æ›ãˆã°ä»®æƒ³Cluster) ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã€Kcpã€tensile-kubeã€vclusterã€VirtualClusterãªã©ãŒã‚ã‚Šã¾ã™ã€‚Three Tenancy Models For Kubernetes | KubernetesWhat are the three tenancy models for Kubernetes?Namespaces as-a-ServiceNamespaces as-a-Serviceã¯ã€ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸNamespaceã‚’æä¾›ã—ã¾ã™ã€‚Namespaceã‚’å¢—ã‚„ã™ã ã‘ãªãŸã‚ã€ãƒ„ãƒ¼ãƒ«ã¯ä¸è¦ã§ã™ã€‚Three Tenancy Models For Kubernetes | KubernetesWhat are the three tenancy models for Kubernetes?ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆã¯ã€ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®è«–ç†ç©ºé–“ (ä¾‹ï¼šArgoCDã®AppProjectã€Capsuleã®Tenantã€kioskã®Accountã€KubeZooã®Tenantãªã©) ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ã¯ã€X as-a-Service ã‚‚å…¼ã­ã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ç´¹ä»‹ã™ã‚‹AppProjectã¯ã€å‰è¿°ã®ã€Namespace as-a-Serviceã€ã‚’å…¼ã­ã¦ã„ã¾ã™ã€‚AppProjectã«ã¤ã„ã¦ã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆ ã§è§£èª¬ã—ã¦ã„ã¾ã™ã€‚04. ArgoCDã§ã®ãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µä¸€è¦§ãŠå¾…ãŸã›ã—ã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯ã€Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ArgoCDã§å…·ä½“çš„ã«å®Ÿè·µã—ã€ãŠã™ã™ã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚ãªãŠã€ã‚ªã‚¹ã‚¹ãƒ¡ã™ã‚‹ã‚‚ã®ã‚’ â˜… ã¨ã—ã¦ã„ã¾ã™ã€‚         å®ŸClusterãƒ†ãƒŠãƒ³ãƒˆ         ä»®æƒ³Clusterãƒ†ãƒŠãƒ³ãƒˆ         Namespaceãƒ†ãƒŠãƒ³ãƒˆ         AppProjectãƒ†ãƒŠãƒ³ãƒˆCLãƒ¢ãƒ¼ãƒ‰         AppProjectãƒ†ãƒŠãƒ³ãƒˆNSãƒ¢ãƒ¼ãƒ‰      å¯¾å¿œã™ã‚‹ãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³         Clustersas-a-Service         Control Planesas-a-Service         Namespacesas-a-Service         ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆ      ArgoCDãŒãƒ†ãƒŠãƒ³ãƒˆé–“ã§å æœ‰ / å…±æœ‰         å æœ‰         å æœ‰         å æœ‰         å…±æœ‰         å æœ‰      ãƒ†ãƒŠãƒ³ãƒˆé–“ã§Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ†é›¢ã§ãã‚‹ã‹         Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒªã‚½ãƒ¼ã‚¹         âœ…         âœ…         âœ…         âœ…         âœ…      Clusterã‚¹ã‚³ãƒ¼ãƒ—ãƒªã‚½ãƒ¼ã‚¹         âœ…         âœ…                                 ã‚ªã‚¹ã‚¹ãƒ¡                  â˜…                           â˜…â˜…      How many do you need? Argo CD Architectures Explained - 2024 Update | Akuityä»¥é™ã®å›³ã®å‡¡ä¾‹ã§ã™ã€‚ArgoCDã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (application-controllerã€argocd-serverã€dex-serverã€repo-server) ã¨å„ãƒªã‚½ãƒ¼ã‚¹ (Applicationã€AppProject) ã‚’åŒºåˆ¥ã—ã¦ã„ã¾ã™ã€‚04-02. Clusters as-a-Service å®Ÿè·µå®ŸClusterãƒ†ãƒŠãƒ³ãƒˆå®ŸClusterãƒ†ãƒŠãƒ³ãƒˆã¯ã€Clusters as-a-Serviceãªãƒ†ãƒŠãƒ³ãƒˆã®å®Ÿè·µã§ã‚ã‚Šã€å®Ÿéš›ã®Clusterã‚’ãƒ†ãƒŠãƒ³ãƒˆã®å˜ä½ã¨ã—ã¾ã™ã€‚å¾Œè¿°ã®ä»®æƒ³Clusterã¨å¯¾æ¯”ã•ã›ã‚‹ãŸã‚ã«ã€\"å®ŸCluster\" ã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã™ã€‚å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ã¯ã€å®ŸClusterãƒ†ãƒŠãƒ³ãƒˆå†…ã®Applicationã‚’æ“ä½œã—ã€æ­£ã—ã„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã‚ªã‚¹ã‚¹ãƒ¡ã—ãªã„ç†ç”±å®ŸClusterãƒ†ãƒŠãƒ³ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–ã‚‚è€ƒæ…®ã—ã¦ã€ç‹¬æ–­ã¨åè¦‹ã§ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã›ã‚“ã§ã—ãŸã€‚åŠå¹´ä»¥å†…ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãªã„ã¨ã‚µãƒãƒ¼ãƒˆãŒåˆ‡ã‚Œã‚‹Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒ33å€‹ã‚‚ã‚ã£ã¦ã€æ³£ã„ã¡ã‚ƒã£ãŸâ€” é•·è°·å· åºƒæ¨¹ (ä¿ºã§ã™) (@Hiroki__IT) January 18, 2023  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                                                                                           ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                      ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                  æ‹¡å¼µæ€§                 -                                                                                                                                                                     ãƒ†ãƒŠãƒ³ãƒˆã‚’å¢—ã‚„ã™ãŸã‚ã«å®ŸClusterã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ä½œæ¥­é‡ãŒå¤šã„ã€‚                              â¡ï¸  IaCãƒ„ãƒ¼ãƒ«ã§å®ŸClusterã‚’ç”¨æ„ã™ã‚‹ã‚ˆã†ã«ã™ã‚Œã°ä½œæ¥­é‡ã‚’æ¸›ã‚‰ã›ã‚‹ãŒã€ã‚„ã£ã±ã‚Šã¨ã¦ã‚‚ã¤ã‚‰ã„ğŸ˜­       å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        Clusterã‹ã‚‰Clusterã¸ã®åå‰è§£æ±ºã‚’ä¸å¯èƒ½ã«ã™ã‚Œã°ã€ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã‹ã‚‰ã®é€šä¿¡ã‚’é®æ–­ã§ãã‚‹ã€‚                                                                                  -                                                                                                â¡ï¸  -                                                                                                   ä¿å®ˆæ€§                 Clusterã‚¹ã‚³ãƒ¼ãƒ—ã¾ãŸã¯Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã‹ã‚‰åˆ†é›¢ã§ãã‚‹ã€‚ã“ã‚Œã‚‰ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ (ç‰¹ã«CRD) ã®å¤‰æ›´ãŒä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã—ãªã„ã€‚  å„ãƒ†ãƒŠãƒ³ãƒˆãŒã€å€‹åˆ¥ã«å®ŸClusterã‚’ä¿å®ˆã—ãªã„ã¨ã„ã‘ãªã„ã€‚(ä¾‹ï¼šã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€æ©Ÿèƒ½ä¿®æ­£ãªã©)  â¡ï¸  å›é¿ã§ããšã€ã¨ã¦ã‚‚ã¤ã‚‰ã„ğŸ˜­                                                                           æ€§èƒ½                  Clusterã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã¨å¥ªã„åˆã†ã“ã¨ãªãã€ã“ã‚Œã‚’ç‹¬å ã§ãã‚‹ã€‚                                                                                     -                                                                                                â¡ï¸  -                                                                                                   ä¿¡é ¼æ€§                 ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«å®ŸClusterãŒç‹¬ç«‹ã—ã¦ãŠã‚Šã€ä»–ã®å®ŸClusterã‹ã‚‰éšœå®³ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã€‚                                                                                        -                                                                                                â¡ï¸  -                                                                                    04-03. Control Planes as-a-Service å®Ÿè·µä»®æƒ³Clusterãƒ†ãƒŠãƒ³ãƒˆ - â˜…ä»®æƒ³Clusterãƒ†ãƒŠãƒ³ãƒˆã¯ã€Control Planes as-a-Serviceãªãƒ†ãƒŠãƒ³ãƒˆã®å®Ÿè·µã§ã‚ã‚Šã€ä»®æƒ³Clusterã‚’ãƒ†ãƒŠãƒ³ãƒˆã®å˜ä½ã¨ã—ã¾ã™ã€‚å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ã¯ã€ä»®æƒ³Clusterãƒ†ãƒŠãƒ³ãƒˆå†…ã®Applicationã‚’æ“ä½œã—ã€æ­£ã—ã„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚Using Argo CD with vclusters. Managing deployment to multipleâ€¦ | by Daniel Helfand | Argo Projectã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±ä»®æƒ³Clusterãƒ†ãƒŠãƒ³ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–ã‚‚è€ƒæ…®ã—ã¦ã€ç‹¬æ–­ã¨åè¦‹ã§ ã‚ªã‚¹ã‚¹ãƒ¡ ã—ã¾ã—ãŸã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                                                                                           ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                               ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                    æ‹¡å¼µæ€§                 ãƒ†ãƒŠãƒ³ãƒˆã‚’å¢—ã‚„ã™ãŸã‚ã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§å®šç¾©ã—ãŸä»®æƒ³Clusterã‚’ç”¨æ„ã™ã‚‹ã ã‘ã§ã‚ˆãã€å®ŸClusterã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã¨æ¯”ã¹ã¦ä½œæ¥­é‡ãŒå°‘ãªã„ã€‚                                          -                                                                                                         â¡ï¸  -                                                                                            å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        ä»®æƒ³Clusterã‹ã‚‰ãƒ›ã‚¹ãƒˆClusterã¸ã®åå‰è§£æ±ºã‚’ä¸å¯èƒ½ã«ã™ã‚Œã°ã€ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã‹ã‚‰ã®é€šä¿¡ã‚’é®æ–­ã§ãã‚‹ã€‚                                                                        -                                                                                                         â¡ï¸  -                                                                                                     ä¿å®ˆæ€§                 Clusterã‚¹ã‚³ãƒ¼ãƒ—ã¾ãŸã¯Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã‹ã‚‰åˆ†é›¢ã§ãã‚‹ã€‚ã“ã‚Œã‚‰ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ (ç‰¹ã«CRD) ã®å¤‰æ›´ãŒä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã—ãªã„ã€‚  å„ãƒ†ãƒŠãƒ³ãƒˆãŒã€å€‹åˆ¥ã«ä»®æƒ³Clusterã‚’ä¿å®ˆã—ãªã„ã¨ã„ã‘ãªã„ã€‚(ä¾‹ï¼šã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€æ©Ÿèƒ½ä¿®æ­£ãªã©)  â¡ï¸  ä»®æƒ³Clusterã«é–¢ã™ã‚‹çŸ¥è¦‹ã‚’æŒã¤çµ„ç¹”ã§ã‚ã‚Œã°ã€å„ãƒ†ãƒŠãƒ³ãƒˆã§ä¿å®ˆã§ãã‚‹ã€‚                                    æ€§èƒ½                  -                                                                                                                                                                     Clusterã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã¨å¥ªã„åˆã†ã“ã¨ã«ãªã‚‹ã€‚                                         â¡ï¸  å¤šãã®åˆ©ç”¨è€…ãŒåŒæ™‚ä¸¦è¡Œçš„ã«ArgoCDã‚’æ“ä½œã™ã‚‹çŠ¶æ³ã«ãªã‚Šã«ãã‘ã‚Œã°ã€å¥ªã„åˆã„ã‚‚èµ·ã“ã‚‰ãªã„ã€‚                ä¿¡é ¼æ€§                 ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ä»®æƒ³ClusterãŒç‹¬ç«‹ã—ã¦ãŠã‚Šã€ä»–ã®ä»®æƒ³Clusterã‹ã‚‰éšœå®³ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã€‚                                                                                    -                                                                                                         â¡ï¸  -                                                                                      04-04. Namespaces as-a-Service å®Ÿè·µNamespaceãƒ†ãƒŠãƒ³ãƒˆã¯ã€Namespaces as-a-Serviceãªãƒ†ãƒŠãƒ³ãƒˆã®å®Ÿè·µã§ã‚ã‚Šã€Namespaceã‚’ãƒ†ãƒŠãƒ³ãƒˆã®å˜ä½ã¨ã—ã¾ã™ã€‚å¾Œè¿°ã® AppProjectãƒ†ãƒŠãƒ³ãƒˆ ã¯äºŒé‡ã®ãƒ†ãƒŠãƒ³ãƒˆã‚’æŒã¡ã€Namespaceãƒ†ãƒŠãƒ³ãƒˆã‚‚å…¼ã­ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã“ã§ã¯Namespaceãƒ†ãƒŠãƒ³ãƒˆã®è§£èª¬ã¯çœç•¥ã—ã¾ã™ã€‚04-05. ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆã®å®Ÿè·µAppProjectãƒ†ãƒŠãƒ³ãƒˆAppProjectãƒ†ãƒŠãƒ³ãƒˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆã®å®Ÿè·µã§ã‚ã‚Šã€Namespaceã¨AppProjectã‚’ãƒ†ãƒŠãƒ³ãƒˆã®å˜ä½ã¨ã—ã¾ã™ã€‚AppProjectãƒ†ãƒŠãƒ³ãƒˆã¯ã€äºŒé‡ã®ãƒ†ãƒŠãƒ³ãƒˆ (ç¬¬ä¸€ãƒ†ãƒŠãƒ³ãƒˆã«Namespaceã€ç¬¬äºŒãƒ†ãƒŠãƒ³ãƒˆã«è¤‡æ•°ã®AppProject) ã‚’æŒã¡ã€\"ã‚ã‚‰ã‚†ã‚‹é¢ã‹ã‚‰\" ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¶é™ã—ã¾ã™ã€‚ç‰¹ã«ã€AppProjectã¯Namespaceã‚¹ã‚³ãƒ¼ãƒ—ãªã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€è‡ªèº«ã«æ‰€å±ã™ã‚‹Applicationã‚’ä¸€æ‹¬ã—ã¦åˆ¶é™ã—ã¾ã™ã€‚apiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  name: foo-tenant  namespace: foo  # è‡ªèº«ã«æ‰€å±ã™ã‚‹Applicationã‚’åˆ¶é™ã™ã‚‹spec: ...apiVersion: argoproj.io/v1alpha1kind: Applicationmetadata:  name: infra-application  namespace: foospec:  # foo-tenantã«æ‰€å±ã™ã‚‹  project: foo-tenant  ...Argo CD in Practice: The GitOps way of managing cloud-native applications (English Edition)Projects - Argo CD - Declarative GitOps CD for Kubernetesâ–¶ ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ä»•æ§˜ã«ã¤ã„ã¦.spec.scopeã‚­ãƒ¼ã‹ã‚‰ã‚‚åˆ†ã‹ã‚‹é€šã‚Šã€AppProjectã¯Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãªã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€ä»»æ„ã®Namespaceã‚’è¨­å®šã§ãã¾ã™ğŸ‘apiVersion: apiextensions.k8s.io/v1kind: CustomResourceDefinitionmetadata:  labels:    app.kubernetes.io/name: appprojects.argoproj.io    app.kubernetes.io/part-of: argocd  name: appprojects.argoproj.iospec:  group: argoproj.io  names:    kind: AppProject    ...  # Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãªã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹ã¨ã‚ã‹ã‚‹  scope: Namespaced...  argo-cd/manifests/crds/appproject-crd.yaml at master Â· argoproj/argo-cd Â· GitHubExtend the Kubernetes API with CustomResourceDefinitions | KubernetesCLãƒ¢ãƒ¼ãƒ‰ vs. NSãƒ¢ãƒ¼ãƒ‰ArgoCDã«ã¯ã€Clusterã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ ã¨ Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ (ä»¥é™ã€\"CLãƒ¢ãƒ¼ãƒ‰\" ã¨ \"NSãƒ¢ãƒ¼ãƒ‰\") ãŒã‚ã‚Šã¾ã™ã€‚ã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã®è¨­è¨ˆæ–¹æ³•ãŒç•°ãªã‚Šã¾ã™ã€‚æœ¬ç« ã§ã¯ã€CLãƒ¢ãƒ¼ãƒ‰ã¨NSãƒ¢ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã§AppProjectãƒ†ãƒŠãƒ³ãƒˆã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for Kubernetes05. CLãƒ¢ãƒ¼ãƒ‰ãªArgoCDCLãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¨ã¯CLãƒ¢ãƒ¼ãƒ‰ãªArgoCDã®å ´åˆã€å„ãƒ†ãƒŠãƒ³ãƒˆé–“ã§å…±æœ‰ã®ArgoCDã‚’ç®¡ç†ã—ã¾ã™ä¾‹ãˆã°ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã¨ã—ã¦ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã®Namespace (fooã€barã€baz) ã¨AppProject (fooã€barã€baz) ã‚’ç”¨æ„ã—ã¾ã™ã€‚åˆ¥é€”ã€ArgoCDå°‚ç”¨ã®Namespace (argocd) ã‚’ç”¨æ„ã—ã€ã“ã“ã«é–¢é€£ã™ã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ (ä¾‹ï¼šConfigMap) ã‚’é…ç½®ã—ã¾ã™ã€‚å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ã¯ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆå†…ã®Applicationã‚’æ“ä½œã—ã€æ­£ã—ã„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for KubernetesArgoCD: Multi-tenancy strategy. Introduction | by Geoffrey | MediumAppProjectNSãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ã€AppProjectã«æ‰€å±ã™ã‚‹Applicationã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¶é™ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  name: foo-tenant  namespace: foospec:  destinations:    # ArgoCDç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    # App Of Appsãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã«ä½¿ç”¨ã™ã‚‹    - namespace: foo      server: \"https://kubernetes.default.svc\"    # ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    - namespace: \"*\"      server: https://foo-cluster.gr7.ap-northeast-1.eks.amazonaws.com  # CLãƒ¢ãƒ¼ãƒ‰ã§ã¯è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹  sourceNamespaces:    - fooApplicationã‚’æ“ä½œã™ã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ç„¡èªå¯ã®Namespaceã‚„Clusterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã§ããªã„ã‚ˆã†ã«ã€.spec.destinationã‚­ãƒ¼ã§åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚ä¸€æ–¹ã§å¾Œè¿°ã®NSãƒ¢ãƒ¼ãƒ‰ã¨ã¯ç•°ãªã‚Šã€CLãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¯ä»»æ„ã®Namespaceã®Applicationã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ãã®ãŸã‚ã€.spec.sourceNamespacesã‚­ãƒ¼ã§ã€ç‰¹å®šã®Namespaceã®ApplicationãŒã“ã®AppProjectã«æ‰€å±ã§ããªã„ã‚ˆã†ã«ã€Applicationã®Namespaceã‚’åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for KubernetesProjects - Argo CD - Declarative GitOps CD for KubernetesArgoCDã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ConfigMap (argocd-cmd-params-cm)NSãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ã€argocd-cmd-params-cmã§ã¯ã€ArgoCDã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠã®å¼•æ•°ã‚’è¨­å®šã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-cmd-params-cm  # å°‚ç”¨ã®Namespaceã‚’è¨­å®šã™ã‚‹  namespace: argocddata:  # CLãƒ¢ãƒ¼ãƒ‰ã§ã¯è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹  # å…¨ã¦ã®Namespaceã‚’æŒ‡å®šã—ãŸã„å ´åˆã¯ã€ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹  application.namespaces: \"*\".application.namespacesã‚­ãƒ¼ã¯ã€argocd-serverã¨application-controllerã®--application-namespacesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ç›¸å½“ã—ã¾ã™ã€‚ä¸€æ–¹ã§ã®å¾Œè¿°ã®NSãƒ¢ãƒ¼ãƒ‰ã¨ã¯ç•°ãªã‚Šã€CLãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¯ä»»æ„ã®Namespaceã®Applicationã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚--application-namespacesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ä»»æ„ã®Namespaceã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®èªå¯ã‚’è¨­å®šã§ãã¾ã™ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for Kubernetesâ–¶ --application-namespacesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¨­å®šæ–¹æ³•ã«ã¤ã„ã¦argocd-cmd-params-cmã®ä»£ã‚ã‚Šã«ã€ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«Podã«å¼•æ•°ã‚’ç›´æ¥æ¸¡ã—ã¦ã‚‚è‰¯ã„ã§ã™ğŸ™†ğŸ»â€ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: v1kind: Podmetadata:  name: argocd-server  namespace: argocdspec:  containers:    - name: argocd-server      image: quay.io/argoproj/argocd:latest      args:        - /usr/local/bin/argocd-server        # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã®å¼•æ•°ã¨ã—ã¦        - --application-namespaces=\"*\"  ...apiVersion: v1kind: Podmetadata:  name: argocd-application-controller  namespace: argocdspec:  containers:    - name: argocd-application-controller      image: quay.io/argoproj/argocd:latest      args:        - /usr/local/bin/argocd-application-controller        # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã®å¼•æ•°ã¨ã—ã¦        - --application-namespaces=\"*\"  ...  `argocd-application-controller` Command Reference - Argo CD - Declarative GitOps CD for Kubernetes`argocd-server` Command Reference - Argo CD - Declarative GitOps CD for Kubernetesãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm)NSãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ã€argocd-rbac-cmã§ã¯ã€Applicationã‚’æ“ä½œã™ã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ç„¡èªå¯ã®AppProjectã‚„Namespaceã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«åˆ¶é™ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-rbac-cm  # å°‚ç”¨ã®Namespaceã‚’è¨­å®šã™ã‚‹  namespace: argocddata:  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ­ãƒ¼ãƒ«  # @see https://github.com/argoproj/argo-cd/blob/master/assets/builtin-policy.csv#L9-L16  policy.default: role:readonly  policy.csv: |    p, role:foo, *, *, foo/*/*, allow    p, role:bar, *, *, bar/*/*, allow    p, role:baz, *, *, baz/*/*, allow    g, foo-team, role:foo    g, bar-team, role:bar    g, baz-team, role:baz  scopes: \"[groups]\"èªè¨¼æ¸ˆã¿ã‚°ãƒ«ãƒ¼ãƒ— (foo-teamã€bar-teamã€baz-team) ã«å¯¾ã—ã¦ã€ç„¡èªå¯ã®AppProject (fooã€barã€baz) ã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«ã€èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚â–¶ AppProjectã®èªå¯å®šç¾©ã®è¨˜æ³•ã«ã¤ã„ã¦Casbin ã®è¨˜æ³•ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»Šå›ã®å®Ÿè£…ä¾‹ã§ä½¿ç”¨ã—ãŸp (ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³) ã¨g (ã‚°ãƒ«ãƒ¼ãƒ—) ã§ã¯ã€ä»¥ä¸‹ã‚’è¨˜æ³•ã‚’ä½¿ç”¨ã§ãã¾ã™ğŸ‘apiVersion: v1kind: ConfigMapmetadata:  name: argocd-rbac-cm  namespace: argocddata:  policy.default: role:readonly  policy.csv: |    # ãƒ­ãƒ¼ãƒ«ã¨ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹    p, role:\u003cãƒ­ãƒ¼ãƒ«å\u003e, \u003cKubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡\u003e, \u003cã‚¢ã‚¯ã‚·ãƒ§ãƒ³å\u003e, \u003cAppProjectå\u003e/\u003cApplicationã®Namespaceå\u003e/\u003cApplicationå\u003e, \u003cè¨±å¦\u003e    # èªè¨¼æ¸ˆã¿ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ­ãƒ¼ãƒ«ã‚’ç´ä»˜ã‘ã‚‹    g, \u003cã‚°ãƒ«ãƒ¼ãƒ—å\u003e, role:\u003cãƒ­ãƒ¼ãƒ«å\u003e  scopes: \"[groups]\"RBAC Configuration - Argo CD - Declarative GitOps CD for Kubernetesã‚ªã‚¹ã‚¹ãƒ¡ã—ãªã„ç†ç”±CLãƒ¢ãƒ¼ãƒ‰ãªArgoCDã®AppProjectãƒ†ãƒŠãƒ³ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–ã‚‚è€ƒæ…®ã—ã¦ã€ç‹¬æ–­ã¨åè¦‹ã§ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã›ã‚“ã§ã—ãŸã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                   ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                                                                                                                                                      ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                                                                                            æ‹¡å¼µæ€§                 ãƒ†ãƒŠãƒ³ãƒˆã‚’å¢—ã‚„ã™ãŸã‚ã«Namespaceã¨AppProjectã‚’ç”¨æ„ã™ã‚‹ã ã‘ã§ã‚ˆãã€ä½œæ¥­é‡ãŒå°‘ãªã„ã€‚             -                                                                                                                                                                                                                                â¡ï¸  -                                                                                                                                                                    å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        NetworkPolicyã§Namespaceé–“ã®åå‰è§£æ±ºã‚’ä¸å¯èƒ½ã«ã™ã‚Œã°ã€ä»–ã®Namespaceã‹ã‚‰ã®é€šä¿¡ã‚’é®æ–­ã§ãã‚‹ã€‚   -                                                                                                                                                                                                                                â¡ï¸  -                                                                                                                                                                             ä¿å®ˆæ€§                 ArgoCDç”¨Clusterã®ç®¡ç†è€…ãŒå˜ä¸€ã®Clusterã‚’ä¿å®ˆã™ã‚Œã°ã‚ˆã„ã€‚(ä¾‹ï¼šã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€æ©Ÿèƒ½ä¿®æ­£ãªã©)  AppProjectã¯Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãªã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ãŸã‚ã€Clusterã‚¹ã‚³ãƒ¼ãƒ—ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã¨å…±æœ‰ã—ãªã„ã¨ã„ã‘ãªã„ã€‚ãã®ãŸã‚ã€Clusterã‚¹ã‚³ãƒ¼ãƒ—ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ (ç‰¹ã«CRD) ã®å¤‰æ›´ã¯å…¨ã¦ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ã€‚  â¡ï¸  ArgoCDã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ (CRDã®å¤‰æ›´æ™‚) ã¯ã€ã¤ã„ã§ã«Kubernetesã‚‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã„ã€‚æ–°ã—ã„Clusterã‚’åˆ¥ã«ä½œæˆã—ã€ãã“ã§æ–°ArgoCDã‚’ä½œæˆã™ã‚Œã°ä¸€çŸ³äºŒé³¥ã§ã‚ã‚‹ã€‚                 æ€§èƒ½                  -                                                                                             Clusterã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã¨å¥ªã„åˆã†ã“ã¨ã«ãªã‚‹ã€‚                                                                                                                                                                â¡ï¸  å¤šãã®åˆ©ç”¨è€…ãŒåŒæ™‚ä¸¦è¡Œçš„ã«ArgoCDã‚’æ“ä½œã™ã‚‹çŠ¶æ³ã«ãªã‚Šã«ãã‘ã‚Œã°ã€å¥ªã„åˆã„ã‚‚èµ·ã“ã‚‰ãªã„ã€‚                                                                                        ä¿¡é ¼æ€§                 -                                                                                             Clusterã¾ãŸã¯ArgoCDã§éšœå®³ãŒèµ·ã“ã‚‹ã¨ã€ã“ã‚Œã¯å…¨ã¦ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ã€‚                                                                                                                                                            â¡ï¸  ä»£ã‚ã‚Šã«Nodeã‚„ArgoCDã‚’ååˆ†ã«å†—é•·åŒ–ã—ã¦å¯ç”¨æ€§ã‚’é«˜ã‚ã‚Œã°ã€å½±éŸ¿ã‚’ç·©å’Œã§ãã‚‹ã€‚ãŸã ã€ãã‚‚ãã‚‚ã®å½±éŸ¿ç¯„å›²ãŒå¤§ãã™ãã‚‹ğŸ˜­                                           05-02. NSãƒ¢ãƒ¼ãƒ‰ãªArgoCD - â˜…â˜…NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¨ã¯NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã®å ´åˆã€å‰è¿°ã®CLãƒ¢ãƒ¼ãƒ‰ã¨ã¯ç•°ãªã‚Šã€å„AppProjectãƒ†ãƒŠãƒ³ãƒˆé–“ã§ArgoCDã‚’å æœ‰ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã¨ã—ã¦ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã®Namespace (fooã€barã€baz) ã¨AppProject (fooã€barã€baz) ã‚’ç”¨æ„ã—ã¾ã™ã€‚å„AppProjectãƒ†ãƒŠãƒ³ãƒˆã«ã€ArgoCDã¨é–¢é€£ã™ã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ (ä¾‹ï¼šConfigMap) ã‚’é…ç½®ã—ã¾ã™ã€‚å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒ¼ãƒ ã¯ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆå†…ã®Applicationã‚’æ“ä½œã—ã€æ­£ã—ã„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for KubernetesAppProjectCLãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ã€AppProjectã«æ‰€å±ã™ã‚‹Applicationã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¶é™ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  name: foo-tenant  namespace: foospec:  destinations:    # ArgoCDç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    # App Of Appsãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã«ä½¿ç”¨ã™ã‚‹    - namespace: foo      server: \"https://kubernetes.default.svc\"    # ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    - namespace: \"*\"      server: https://foo-cluster.gr7.ap-northeast-1.eks.amazonaws.com# NSãƒ¢ãƒ¼ãƒ‰ã§ã¯è¨­å®šãŒä¸è¦ã§ã‚ã‚‹# sourceNamespaces:#   - fooApplicationã‚’æ“ä½œã™ã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ç„¡èªå¯ã®Namespaceã‚„Clusterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã§ããªã„ã‚ˆã†ã«ã€.spec.destinationã‚­ãƒ¼ã§åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚å‰è¿°ã®CLãƒ¢ãƒ¼ãƒ‰ã¨ã¯ç•°ãªã‚Šã€NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¯è‡ªèº«ãŒæ‰€å±ã™ã‚‹Namespaceã®Applicationã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ãã®ãŸã‚ã€.spec.sourceNamespacesã‚­ãƒ¼ã§ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¶é™ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for KubernetesProjects - Argo CD - Declarative GitOps CD for KubernetesArgoCDã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ConfigMap (argocd-cmd-params-cm)CLãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ã€argocd-cmd-params-cmã§ã¯ã€ArgoCDã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠã®å¼•æ•°ã‚’è¨­å®šã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-cmd-params-cm  namespace: foodata:# NSãƒ¢ãƒ¼ãƒ‰ã§ã¯è¨­å®šãŒä¸è¦ã§ã‚ã‚‹# application.namespaces: \"*\"å‰è¿°ã®é€šã‚Šã€.application.namespacesã‚­ãƒ¼ã¯ã€argocd-serverã¨application-controllerã®--application-namespacesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ç›¸å½“ã—ã¾ã™ã€‚å‰è¿°ã®CLãƒ¢ãƒ¼ãƒ‰ã¨ã¯ç•°ãªã‚Šã€NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã¯è‡ªèº«ãŒæ‰€å±ã™ã‚‹Namespaceã®Applicationã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãã®ãŸã‚ã€.application.namespacesã‚­ãƒ¼ã§Namespaceã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã‚‚ã¡ã‚ã‚“ã€Podã®ã‚³ãƒ³ãƒ†ãƒŠå¼•æ•°ã«ã‚‚è¨­å®šã¯ä¸è¦ã§ã™ã€‚Applications in any namespace - Argo CD - Declarative GitOps CD for Kubernetesãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm)CLãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ã€argocd-rbac-cmã§ã¯ã€Applicationã‚’æ“ä½œã™ã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ç„¡èªå¯ã®AppProjectã‚„Namespaceã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«åˆ¶é™ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-rbac-cm  namespace: foodata:  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ­ãƒ¼ãƒ«  # @see https://github.com/argoproj/argo-cd/blob/master/assets/builtin-policy.csv#L9-L16  policy.default: role:readonly  policy.csv: |    p, role:app, *, *, app/*/*, allow    p, role:infra, *, *, infra/*/*, allow    g, app-team, role:app    g, infra-team, role:infra  scopes: \"[groups]\"èªè¨¼æ¸ˆã¿ã‚°ãƒ«ãƒ¼ãƒ— (app-teamã€infra-team) ã«å¯¾ã—ã¦ã€ç„¡èªå¯ã®AppProject (appã€infra) ã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«ã€èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã®AppProjectãƒ†ãƒŠãƒ³ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–ã‚‚è€ƒæ…®ã—ã¦ã€ç‹¬æ–­ã¨åè¦‹ã§ ç‰¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ ã—ã¾ã—ãŸã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                  ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                                                                                                                                                      ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                                                                                            æ‹¡å¼µæ€§                 ãƒ†ãƒŠãƒ³ãƒˆã‚’å¢—ã‚„ã™ãŸã‚ã«Namespaceã¨AppProjectã‚’ç”¨æ„ã™ã‚‹ã ã‘ã§ã‚ˆãã€ä½œæ¥­é‡ãŒå°‘ãªã„ã€‚            -                                                                                                                                                                                                                                â¡ï¸  -                                                                                                                                                                    å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        NetworkPolicyã§Namespaceé–“ã®åå‰è§£æ±ºã‚’ä¸å¯èƒ½ã«ã™ã‚Œã°ã€ä»–ã®Namespaceã‹ã‚‰ã®é€šä¿¡ã‚’é®æ–­ã§ãã‚‹ã€‚  -                                                                                                                                                                                                                                â¡ï¸  -                                                                                                                                                                             ä¿å®ˆæ€§                 å˜ä¸€ã®Clusterã‚’ä¿å®ˆã™ã‚Œã°ã‚ˆã„ã€‚(ä¾‹ï¼šã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€æ©Ÿèƒ½ä¿®æ­£ãªã©)             AppProjectã¯Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãªã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ãŸã‚ã€Clusterã‚¹ã‚³ãƒ¼ãƒ—ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã¨å…±æœ‰ã—ãªã„ã¨ã„ã‘ãªã„ã€‚ãã®ãŸã‚ã€Clusterã‚¹ã‚³ãƒ¼ãƒ—ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ (ç‰¹ã«CRD) ã®å¤‰æ›´ã¯å…¨ã¦ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ã€‚  â¡ï¸  ArgoCDã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ (CRDã®å¤‰æ›´æ™‚) ã¯ã€ã¤ã„ã§ã«Kubernetesã‚‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã„ã€‚æ–°ã—ã„Clusterã‚’åˆ¥ã«ä½œæˆã—ã€ãã“ã§æ–°ArgoCDã‚’ä½œæˆã™ã‚Œã°ä¸€çŸ³äºŒé³¥ã§ã‚ã‚‹ã€‚                 æ€§èƒ½                  -                                                                                            Clusterã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒªã‚½ãƒ¼ã‚¹ã‚’ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã¨å¥ªã„åˆã†ã“ã¨ã«ãªã‚‹ã€‚                                                                                                                                                                â¡ï¸  å¤šãã®åˆ©ç”¨è€…ãŒåŒæ™‚ä¸¦è¡Œçš„ã«ArgoCDã‚’æ“ä½œã™ã‚‹çŠ¶æ³ã«ãªã‚Šã«ãã‘ã‚Œã°ã€å¥ªã„åˆã„ã‚‚èµ·ã“ã‚‰ãªã„ã€‚                                                                                        ä¿¡é ¼æ€§                 ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ArgoCDã‚’å æœ‰ã—ã¦ãŠã‚Šã€ä»–ã®ArgoCDã‹ã‚‰éšœå®³ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã€‚                     Clusterã§éšœå®³ãŒèµ·ã“ã‚‹ã¨ã€ã“ã‚Œã¯å…¨ã¦ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ã€‚                                                                                                                                                                        â¡ï¸  ä»£ã‚ã‚Šã«ã€Nodeã‚’ååˆ†ã«å†—é•·åŒ–ã—ã¦å¯ç”¨æ€§ã‚’é«˜ã‚ã‚‹ã€‚ã„ãšã‚Œã‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§éšœå®³ãŒèµ·ã“ã£ã¦ã‚‚ã€æ­£å¸¸ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ArgoCDãŒç¨¼åƒã§ãã‚‹ã€‚                         AppProjectãƒ†ãƒŠãƒ³ãƒˆä¾‹ã®ä¸€è¦§NSãƒ¢ãƒ¼ãƒ‰ãªArgoCDã‚’æ¡ç”¨ã™ã‚‹å ´åˆã€AppProjectãƒ†ãƒŠãƒ³ãƒˆä¾‹ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚å‰è¿°ã®é€šã‚Šã€AppProjectãƒ†ãƒŠãƒ³ãƒˆãŒäºŒé‡ãƒ†ãƒŠãƒ³ãƒˆ (ç¬¬ä¸€ãƒ†ãƒŠãƒ³ãƒˆã«Namespaceã€ç¬¬äºŒãƒ†ãƒŠãƒ³ãƒˆã«è¤‡æ•°ã®AppProject) ã‚’æŒã¤ã“ã¨ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚ãªãŠã€ã‚ªã‚¹ã‚¹ãƒ¡ã™ã‚‹ã‚‚ã®ã‚’ â˜… ã¨ã—ã¦ã„ã¾ã™ã€‚    ãƒ†ãƒŠãƒ³ãƒˆä¾‹(äºŒé‡ãƒ†ãƒŠãƒ³ãƒˆ)    ã‚ªã‚¹ã‚¹ãƒ¡  Namespace(ç¬¬ä¸€ãƒ†ãƒŠãƒ³ãƒˆ)    AppProject(ç¬¬äºŒãƒ†ãƒŠãƒ³ãƒˆ)  ãƒ†ãƒŠãƒ³ãƒˆä¾‹1      ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥      ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥          ãƒ†ãƒŠãƒ³ãƒˆä¾‹2      ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥      ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥      â˜…    ãƒ†ãƒŠãƒ³ãƒˆä¾‹3      ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥      ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥      â˜…â˜…    â–¶ Namespaceã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦\"ç®¡ç†ãƒãƒ¼ãƒ åˆ¥\" (ä»Šå›ã§ã„ã†ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥) ã¨ã„ã†Namespaceã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€æ§˜ã€…ãªè‘—åãªæ›¸ç±ã‚„ãƒ–ãƒ­ã‚°ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ğŸ‘€  https://www.amazon.co.jp/dp/1617293725Kubernetes best practices: Specifying Namespaces in YAML | Google Cloud Blogãƒ†ãƒŠãƒ³ãƒˆä¾‹1Namespace (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥)ã€AppProject (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥)ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒ (Devç’°å¢ƒã€Tesç’°å¢ƒ) åˆ¥ã«ç®¡ç†ã•ã‚ŒãŸClusterãŒã„ã‚‹çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ã“ã®å ´åˆã«ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥ã«Namespace (devã€tes) ã¨AppProject (devã€tes) ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã‚ªã‚¹ã‚¹ãƒ¡ã—ãªã‹ã£ãŸç†ç”±ãƒ†ãƒŠãƒ³ãƒˆä¾‹1ã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ç‹¬æ–­ã¨åè¦‹ã§ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã›ã‚“ã§ã—ãŸã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                                                                     ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                                                                   ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                       æ‹¡å¼µæ€§                 -                                                                                                                                               ArgoCDã®Podæ•°ãŒå¤šããªã‚Šã€å°†æ¥çš„ã«Nodeå½“ãŸã‚Šã®Podã‚„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸Šé™æ•°ã«ã²ã£ã‹ã‹ã‚Šã‚„ã™ã„ã€‚ãã®æ™‚ç‚¹ã§ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã®å¢—ã‚„ã›ãªããªã‚‹ã€‚  â¡ï¸  ä¾‹ãˆã°AWS EKSã®å ´åˆã€Nodeæ•°ã‚’å¢—ã‚„ã—ãŸã‚Šã€Nodeã®ã‚¹ãƒšãƒƒã‚¯ã‚’ä¸Šã’ã‚‹ã€‚ãŸã ã€ãŠé‡‘ãŒã‹ã‹ã‚‹ğŸ˜­       å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm) ã‚’ä½¿ç”¨ã™ã‚Œã°ã€ç„¡èªå¯ã®å®Ÿè¡Œç’°å¢ƒåˆ¥AppProjectã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«åˆ¶é™ã§ãã‚‹ã€‚  -                                                                                                                                             â¡ï¸  -                                                                                                        ä¿å®ˆæ€§                 ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒã«é–¢ã™ã‚‹ApplicationãŒå…±å­˜ã—ã¦ãŠã‚‰ãšã€åˆ¥ã®argocd-serverã‹ã‚‰æ“ä½œã™ã‚‹ã“ã¨ã«ãªã‚‹ãŸã‚ã€å®Ÿè¡Œç’°å¢ƒé–“ã®é¸æŠãƒŸã‚¹ãŒèµ·ã“ã‚Šã«ãã„ã€‚            -                                                                                                                                             â¡ï¸  -                                                                                         ãƒ†ãƒŠãƒ³ãƒˆä¾‹2 - â˜…Namespace (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥)ã€AppProject (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥)ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒ (Devç’°å¢ƒã€Tesç’°å¢ƒ) åˆ¥ã«ç®¡ç†ã•ã‚ŒãŸClusterãŒã„ã‚‹çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã«Namespace (fooã€bar) ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒåˆ¥ã«AppProject (devã€tes) ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±ãƒ†ãƒŠãƒ³ãƒˆä¾‹2ã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ç‹¬æ–­ã¨åè¦‹ã§ ã‚ªã‚¹ã‚¹ãƒ¡ ã—ã¾ã—ãŸã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                                                ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                                                                           ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                 æ‹¡å¼µæ€§                 ArgoCDã®Podæ•°ãŒå¤šããªã‚Šã€å°†æ¥çš„ã«Nodeå½“ãŸã‚Šã®Podã‚„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸Šé™æ•°ã«ã²ã£ã‹ã‹ã‚Šã«ãã„ã€‚                                   -                                                                                                                                                     â¡ï¸  -                                                                                         å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm) ã‚’ä½¿ç”¨ã™ã‚Œã°ã€ç„¡èªå¯ã®å®Ÿè¡Œç’°å¢ƒåˆ¥AppProjectã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«åˆ¶é™ã§ãã‚‹ã€‚  -                                                                                                                                                     â¡ï¸  -                                                                                                  ä¿å®ˆæ€§                 -                                                                                                                          ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒã«é–¢ã™ã‚‹ApplicationãŒå…±å­˜ã—ã¦ãŠã‚Šã€åŒã˜argocd-server (ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰) ã‹ã‚‰æ“ä½œã™ã‚‹ã“ã¨ã«ãªã‚‹ãŸã‚ã€å®Ÿè¡Œç’°å¢ƒé–“ã®é¸æŠãƒŸã‚¹ãŒèµ·ã“ã‚Šã‚„ã™ã„ã€‚  â¡ï¸  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã¯Applicationã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒã‚ã‚‹ãŸã‚ã€é¸æŠãƒŸã‚¹ã‚’å›é¿ã§ãã‚‹ã€‚ ãƒ†ãƒŠãƒ³ãƒˆä¾‹3 - â˜…â˜…Namespace (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥)ã€AppProject (ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥)ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒ (Devç’°å¢ƒã€Tesç’°å¢ƒ) åˆ¥ã«ç®¡ç†ã•ã‚ŒãŸClusterãŒã„ã‚‹çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã«Namespace (fooã€bar) ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥ã«AppProject (appã€infra) ã‚’ç”¨æ„ã—ã¾ã™ã€‚ç‰¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸç†ç”±ãƒ†ãƒŠãƒ³ãƒˆä¾‹3ã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ç‹¬æ–­ã¨åè¦‹ã§ ç‰¹ã«ã‚ªã‚¹ã‚¹ãƒ¡ ã—ã¾ã—ãŸã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                                                                       ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                                                                           ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®å›é¿ç­–                                                                                 æ‹¡å¼µæ€§                 ArgoCDã®Podæ•°ãŒå¤šããªã‚Šã€å°†æ¥çš„ã«Nodeå½“ãŸã‚Šã®Podã‚„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸Šé™æ•°ã«ã²ã£ã‹ã‹ã‚Šã«ãã„ã€‚                                                          -                                                                                                                                                     â¡ï¸  -                                                                                         å®‰å…¨æ€§(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)        ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ConfigMap (argocd-rbac-cm) ã‚’ä½¿ç”¨ã™ã‚Œã°ã€ç„¡èªå¯ã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥AppProjectã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã§ããªã„ã‚ˆã†ã«åˆ¶é™ã§ãã‚‹ã€‚  -                                                                                                                                                     â¡ï¸  -                                                                                                  ä¿å®ˆæ€§                 -                                                                                                                                                 ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒã«é–¢ã™ã‚‹ApplicationãŒå…±å­˜ã—ã¦ãŠã‚Šã€åŒã˜argocd-server (ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰) ã‹ã‚‰æ“ä½œã™ã‚‹ã“ã¨ã«ãªã‚‹ãŸã‚ã€å®Ÿè¡Œç’°å¢ƒé–“ã®é¸æŠãƒŸã‚¹ãŒèµ·ã“ã‚Šã‚„ã™ã„ã€‚  â¡ï¸  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã¯Applicationã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒã‚ã‚‹ãŸã‚ã€é¸æŠãƒŸã‚¹ã‚’å›é¿ã§ãã‚‹ã€‚ 06. ã©ã®ã‚ˆã†ãªèª¤ã£ãŸæ“ä½œã‚’é˜²ã„ã§ãã‚Œã‚‹ã®ã‹ãã‚ãã‚è§£èª¬ã‚’èª­ã‚€ã®ãŒã—ã‚“ã©ã„æ–¹ãŒã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã€å›ãŒãƒƒã€æ³£ãã¾ã§ã€è§£èª¬ã‚’ã‚„ã‚ãªã„ãƒƒï¼ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã¨Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ãŒãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã©ã®ã‚ˆã†ã«åˆ¶é™ã™ã‚‹ã®ã‹ã«ã¤ã„ã¦ã€ä¾‹ã‚’æŒ™ã’ã¦è§£èª¬ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€ä»¥ä¸‹ã®AppProjectã‚’ä½œæˆã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚AppProjectãƒ†ãƒŠãƒ³ãƒˆãŒäºŒé‡ãƒ†ãƒŠãƒ³ãƒˆ (ç¬¬ä¸€ãƒ†ãƒŠãƒ³ãƒˆã«Namespaceã€ç¬¬äºŒãƒ†ãƒŠãƒ³ãƒˆã«è¤‡æ•°ã®AppProject) ã‚’æŒã¤ã“ã¨ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚apiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  # appãƒãƒ¼ãƒ   name: app  namespace: foospec:  destinations:    # ArgoCDç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    # Namespace (foo) ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨±å¯ã™ã‚‹    - namespace: foo      server: \"https://kubernetes.default.svc\"      # ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹      # Namespace (app) ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨±å¯ã™ã‚‹    - namespace: app      server: https://foo-cluster.gr7.ap-northeast-1.eks.amazonaws.comapiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  # infraãƒãƒ¼ãƒ   name: infra  namespace: foospec:  destinations:    # ArgoCDç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    # Namespace (foo) ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨±å¯ã™ã‚‹    - namespace: foo      server: \"https://kubernetes.default.svc\"    # ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«é–¢ã™ã‚‹èªå¯ã‚’è¨­å®šã™ã‚‹    # Namespace (infra) ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨±å¯ã™ã‚‹    - namespace: infra      server: https://foo-cluster.gr7.ap-northeast-1.eks.amazonaws.comãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤åˆ¶é™ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒ (Devç’°å¢ƒã€Tesç’°å¢ƒ) åˆ¥ã«ç®¡ç†ã•ã‚ŒãŸClusterãŒã„ã‚‹çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã«Namespace (foo) ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥ã«AppProject (appã€infra) ã‚’ç”¨æ„ã—ã¾ã™ã€‚AppProjectãƒ†ãƒŠãƒ³ãƒˆã¯ã€ä¾‹ãˆã° èµ¤ç·š ã®æ–¹æ³•ã§ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¶é™ã—ã¾ã™ã€‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹å ´åˆãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã¯ã“ã‚Œã‚’åˆ¶é™ã—ã¾ã›ã‚“ã€‚(1) argocd-serverã¯ã€argocd-cmd-params-cmã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹Namespaceã‚’å–å¾—ã—ã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-cmd-params-cm  namespace: foodata:# è¨­å®šã—ãªã„ã“ã¨ã§ã€argocd-serverã¯åŒã˜Namespaceã«ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚‹ã€‚# application.namespaces: \"*\"(2) fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®infraãƒãƒ¼ãƒ ãŒã€argocd-serverã‚’æ“ä½œã—ã¾ã™ã€‚(3) argocd-serverã¯ã€argocd-rbac-cmã‹ã‚‰Applicationæ“ä½œã«é–¢ã™ã‚‹èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å–å¾—ã—ã¾ã™apiVersion: v1kind: ConfigMapmetadata:  name: argocd-rbac-cm  namespace: foodata:  policy.default: role:readonly  policy.csv: |    p, role:app, *, *, app/*/*, allow    p, role:infra, *, *, infra/*/*, allow    g, app-team, role:app    g, infra-team, role:infra  scopes: \"[groups]\"(4) infraãƒãƒ¼ãƒ ã¯ã€èªå¯ã•ã‚ŒãŸAppProjectã«æ‰€å±ã™ã‚‹Applicationã‚’æ“ä½œã—ã¾ã™ã€‚(5) infraãƒãƒ¼ãƒ ã¯ã€Devç’°å¢ƒã®fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã®Namespace (infra) ã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚(ğŸš«åˆ¶é™ä¾‹1) ç„¡èªå¯ã®Namespaceã§Applicationã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ãŸå ´åˆä¾‹ãˆã°ã€fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®infraãƒãƒ¼ãƒ ãŒç„¡èªå¯ã®Namespace (bar) ã§Applicationã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€argocd-serverã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã€ã“ã®æ“ä½œã‚’åˆ¶é™ã—ã¾ã™ã€‚namespace bar is not permitted in project 'infra-team'ç„¡èªå¯ã®Namespaceã§Applicationã‚’ä½œã‚Œã¦ã—ã¾ã†ã¨ã€ãã®Applicationã‹ã‚‰ç„¡èªå¯ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¦ã—ã¾ã„ã¾ã™ğŸ˜ˆargo-cd/test/e2e/app_management_ns_test.go at v2.7.10 Â· argoproj/argo-cd Â· GitHub(ğŸš«åˆ¶é™ä¾‹2) ç„¡èªå¯ã®AppProjectã§Applicationã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ãŸå ´åˆä¾‹ãˆã°ã€fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®infraãƒãƒ¼ãƒ ãŒã€ç„¡èªå¯ã®AppProject (app) ã§Applicationã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€argocd-serverã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã€ã“ã®æ“ä½œã‚’åˆ¶é™ã—ã¾ã™ã€‚Application referencing project 'app' which does not existä»»æ„ã®AppProjectã§Applicationã‚’ä½œæˆã§ãã¦ã—ã¾ã†ã¨ã€ãã®Applicationã‹ã‚‰ç„¡èªå¯ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¦ã—ã¾ã„ã¾ã™ğŸ˜ˆ(ğŸš«åˆ¶é™ä¾‹3) ç„¡èªå¯ã®Clusterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã—ã‚ˆã†ã¨ã—ãŸå ´åˆä¾‹ãˆã°ã€fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®infraãƒãƒ¼ãƒ ãŒApplicationã‚’æ“ä½œã—ã€ç„¡èªå¯ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Cluster (bar-cluster) ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¨ã—ã¦æŒ‡å®šã—ã‚ˆã†ã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€argocd-serverã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã€ã“ã®æ“ä½œã‚’åˆ¶é™ã—ã¾ã™ã€‚application destination{https://bar-cluster.gr7.ap-northeast-1.eks.amazonaws.com infra} is not permitted in project 'infra-team'ä»»æ„ã®Clusterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã§ãã¦ã—ã¾ã†ã¨ã€Applicationã‹ã‚‰ç„¡èªå¯ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¦ã—ã¾ã„ã¾ã™ğŸ˜ˆargo-cd/util/argo/argo_test.go at v2.7.10 Â· argoproj/argo-cd Â· GitHub(ğŸš«åˆ¶é™ä¾‹4) ç„¡èªå¯ã®Namespaceã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã—ã‚ˆã†ã¨ã—ãŸå ´åˆä¾‹ãˆã°ã€fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®infraãƒãƒ¼ãƒ ãŒApplicationã‚’æ“ä½œã—ã€ç„¡èªå¯ã®Namespace (app) ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã—ã‚ˆã†ã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€argocd-serverã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã€ã“ã®æ“ä½œã‚’åˆ¶é™ã—ã¾ã™ã€‚application destination{https://foo-cluster.gr7.ap-northeast-1.eks.amazonaws.com app} is not permitted in project 'infra-team'ä»»æ„ã®Namespaceã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã«æŒ‡å®šã§ãã¦ã—ã¾ã†ã¨ã€ãã®Applicationã‹ã‚‰ç„¡èªå¯ã®Namespaceã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¦ã—ã¾ã„ã¾ã™ğŸ˜ˆargo-cd/util/argo/argo_test.go at v2.7.10 Â· argoproj/argo-cd Â· GitHubâ–¶ AppProjectã§è¨­å®šã§ãã‚‹èªå¯ã®ç¨®é¡ã«ã¤ã„ã¦argocd-serverã¨application-controllerã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ (.spec.clusterResourceWhitelistã‚­ãƒ¼ã€.spec.namespaceResourceWhitelistã‚­ãƒ¼ãªã©)repo-serverã§ãƒãƒ¼ãƒªãƒ³ã‚°ã§ãã‚‹ãƒªãƒã‚¸ãƒˆãƒª (.spec.sourceReposã‚­ãƒ¼)apiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  name: foo-tenant  namespace: foospec:  clusterResourceWhitelist:    - group: \"*\"      kind: \"*\"  namespaceResourceWhitelist:    - group: \"*\"      kind: \"*\"  sourceRepos:    - \"*\"  ...\"AppProjectãƒ†ãƒŠãƒ³ãƒˆã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ä¸¸ã”ã¨ã®åˆ¶é™\" ã¨ã„ã†è¦³ç‚¹ã§ãƒ†ãƒ¼ãƒãŒç•°ãªã‚‹ãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯è¨€åŠã—ã¾ã›ã‚“ã§ã—ãŸğŸ™‡ğŸ»â€  Projects - Argo CD - Declarative GitOps CD for KubernetesDeclarative Setup - Argo CD - Declarative GitOps CD for Kubernetesã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®Reconciliationåˆ¶é™ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å®Ÿè¡Œç’°å¢ƒ (Devç’°å¢ƒã€Tesç’°å¢ƒ) åˆ¥ã«ç®¡ç†ã•ã‚ŒãŸClusterãŒã„ã‚‹çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã«Namespace (foo) ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ãƒãƒ¼ãƒ åˆ¥ã«AppProject (appã€infra) ã‚’ç”¨æ„ã—ã¾ã™ã€‚AppProjectãƒ†ãƒŠãƒ³ãƒˆã¯ã€ä¾‹ãˆã° èµ¤ç·š ã®æ–¹æ³•ã§ã€ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹application-controllerã®Reconciliationã‚’åˆ¶é™ã—ã¾ã™ã€‚ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’Reconciliationã§ãã‚‹å ´åˆæ­£ã—ã„Namespaceã«å¯¾ã—ã¦Reconciliationã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã¯ã“ã‚Œã‚’åˆ¶é™ã—ã¾ã›ã‚“ã€‚(1) application-controllerã¯ã€argocd-cmd-params-cmã‹ã‚‰è‡ªèº«ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹Namespaceã‚’å–å¾—ã—ã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-cmd-params-cm  namespace: foodata:# è¨­å®šã—ãªã„ã“ã¨ã§ã€application-controllerã¯åŒã˜Namespaceã«ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚‹ã€‚# application.namespaces: \"*\"(2) application-controllerã¯ã€åŒã˜Namespaceã«æ‰€å±ã™ã‚‹ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ã€Reconciliationã‚’å®Ÿè¡Œã—ã¾ã™ã€‚(ğŸš«åˆ¶é™ä¾‹1) ç„¡èªå¯ã®Namespaceã«Reconciliationã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ãŸå ´åˆä¾‹ãˆã°ã€application-controllerãŒReconciliationã®å¯¾è±¡ã¨ã™ã‚‹Namespaceã‚’é¸ã¼ã†ã¨ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€application-controllerã¯å†…éƒ¨ã§æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã€ç„¡èªå¯ã®Namespace (bar) ã¯é¸ã°ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚argo-cd/controller/appcontroller_test.go at v2.7.10 Â· argoproj/argo-cd Â· GitHub07. ãŠã‚ã‚Šã«Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ArgoCDã§ã®ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µã‚’ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¾ã—ãŸã€‚ã‚ã‚‰ã‚†ã‚‹é¢ã‹ã‚‰ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ¶é™ã—ã¦ãã‚Œã‚‹ã€AppProjectãƒ†ãƒŠãƒ³ãƒˆã®ç´ æ™´ã‚‰ã—ã•ãŒä¼ã‚ã‚Šã¾ã—ãŸã§ã—ã‚‡ã†ã‹ã€‚Kubernetesã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ArgoCDã§ã©ã†å®Ÿè·µã™ã‚‹ã¹ãã‹ã€ã«ã¤ã„ã¦å›°ã£ã¦ã„ã‚‹æ–¹ã®åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ğŸ‘è¬è¾æœ¬è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€ç§ãŒå´‡æ‹ã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®æ›¸ç± \"å®Ÿè·µãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ\" ã‹ã‚‰æ‹å€Ÿã—ã¾ã—ãŸğŸ™ã¾ãŸã€ArgoCDã§ã®ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè·µã®åé›†ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®æ–¹ã‹ã‚‰ã®æ„è¦‹ã‚‚å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚@toversus26 ã•ã‚“ã“ã®å ´ã§æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ğŸ™‡ğŸ»â€è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±GitOps Cookbook: Kubernetes Automation in Practice (English Edition)ä½œè€…:Vinto, Natale,Bueno, Alex SotoO'Reilly MediaAmazonGitOps and Kubernetes: Continuous Deployment with Argo CD, Jenkins X, and Fluxä½œè€…:Yuen, Billy,Matyushentsev, Alexander,Ekenstam, Todd,Suen, JesseManning PublicationsAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/08/18/110646","isoDate":"2023-08-18T02:06:46.000Z","dateMiliSeconds":1692324406000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€TerraformğŸ§‘ğŸ»â€ğŸš€ã€‘tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¸ã®é©ç”¨","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Terraformã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹ç›®çš„ã¨ã€ã‚ªã‚¹ã‚¹ãƒ¡ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ (â˜…ã§è¡¨ç¾)Terraformã®ãƒªãƒã‚¸ãƒˆãƒªã‚„ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®è¨­è¨ˆã«ã¤ã„ã¦è¨˜äº‹ã®ã–ã£ãã‚Šã—ãŸå†…å®¹ã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã§ãã¡ã‚ƒã„ã¾ã™ï¼    ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. ãªãœ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹ã®ã‹åˆ†å‰²ã—ãªã‹ã£ãŸå ´åˆåˆ†å‰²ã—ãŸæ–¹ãŒã„ã„å ´åˆåˆ†å‰²ã—ãªã„æ–¹ãŒã„ã„å ´åˆ03. tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²åˆ†å‰²ã®å¢ƒç•ŒçŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾å­˜é–¢ä¿‚å›³ã¨ã¯ä¾å­˜é–¢ä¿‚ã®è¡¨ç¾â–¼ ä¾å­˜é–¢ä¿‚ã®è¡¨ç¾è¨˜æ³•â–¼ ä¾å­˜é–¢ä¿‚ãŒãªã„å ´åˆâ–¼ ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆ04. tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ããã®ä»–ã®è¨­è¨ˆãƒªãƒã‚¸ãƒˆãƒª ğŸ± ã®è¨­è¨ˆãƒªãƒã‚¸ãƒˆãƒªåˆ†å‰²ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ğŸ“‚ æ§‹æˆãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ğŸª£ ã®è¨­è¨ˆãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åˆ†å‰²ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ05. çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚ã®å®šç¾©æ–¹æ³•terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã®å ´åˆterraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹ä¾å­˜çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆAWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹ä¾å­˜çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ06. tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ªã‚¹ã‚¹ãƒ¡ãªè¨­è¨ˆã®ä¸€è¦§å¤§åˆ†é¡ (ä¸Šå±¤/ä¸‹å±¤/ä¸­é–“å±¤) ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®é–¢ä¿‚ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆ07. ä¸Šå±¤ã®åˆ†å‰² (æ¨å¥¨)ä¸Šå±¤ã®åˆ†å‰²ã«ã¤ã„ã¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ - â˜…â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆ08. ä¸‹å±¤ã®åˆ†å‰² (æ¨å¥¨)ä¸‹å±¤ã®åˆ†å‰²ã«ã¤ã„ã¦å®Ÿè¡Œç’°å¢ƒåˆ¥ - â˜…â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€å®Ÿè¡Œç’°å¢ƒåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€å®Ÿè¡Œç’°å¢ƒåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€å®Ÿè¡Œç’°å¢ƒåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ x AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒ ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ x å˜ä¸€ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã«å…¨ã¦ã®å®Ÿè¡Œç’°å¢ƒ ã®å ´åˆ09. ä¸­é–“å±¤ã®åˆ†å‰² (ä»»æ„)ä¸­é–“å±¤ã®åˆ†å‰²ã«ã¤ã„ã¦é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ - â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€ãƒãƒ¼ãƒ åˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€ãƒãƒ¼ãƒ åˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ãƒãƒ¼ãƒ åˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ - â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆé‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ Ã— ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ - â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€ãƒãƒ¼ãƒ åˆ¥ Ã— ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€ãƒãƒ¼ãƒ åˆ¥ Ã— ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ãƒãƒ¼ãƒ åˆ¥ Ã— ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆåŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ã€å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã€å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆâ–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆâ–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆ10. ãŠã‚ã‚Šã«è¬è¾è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«ã©ã†ã‚‚ã€Mitchell Hashimoto ã§ã™ã€‚ã•ã¦æœ€è¿‘ã®æ¥­å‹™ã§ã€å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®æŠ€è¡“åŸºç›¤é–‹ç™ºãƒãƒ¼ãƒ ã«æºã‚ã£ã¦ãŠã‚Šã€ãƒãƒ¼ãƒ ãŒä½¿ã£ã¦ã„ã‚‹TerraformğŸ§‘ğŸ»â€ğŸš€ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒªãƒ—ãƒ¬ã‚¤ã‚¹ã™ã‚‹ä½œæ¥­ã‚’æ‹…å½“ã—ã¾ã—ãŸã€‚ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯å˜ä¸€ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒçŠ¶æ…‹ã‚’æŒã¡éãã¦ã„ã‚‹èª²é¡Œã‚’æŠ±ãˆã¦ã„ãŸãŸã‚ã€èª²é¡Œã«åˆã£ãŸé©åˆ‡ãªåˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒªãƒ—ãƒ¬ã‚¤ã‚¹ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã“ã®æ™‚ã«æ•´ç†ã—ãŸåˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ (AWSå‘ã‘) ã‚’è¨˜äº‹ã§è§£èª¬ã—ã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ã€GoogleCloudã‚„Azureã§ã‚‚èª­ã¿æ›ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€åŒã˜ã‚ˆã†ã«é©ç”¨ã§ãã¾ã™ã€‚çŸ¥ã‚‹é™ã‚Šã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜è¼‰ã—ãŸã¨ã“ã‚ã€æƒ…å ±é‡ãŒã‚¨ã‚°ã„ã“ã¨ã«ãªã£ã¦ã—ã¾ã£ãŸãŸã‚ã€æ°—ã«ãªã‚‹åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã ã‘æ‹¾ã£ã¦å¸°ã£ã¦ã„ãŸã ã‘ã‚‹ã¨ãƒãƒƒãƒ”ãƒ¼ã§ã™ğŸ™ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. ãªãœ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹ã®ã‹%%{init: { 'theme': \"default\", 'themeVariables': { 'commitLabelFontSize': '13px' }}}%%gitGraph   commit id: \"8c8e6\"   commit id: \"0e3c3\"     branch feature/foo     checkout feature/foo     commit id: \"4e9e8\"     commit id: \"da005\"   checkout main     branch feature/bar     commit id: \"2d52f\"   checkout main   commit id: \"e74d6\"     branch feature/baz     commit id: \"f6881\"åˆ†å‰²ã—ãªã‹ã£ãŸå ´åˆãã‚‚ãã‚‚ã€ãªãœtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ãªã‹ã£ãŸã¨ä»®å®šã—ã¾ã™ã€‚æ§˜ã€…ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å˜ä¸€ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§çŠ¶æ…‹ã‚’æŒã¤å ´åˆã€1å›ã®terraformã‚³ãƒãƒ³ãƒ‰å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æ“ä½œã§ãã¦æ¥½ã§ã™ã€‚ãŸã ã—ã€è¤‡æ•°ã®ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒãŒã‚ã‚‹çŠ¶æ³ã ã¨ç…©ã‚ã—ã„ã“ã¨ãŒèµ·ã“ã‚Šã¾ã™ã€‚å„ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã‹ã‘ã¦ã„ã‚‹ã¨ã€ä»–ã®ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰å½±éŸ¿ã‚’å—ã‘ã€terraformã‚³ãƒãƒ³ãƒ‰ã§targetã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ä»–ã«ã‚‚ã€terraformã‚³ãƒãƒ³ãƒ‰ã®å®Œäº†ã«æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã‚‹ã¨ã„ã£ãŸå•é¡Œã‚‚èµ·ã“ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å˜ä¸€ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¤šããªã‚‹ã»ã©ã€ã“ã‚Œã‚‰ã®å•é¡Œã¯é¡•è‘—ã«ãªã‚Šã¾ã™ã€‚åˆ†å‰²ã—ãŸæ–¹ãŒã„ã„å ´åˆãã®ä¸€æ–¹ã§ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã„ã„æ„Ÿã˜ã«åˆ†å‰²ã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚å„ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã§ã¯ã€ã¾ã‚‹ã§æš—é»™çš„ã«targetã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã¤ã„ãŸã‚ˆã†ã«ã€ä»–ã®ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰å½±éŸ¿ã‚’å—ã‘ãšã«terraformã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ã‚ˆã£ã¦ã€å„tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ“ä½œã§ãã‚‹ç®¡ç†è€…ã¯äº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚Terraform: Up and Running: Writing Infrastructure as CodeOrganizing With Multiple States - DevOps with Terraform - CloudCastsåˆ†å‰²ã—ãªã„æ–¹ãŒã„ã„å ´åˆé‹ç”¨ãƒ«ãƒ¼ãƒ«ã‚„é–‹ç™ºè€…äººæ•°ãŒç†ç”±ã§ä½œæ¥­ãŒè¡çªã›ãšã€targetã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªã„çŠ¶æ³ã§ã‚ã‚Œã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¯åˆ†å‰²ã—ãªãã¦ã‚‚ã‚ˆã„ã§ã—ã‚‡ã†ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒå°‘ãªã„ã§ã™ğŸ™…ğŸ»â€03. tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²åˆ†å‰²ã®å¢ƒç•Œãã‚Œã§ã¯ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ã®å¢ƒç•Œã¯ã©ã®ã‚ˆã†ã«ã—ã¦è¦‹ã¤ã‘ã‚Œã°ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ã€‚ã“ã‚Œã‚’è¦‹ã¤ã‘ã‚‹ã‚³ãƒ„ã¯ã€ã§ãã‚‹ã ã‘ç›¸äº’ã«ä¾å­˜ã—ãªã„ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã®é–¢ä¿‚ ã«æ³¨ç›®ã™ã‚‹ã“ã¨ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ã“ã“ã§ã„ã†ä¾å­˜ã¨ã¯ã€\"tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒä»–ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®çŠ¶æ…‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨\" ã§ã™ã€‚ã‚‚ã†å°‘ã—å…·ä½“çš„ã«è¨€èªåŒ–ã™ã‚‹ã¨ã€\"ç‰¹å®šã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ãŒä»–ã®è¨­å®šå€¤ã‚’å‚ç…§ã™ã‚‹ã“ã¨\" ã§ã™ã€‚çŠ¶æ…‹ã‚’ã»ã¨ã‚“ã©ä½¿ç”¨ã—åˆã‚ãªã„ (äº’ã„ã«è¨­å®šå€¤ã®å‚ç…§æ•°ãŒå°‘ãªã„) ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹åŒå£«ã‚’ã€ç•°ãªã‚‹tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¾ã™ã€‚ç•°ãªã‚‹tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã§ãã‚‹åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ã€‚â–¶ ã€ä¾å­˜ã€ã¨ã„ã†ç”¨èªã«ã¤ã„ã¦tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚åŒã˜ç”¨èªã§è¡¨ç¾ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚@tmknom ã•ã‚“ãŒè¿°ã¹ã¦ã„ã‚‹é€šã‚Šã€Terraformã‚’ã‚ˆã‚Šã‚ˆãè¨­è¨ˆã™ã‚‹ãŸã‚ã«ã¯ã€ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®åŸºç¤çŸ¥è­˜ã€ãŒå¿…è¦ã§ã™ğŸ‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾å­˜é–¢ä¿‚å›³ã¨ã¯åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã®çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚ã‚’è¡¨ç¾ã—ãŸå›³ã§ã™ã€‚ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹ã“ã¨ã‚’æƒ³åƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ        foo[\"tfstateãƒ•ã‚¡ã‚¤ãƒ«\"]    endä¼¼ãŸã‚‚ã®ã¨ã—ã¦terraform graphã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚å›³ã§ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ç›¸äº’ã«ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹ã‹ã‚‰ã¨ã„ã£ã¦ã€å€‹åˆ¥ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹é–“ã§å¾ªç’°å‚ç…§ãŒèµ·ã“ã£ã¦ã—ã¾ã†ã¨ã„ã†ã‚ã‘ã§ã¯ãªã„ã§ã™ã€‚ç¶šã„ã¦ã€ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆã¨ç„¡ã„å ´åˆã§ã€ã©ã®ã‚ˆã†ãªä¾å­˜é–¢ä¿‚å›³ã«ãªã‚‹ã‹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚Command: graph | Terraform | HashiCorp Developerä¾å­˜é–¢ä¿‚ã®è¡¨ç¾â–¼ ä¾å­˜é–¢ä¿‚ã®è¡¨ç¾è¨˜æ³•tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã§çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆã€ã“ã‚Œã‚’å›³ã§è¡¨ç¾ã™ã‚‹ã¨åˆ†å‰²ã®çŠ¶æ³ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚ã€ä¾å­˜ã€ã¯ã€---\u003e (æ³¢ç·šçŸ¢å°) ã§è¡¨ç¾ã™ã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆã«ã¤ã„ã¦ã¯ã€å¾Œè¿°ã—ã¾ã™ã€‚â–¶ ã€ä¾å­˜ã€ã®æ³¢ç·šçŸ¢å°ã«ã¤ã„ã¦---\u003e (æ³¢ç·šçŸ¢å°) ã§è¡¨ç¾ã—ã¾ã™ã€‚ãã®ãŸã‚ä¾¿å®œä¸Šã€tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚åŒã˜è¨˜å·ã§è¡¨ç¾ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸğŸ‘â–¼ ä¾å­˜é–¢ä¿‚ãŒãªã„å ´åˆä¾‹ãˆã°ã€AWSãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ãªã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ã„ãã¤ã‹ã®tfstateãƒ•ã‚¡ã‚¤ãƒ« (foo-tfstateã€bar-tfstate) ã«åˆ†å‰²ã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€ tfstate ãƒ•ã‚¡ã‚¤ãƒ«é–“ã«ä¾å­˜é–¢ä¿‚ã¯ãªã„ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã«ä¾å­˜é–¢ä¿‚ãŒãªã„çŠ¶æ³ãŒãƒ™ã‚¹ãƒˆã§ã™ã€‚---title: tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã«ä¾å­˜é–¢ä¿‚ã¯ãªã„---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ        foo[\"foo-tfstate\"]        bar[\"bar-tfstate\"]    endâ–¼ ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆåŒæ§˜ã«åˆ†å‰²ã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€ foo-tfstate â¡ï¸ bar-tfstate ã®æ–¹å‘ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€---\u003e (æ³¢ç·šçŸ¢å°) ã‚’ä½¿ç”¨ã—ã¦ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: foo-tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€bar-tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜---%%{init:{'theme':'default'}}%%flowchart TD    subgraph AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ        foo[\"foo-tfstate\"]        bar[\"bar-tfstate\"]    end    foo -. ä¾å­˜ .-\u003e bar04. tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ããã®ä»–ã®è¨­è¨ˆãƒªãƒã‚¸ãƒˆãƒª ğŸ± ã®è¨­è¨ˆãƒªãƒã‚¸ãƒˆãƒªåˆ†å‰²ã“ã“ã¾ã§ã§ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«ã¤ã„ã¦ç°¡å˜ã«ç´¹ä»‹ã—ã¾ã—ãŸã€‚ãƒªãƒã‚¸ãƒˆãƒªã®åˆ†å‰²ã¯ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚å¯èƒ½ã§ã‚ã‚Œã°ã€1å€‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«1å€‹ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠãã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã«tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠã„ãŸæ–¹ãŒã‚ˆã„å ´åˆã«ã¤ã„ã¦ã¯ã€åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ğŸ± foo-repository/â”œâ”€â”€ backend.tf # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹...ğŸ± bar-repository/â”œâ”€â”€ backend.tf # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹...ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ğŸ“‚ æ§‹æˆãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚‚ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚ç‡ç›´ã«è¨€ã†ã¨ã€Terraformã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ç„¡æ•°ã«ã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€åŸºæº–ãªã—ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’è€ƒãˆã‚‹ã¨ä½•ã§ã‚‚ã‚ã‚Š ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ä¸€æ–¹ã§ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦è¨­è¨ˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€æ˜ç¢ºãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ ã¨ã—ã¦æŠ½å‡ºå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ğŸ± repository/â”œâ”€â”€ ğŸ“‚ foo/â”‚    â”œâ”€â”€ backend.tf # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ bar/      â”œâ”€â”€ backend.tf # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      ...â–¶ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®è¨­è¨ˆã«ã¤ã„ã¦resourceã€data) ã®ã‚»ãƒƒãƒˆã‚’ä½¿ã„å›ã™ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã€ã“ã‚Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯è¨­è¨ˆã«å«ã‚ã¦ã„ã¾ã›ã‚“ã€‚æ··åŒã—ã‚„ã™ã„ã®ã§ã™ãŒã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã®ãã‚Œã¯ã€å…¨ãåˆ¥ã®ãƒ†ãƒ¼ãƒã¨ã—ã¦åˆ‡ã‚Šé›¢ã—ã¦è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ğŸ‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ğŸª£ ã®è¨­è¨ˆãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åˆ†å‰²æœ¬è¨˜äº‹ã§ã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦AWS S3ãƒã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®åˆ†å‰²ã¯ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠã„ãŸæ–¹ãŒã‚ˆã„å ´åˆã«ã¤ã„ã¦ã¯ã€åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ğŸª£ foo-bucket/â”‚â””â”€â”€ terraform.tfstate # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ bar-bucket/â”‚â””â”€â”€ terraform.tfstate # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚‚ã—ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦åˆ†å‰²ã—ãªã‹ã£ãŸã¨ã—ã¾ã™ã€‚ãã®å ´åˆã¯ã€ä»£ã‚ã‚Šã«ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚ğŸª£ bucket/â”œâ”€â”€ ğŸ“‚ foo/â”‚    â””â”€â”€ terraform.tfstate # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ bar/      â””â”€â”€ terraform.tfstate # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤05. çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚ã®å®šç¾©æ–¹æ³•terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã®å ´åˆterraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹ä¾å­˜terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                        ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                                                                                                                      å¯èª­æ€§                 -                                                                                  terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã«åŠ ãˆã¦outputãƒ–ãƒ­ãƒƒã‚¯ã‚‚å®Ÿè£…ãŒå¿…è¦ã§ã‚ã‚Šã€outputãƒ–ãƒ­ãƒƒã‚¯ã¯ä¾å­˜å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹ãŒä¸€è¦‹ã—ã¦ã‚ã‹ã‚Šã«ãã„ã€‚                             æ‹¡å¼µæ€§                 ä¾å­˜å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹ã«é–¢ã‚ã‚‰ãšã€åŒã˜terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ã„å›ã›ã‚‹ã€‚  -                                                                                                                                                                     ä¿å®ˆæ€§                 -                                                                                  ä¾å­˜å…ˆã¨ä¾å­˜å…ƒã®é–“ã§Terraformã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å·®ãŒã‚ã‚Šã™ãã‚‹ã¨ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã§äº’æ›æ€§ãŒãªããªã‚Šã€terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã®å‡¦ç†ãŒå¤±æ•—ã™ã‚‹ã€‚ æœ¬è¨˜äº‹ã§ã¯ã€ terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚ã‚’å®šç¾© ã—ã¦ã„ãã¾ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒä»–ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã€å¾Œè¿°ã®AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ã€‚The terraform_remote_state Data Source | Terraform | HashiCorp DeveloperçŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€AWSãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ãªã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ã„ãã¤ã‹ã®tfstateãƒ•ã‚¡ã‚¤ãƒ« (foo-tfstateã€bar-tfstate) ã«åˆ†å‰²ã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€bar-tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¯VPCã®çŠ¶æ…‹ã‚’æŒã£ã¦ãŠã‚Šã€ foo-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã¯ bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸä¾å­˜é–¢ä¿‚---%%{init:{'theme':'default'}}%%flowchart TD    subgraph bucket        foo[\"foo-tfstate\"]        bar[\"bar-tfstate\"]    end    foo -. VPCã®çŠ¶æ…‹ã«ä¾å­˜ .-\u003e barãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆtfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­è¨ˆæ–¹æ³•ã¯ã€åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ğŸ± repository/â”œâ”€â”€ ğŸ“‚ foo/â”‚    â”œâ”€â”€ backend.tf # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã€bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    ...â”‚â””â”€â”€ ğŸ“‚ bar/      â”œâ”€â”€ backend.tf # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ provider.tf      ...foo-tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒbar-tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå®Ÿè£…ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚resource \"example\" \"foo\" {  # fooãƒªã‚½ãƒ¼ã‚¹ã¯ã€bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®VPCã«ä¾å­˜ã™ã‚‹  vpc_id = data.terraform_remote_state.bar.outputs.bar_vpc_id  ...}data \"terraform_remote_state\" \"bar\" { backend = \"s3\"  config = {    bucket = \"tfstate\"    key    = \"bar/terraform.tfstate\"    region = \"ap-northeast-1\"  }}# VPCã®çŠ¶æ…‹ã¯ã€bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒã¤output \"bar_vpc_id\" {  value = aws_vpc.bar.id}resource \"aws_vpc\" \"bar\" {  ...}ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆtfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ğŸª£ bucket/â”œâ”€â”€ ğŸ“‚ fooâ”‚    â””â”€â”€ terraform.tfstate # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ bar      â””â”€â”€ terraform.tfstate # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹ä¾å­˜AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã«ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒ‡ãƒ¡ãŒã‚ã‚Šã¾ã™ã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§  ãƒ¡ãƒªãƒƒãƒˆ â­•ï¸                                                                                                                                     ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ Ã—                                                 å¯èª­æ€§                 ä¾å­˜å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã€‚                                                                                                             -                                                                æ‹¡å¼µæ€§                 -                                                                                                                                               ä¾å­˜å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ãŒå¿…è¦ã§ã‚ã‚‹ã€‚                ä¿å®ˆæ€§                 ä¾å­˜å…ˆã¨ä¾å­˜å…ƒã®é–“ã§Terraformã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å·®ãŒã‚ã£ã¦ã‚‚ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ç›´æ¥çš„ã«ä¾å­˜ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ãŸã‚ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³å·®ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã€‚  -                                                 ä»Šå›ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ãŒã€ä¾å­˜é–¢ä¿‚ã®ä»–ã®å®šç¾©æ–¹æ³•ã¨ã—ã¦ã€AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªèº«ä»¥å¤– (ä¾‹ï¼šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã€ä»–ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«) ã§ä½œæˆã•ã‚ŒãŸAWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã«ä¾å­˜ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯ã¨ã¯ç•°ãªã‚Šã€ç›´æ¥çš„ã«ã¯tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¾ã›ã‚“ã€‚AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã®å ´åˆã¯ã€å®Ÿéš›ã®AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€é–“æ¥çš„ã«AWSãƒªã‚½ãƒ¼ã‚¹ã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚Data Sources - Configuration Language | Terraform | HashiCorp DeveloperçŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€AWSãƒªã‚½ãƒ¼ã‚¹åˆ¥dataãƒ–ãƒ­ãƒƒã‚¯ã‚‚åŒæ§˜ã«ã—ã¦ã€AWSãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ãªã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ã„ãã¤ã‹ã®tfstateãƒ•ã‚¡ã‚¤ãƒ« (foo-tfstateã€bar-tfstate) ã«åˆ†å‰²ã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€bar-tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¯VPCã®çŠ¶æ…‹ã‚’æŒã£ã¦ãŠã‚Šã€ foo-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã¯ bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: dataãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸä¾å­˜é–¢ä¿‚---%%{init:{'theme':'default'}}%%flowchart TD    subgraph bucket        foo[\"foo-tfstate\"]        bar[\"bar-tfstate\"]    end    foo -. VPCã®çŠ¶æ…‹ã«ä¾å­˜ .-\u003e barãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ğŸ± repository/â”œâ”€â”€ ğŸ“‚ foo/â”‚    â”œâ”€â”€ backend.tf # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”œâ”€â”€ data.tf # dataãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã€bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    ...â”‚â””â”€â”€ ğŸ“‚ bar/      â”œâ”€â”€ backend.tf # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”œâ”€â”€ provider.tf      ...foo-tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒbar-tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå®Ÿè£…ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚# fooãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã¯ã€foo-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒã¤resource \"example\" \"foo\" {  # fooãƒªã‚½ãƒ¼ã‚¹ã¯ã€bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®VPCã«ä¾å­˜ã™ã‚‹  vpc_id     = data.aws_vpc.bar.id}# VPCã®çŠ¶æ…‹ã¯ã€bar-tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒã¤data \"aws_vpc\" \"bar\" {  filter {    name   = \"tag:Name\"    values = [\"\u003cbar-tfstateãŒæŒã¤VPCã®åå‰\u003e\"]  }}ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆtfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ğŸª£ bucket/â”œâ”€â”€ ğŸ“‚ fooâ”‚    â””â”€â”€ terraform.tfstate # fooã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ bar      â””â”€â”€ terraform.tfstate # barã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤06. tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ªã‚¹ã‚¹ãƒ¡ãªè¨­è¨ˆã®ä¸€è¦§å‰è¿°ã®é€šã‚Šã€tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ã®å¢ƒç•Œã¯ã€ã€ä»–ã®çŠ¶æ…‹ã«ã§ãã‚‹ã ã‘ä¾å­˜ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã®é–¢ä¿‚ã€ã‹ã‚‰è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚åˆ†å‰²ã—ã™ãã‚‹ã¨ terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯åœ°ç„ ã«ãªã‚‹ãŸã‚ã€ç´°ã‹ã™ããšç²—ã™ããªã„é©åˆ‡ãªå¢ƒç•Œã‚’è¦‹ã¤ã‘ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ä»Šå›ã¯ã€ç§ãŒè€ƒãˆã‚‹åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ã€‚å…¨ã¦ãŒå®Ÿç”¨çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã„ã†ã‚ã‘ã§ãªã„ãŸã‚ã€ã‚ªã‚¹ã‚¹ãƒ¡ã™ã‚‹ã‚‚ã®ã‚’ â˜… ã¨ã—ã¦ã„ã¾ã™ã€‚æ¨å¥¨ãƒ»ä»»æ„    tfstateåˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³å¤§åˆ†é¡    tfstateåˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³å°åˆ†é¡ã‚ªã‚¹ã‚¹ãƒ¡    å¯¾å¿œã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆ ğŸ±    å¯¾å¿œã™ã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹æˆ ğŸª£  æ¨å¥¨    ä¸Šå±¤    ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥    â˜…â˜…â˜…    ãƒªãƒã‚¸ãƒˆãƒªè‡ªä½“ã¾ãŸã¯ä¸Šå±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª    ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è‡ªä½“ã¾ãŸã¯ä¸Šå±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª  ä¸‹å±¤å®Ÿè¡Œç’°å¢ƒåˆ¥    â˜…â˜…â˜…    ä¸‹å±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª    ä¸‹å±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª  ä»»æ„    ä¸­é–“å±¤    é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥    â˜…â˜…    ä¸­é–“å±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª    ä¸­é–“å±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª  ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥    â˜…â˜…  é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥Ã—ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥(çµ„ã¿åˆã‚ã›)    â˜…  åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥      AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥      AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥      å¤§åˆ†é¡ (ä¸Šå±¤/ä¸‹å±¤/ä¸­é–“å±¤) ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®é–¢ä¿‚ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆè¨˜äº‹å†…ã®ã“ã“ ã§ã€ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦è¨­è¨ˆã™ã‚‹ã¹ãã€ã¨ã„ã†èª¬æ˜ã‚’ã—ã¾ã—ãŸã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ä¸Šå±¤/ä¸‹å±¤/ä¸­é–“å±¤ ã®å±¤ã«å¤§åˆ¥ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®å±¤ã¯ã€ä»¥ä¸‹ã®é€šã‚Šãƒªãƒã‚¸ãƒˆãƒªè‡ªä½“ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®è¨­è¨ˆæ–¹æ³•ã«å½±éŸ¿ã—ã¾ã™ã€‚# ãƒªãƒã‚¸ãƒˆãƒªè‡ªä½“ã‚’åˆ†å‰²ã™ã‚‹å ´åˆğŸ± ä¸Šå±¤/â”œâ”€â”€ ğŸ“‚ ä¸­é–“å±¤/â”‚    â”œâ”€â”€ ğŸ“‚ ä¸‹å±¤/â”‚    â”‚    â”œâ”€â”€ backend.tfvars # åˆ†å‰²ã•ã‚ŒãŸ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚...# ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†å‰²ã™ã‚‹å ´åˆğŸ± ãƒªãƒã‚¸ãƒˆãƒª/â”œâ”€â”€ ğŸ“‚ ä¸Šå±¤/â”‚    â”œâ”€â”€ ğŸ“‚ ä¸­é–“å±¤/â”‚    â”‚    â”œâ”€â”€ ğŸ“‚ ä¸‹å±¤/â”‚    â”‚    â”‚    â”œâ”€â”€ backend.tfvars # åˆ†å‰²ã•ã‚ŒãŸ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    â”‚    ...â”‚    â”‚    â”‚...ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆè¨˜äº‹å†…ã®ã“ã“ ã§ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«ã¤ã„ã¦ã‚‚è¨€åŠã—ã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®å±¤ã¯ã€ä»¥ä¸‹ã®é€šã‚Šãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è‡ªä½“ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®è¨­è¨ˆæ–¹æ³•ã«å½±éŸ¿ã—ã¾ã™ã€‚# ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è‡ªä½“ã‚’åˆ†å‰²ã™ã‚‹å ´åˆğŸª£ ä¸Šå±¤/â”œâ”€â”€ ğŸ“‚ ä¸­é–“å±¤/â”‚    â”œâ”€â”€ ğŸ“‚ ä¸‹å±¤/â”‚    â”‚    â””â”€â”€ terraform.tfstate # åˆ†å‰²ã•ã‚ŒãŸçŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚â”‚    â”‚...# ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†å‰²ã™ã‚‹å ´åˆğŸª£ bucket/â”œâ”€â”€ ğŸ“‚ ä¸Šå±¤/â”‚    â”œâ”€â”€ ğŸ“‚ ä¸­é–“å±¤/â”‚    â”‚    â”œâ”€â”€ ğŸ“‚ ä¸‹å±¤/â”‚    â”‚    â”‚    â””â”€â”€ terraform.tfstate # åˆ†å‰²ã•ã‚ŒãŸçŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚    â”‚â”‚    â”‚    â”‚...07. ä¸Šå±¤ã®åˆ†å‰² (æ¨å¥¨)ä¸Šå±¤ã®åˆ†å‰²ã«ã¤ã„ã¦ä¸Šå±¤ã®åˆ†å‰²ã¯ æ¨å¥¨ ã§ã™ã€‚Terraformã«æºã‚ã‚‹ç®¡ç†è€…ã®æ•°ãŒå°‘ãªãã¦ã‚‚æ¡ç”¨ã—ãŸæ–¹ãŒã‚ˆã„ã§ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ã¦åˆ†å‰²ã—ã€ã“ã‚Œã«åŸºã¥ã„ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚‚è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ - â˜…â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ä¸Šå±¤åˆ†å‰²ã®ä¸­ã§ã‚‚ã€åŸºæœ¬çš„ãªæ–¹æ³•ã®1ã¤ã§ã™ã€‚ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸Šå±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚â–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§çŠ¶æ…‹ã‚’ç®¡ç†ã›ã–ã‚‹ã‚’å¾—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€Kubernetesã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯ã€EKSã¨åŒã˜tfstateãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ãŸæ–¹ãŒã‚ˆã„ã§ã™ğŸ‘Terraform Registryã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã„çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ä¸»è¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (AWS)ã‚¢ãƒ—ãƒª/ã‚¤ãƒ³ãƒ•ãƒ©ç›£è¦–ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (Datadog)ã‚¸ãƒ§ãƒ–ç›£è¦–ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (Healthchecks)ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (PagerDuty)ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§çŠ¶æ…‹ãŒç›¸äº’ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚AWSãƒªã‚½ãƒ¼ã‚¹é–“ã®ç›¸äº’ä¾å­˜ã§ã¯ãªã„ãŸã‚ã€å¾ªç’°å‚ç…§ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥---%%{init:{'theme':'default'}}%%flowchart LR    subgraph PagerDuty        pagerDuty[\"tfstate\"]    end    subgraph Healthchecks        healthchecks[\"tfstate\"]    end    subgraph Datadog        datadog[\"tfstate\"]    end    subgraph AWS        aws[\"tfstate\"]    end    aws -...-\u003e datadog    aws -...-\u003e healthchecks    aws -...-\u003e pagerDuty    datadog -...-\u003e aws    healthchecks -...-\u003e aws    pagerDuty -...-\u003e awsã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ backend.tf # AWSã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tf...ğŸ± datadog-repository/â”œâ”€â”€ backend.tf # Datadogã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tf...ğŸ± healthchecks-repository/â”œâ”€â”€ backend.tf # Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tf...ğŸ± pagerduty-repository/â”œâ”€â”€ backend.tf # PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tf...â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸ± repository/â”œâ”€â”€ ğŸ“‚ aws/â”‚    â”œâ”€â”€ backend.tf # AWSã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ datadog/â”‚    â”œâ”€â”€ backend.tf # Datadogã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ healthchecks/â”‚    â”œâ”€â”€ backend.tf # Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    ...â”‚â””â”€â”€ ğŸ“‚ pagerduty/      â”œâ”€â”€ backend.tf # PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹      â”œâ”€â”€ provider.tf      ...ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸª£ aws-bucket/â”‚â””â”€â”€ terraform.tfstate # AWSã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ datadog-bucket/â”‚â””â”€â”€ terraform.tfstate # Datadogã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ healthchecks-bucket/â”‚â””â”€â”€ terraform.tfstate # Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ pagerduty-bucket/â”‚â””â”€â”€ terraform.tfstate # PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸª£ bucket/â”œâ”€â”€ ğŸ“‚ awsâ”‚    â””â”€â”€ terraform.tfstate # AWSã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ datadogâ”‚    â””â”€â”€ terraform.tfstate # Datadogã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ healthchecksâ”‚    â””â”€â”€ terraform.tfstate # Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ pagerduty      â””â”€â”€ terraform.tfstate # PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤08. ä¸‹å±¤ã®åˆ†å‰² (æ¨å¥¨)ä¸‹å±¤ã®åˆ†å‰²ã«ã¤ã„ã¦ä¸‹å±¤ã®åˆ†å‰²ã¯ æ¨å¥¨ ã§ã™ã€‚Terraformã«æºã‚ã‚‹ç®¡ç†è€…ã®æ•°ãŒå°‘ãªãã¦ã‚‚æ¡ç”¨ã—ãŸæ–¹ãŒã‚ˆã„ã§ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ã¦åˆ†å‰²ã—ã€ã“ã‚Œã«åŸºã¥ã„ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚‚è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚å®Ÿè¡Œç’°å¢ƒåˆ¥ - â˜…â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ä¸‹å±¤åˆ†å‰²ã®ä¸­ã§ã‚‚ã€åŸºæœ¬çš„ãªæ–¹æ³•ã®1ã¤ã§ã™ã€‚å®Ÿè¡Œç’°å¢ƒåˆ¥ã«tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸‹å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„å®Ÿè¡Œç’°å¢ƒã®ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚Terraform: Up and Running: Writing Infrastructure as CodeHow to manage Terraform state. A guide to file layout, isolation, andâ€¦ | by Yevgeniy Brikman | Gruntworkâ–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦ã€å®Ÿè¡Œç’°å¢ƒåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®å®Ÿè¡Œç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸã„çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚Tesç’°å¢ƒ (æ¤œè¨¼ç’°å¢ƒ)Stgç’°å¢ƒ (ãƒ¦ãƒ¼ã‚¶ãƒ¼å—ã‘å…¥ã‚Œç’°å¢ƒ)Prdç’°å¢ƒ (æœ¬ç•ªç’°å¢ƒ)ã‹ã¤ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã„çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ä¸»è¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (AWS)ã‚¢ãƒ—ãƒª/ã‚¤ãƒ³ãƒ•ãƒ©ç›£è¦–ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (Datadog)ã‚¸ãƒ§ãƒ–ç›£è¦–ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (Healthchecks)ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (PagerDuty)ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„å®Ÿè¡Œç’°å¢ƒã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»–ã®å®Ÿè¡Œç’°å¢ƒã«ã¯ä¾å­˜ã—ã¦ã„ãªã„ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: å®Ÿè¡Œç’°å¢ƒåˆ¥---%%{init:{'theme':'default'}}%%flowchart LR    subgraph PagerDuty        pagerDuty[\"tfstate\"]    end    subgraph Healthchecks        healthchecks[\"tfstate\"]    end    subgraph Datadog        datadog[\"tfstate\"]    end    subgraph AWS        subgraph tes-bucket            tes[\"tfstate\"]        end        subgraph stg-bucket            stg[\"tfstate\"]        end        subgraph prd-bucket            prd[\"tfstate\"]        end    end    tes -...-\u003e datadog    tes -...-\u003e healthchecks    tes -...-\u003e pagerDuty    datadog -...-\u003e tes    healthchecks -...-\u003e tes    pagerDuty -...-\u003e tesã€å®Ÿè¡Œç’°å¢ƒåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã¯æ¨å¥¨ã¨ã—ã¦ã„ã‚‹ãŸã‚ã€ãã®ä¸Šã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’è€ƒãˆã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒğŸ± datadog-repository/â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ ğŸ“‚ tes/â”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®Datadogã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/â””â”€â”€ ğŸ“‚ prd/ğŸ± healthchecks-repository/â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ ğŸ“‚ tes/â”‚    â”œâ”€â”€ backend.tfvars # Healthchecsã®Tesç’°å¢ƒã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/â””â”€â”€ ğŸ“‚ prd/ğŸ± pagerduty-repository/â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ ğŸ“‚ tes/â”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/â””â”€â”€ ğŸ“‚ prd/â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã¯æ¨å¥¨ã¨ã—ã¦ã„ã‚‹ãŸã‚ã€ãã®ä¸Šã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’è€ƒãˆã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸ± repository/â”œâ”€â”€ ğŸ“‚ aws/â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚â”œâ”€â”€ ğŸ“‚ datadog/â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/â”‚    â”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®Datadogã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/â”‚    â””â”€â”€ ğŸ“‚ prd/â”‚â”œâ”€â”€ ğŸ“‚ healthchecks/â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/â”‚    â”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/â”‚    â””â”€â”€ ğŸ“‚ prd/â”‚â””â”€â”€ ğŸ“‚ pagerduty/      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹      â”œâ”€â”€ provider.tf      â”œâ”€â”€ ğŸ“‚ tes/      â”‚    â”œâ”€â”€ backend.tfvars # Tesç’°å¢ƒã®PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/      â””â”€â”€ ğŸ“‚ prd/ã€å®Ÿè¡Œç’°å¢ƒåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆå®Ÿè¡Œç’°å¢ƒåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸª£ tes-aws-bucket/â”‚â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ tes-datadog-bucket/â”‚â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®Datadogã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ tes-healthchecks-bucket/â”‚â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤ğŸª£ tes-pagerduty-bucket/â”‚â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ x AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒ ã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ã¾ãŸã€AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒã‚’ä½œæˆã—ã¦ã„ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ aws/â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ datadog/â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®Datadogã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ healthchecks/â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ pagerduty/      â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ x å˜ä¸€ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã«å…¨ã¦ã®å®Ÿè¡Œç’°å¢ƒ ã®å ´åˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ã¾ãŸã€å˜ä¸€ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã«å…¨å®Ÿè¡Œç’°å¢ƒã‚’ä½œæˆã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸª£ bucket/â”œâ”€â”€ ğŸ“‚ aws/â”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚â”œâ”€â”€ ğŸ“‚ datadog/â”‚    â”œâ”€â”€ ğŸ“‚ tes/â”‚    â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®Datadogã®çŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/â”‚    â””â”€â”€ ğŸ“‚ prd/â”‚â”œâ”€â”€ ğŸ“‚ healthchecks/â”‚    â”œâ”€â”€ ğŸ“‚ tes/â”‚    â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®Healthchecksã®çŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/â”‚    â””â”€â”€ ğŸ“‚ prd/â”‚â””â”€â”€ ğŸ“‚ pagerduty/      â”œâ”€â”€ ğŸ“‚ tes/      â”‚    â””â”€â”€ terraform.tfstate # Tesç’°å¢ƒã®PagerDutyã®çŠ¶æ…‹ã‚’æŒã¤      â”‚      â”œâ”€â”€ ğŸ“‚ stg/      â””â”€â”€ ğŸ“‚ prd/09. ä¸­é–“å±¤ã®åˆ†å‰² (ä»»æ„)ä¸­é–“å±¤ã®åˆ†å‰²ã«ã¤ã„ã¦ä¸­é–“å±¤ã®åˆ†å‰²ã¯ ä»»æ„ ã§ã™ã€‚Terraformã«æºã‚ã‚‹ç®¡ç†è€…ãŒå¤šããªã‚‹ã»ã©ã€åŠ¹åŠ›ã‚’ç™ºæ®ã—ã¾ã™ã€‚é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ - â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦é‹ç”¨ãƒãƒ¼ãƒ  (ä¾‹ï¼šã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ã€ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ) ã®AWSãƒªã‚½ãƒ¼ã‚¹ã®è²¬å‹™ç¯„å›²åˆ¥ã§tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸­é–“å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„é‹ç”¨ãƒãƒ¼ãƒ ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚AWS CloudFormation best practices - AWS CloudFormationTerraform in Action (English Edition)â–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦ã€ãƒãƒ¼ãƒ åˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®é‹ç”¨ãƒãƒ¼ãƒ ã«åˆ†å‰²ã—ãŸçŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚frontendãƒãƒ¼ãƒ  (ã‚¢ãƒ—ãƒªã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é ˜åŸŸæ‹…å½“)backendãƒãƒ¼ãƒ  (ã‚¢ãƒ—ãƒªã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é ˜åŸŸæ‹…å½“)sreãƒãƒ¼ãƒ  (ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸæ‹…å½“)ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹ tfstate ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§çŠ¶æ…‹ãŒç›¸äº’ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚AWSãƒªã‚½ãƒ¼ã‚¹é–“ã®ç›¸äº’ä¾å­˜ã§ã¯ãªã„ãŸã‚ã€å¾ªç’°å‚ç…§ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWS        subgraph tes-bucket            frontend[\"frontend-team-tfstate\u003cbr\u003e(CloudFront, S3, ãªã©)\"]            backend[\"backend-team-tfstate\u003cbr\u003e(API Gateway, ElastiCache, RDS, SES, SNS, ãªã©)\"]            sre[\"sre-team-tfstate\u003cbr\u003e(ALB, CloudWatch, EC2, ECS, EKS, IAM, VPC, ãªã©)\"]            frontend-..-\u003esre            backend-..-\u003esre            sre-..-\u003efrontend            sre-..-\u003ebackend        end    subgraph stg-bucket        stg[\"tfstate\"]    end    subgraph prd-bucket        prd[\"tfstate\"]    end    endã€ãƒãƒ¼ãƒ åˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ğŸ± aws-frontend-team-repository/ # frontendãƒãƒ¼ãƒ â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ cloudfront.tfâ”œâ”€â”€ s3.tfâ”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ      â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      ...ğŸ± aws-backend-team-repository/ # backendãƒãƒ¼ãƒ â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ elasticache.tfâ”œâ”€â”€ ses.tfâ”œâ”€â”€ sns.tfâ”œâ”€â”€ rds.tfâ”œâ”€â”€ ğŸ“‚ tesâ”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stgâ”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ prd      â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹       ...ğŸ± aws-sre-team-repository/ # sreãƒãƒ¼ãƒ â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ alb.tfâ”œâ”€â”€ cloudwatch.tfâ”œâ”€â”€ ec2.tfâ”œâ”€â”€ ecs.tfâ”œâ”€â”€ eks.tfâ”œâ”€â”€ iam.tfâ”œâ”€â”€ vpc.tfâ”œâ”€â”€ ğŸ“‚ tesâ”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stgâ”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ prd      â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      ...â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ ğŸ“‚ frontend-team # frontendãƒãƒ¼ãƒ â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ cloudfront.tfâ”‚    â”œâ”€â”€ s3.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ backend-team # backendãƒãƒ¼ãƒ â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ elasticache.tfâ”‚    â”œâ”€â”€ ses.tfâ”‚    â”œâ”€â”€ sns.tfâ”‚    â”œâ”€â”€ rds.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tesâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stgâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prdâ”‚          â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ sre-team # sreãƒãƒ¼ãƒ       â”œâ”€â”€ provider.tf      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹      â”œâ”€â”€ alb.tf      â”œâ”€â”€ cloudwatch.tf      â”œâ”€â”€ ec2.tf      â”œâ”€â”€ ecs.tf      â”œâ”€â”€ eks.tf      â”œâ”€â”€ iam.tf      â”œâ”€â”€ vpc.tf      â”œâ”€â”€ ğŸ“‚ tes      â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg      â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd           â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹           ...ã€ãƒãƒ¼ãƒ åˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆé‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆã“ã®å ´åˆã§ã¯ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ frontend-teamâ”‚    â””â”€â”€ terraform.tfstate # frontendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ backend-teamâ”‚    â””â”€â”€ terraform.tfstate # backendãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ sre-team      â””â”€â”€ terraform.tfstate # sreãƒãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ - â˜…â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (ä¾‹ï¼šã‚¢ãƒ—ãƒªã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€èªè¨¼/èªå¯ã€ç›£è¦–ãªã©) åˆ¥ã§tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸­é–“å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚Things to Know Before Working With Terraform â€“ Part 1 | EndavaTerraform organization â€” Part I : What if you split your components ? | by Amine Charot | Mediumâ–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯åœ°ç„ã«ãªã£ã¦ã„ããŸã‚ã€é©åˆ‡ãªæ•° (3ã€œ5å€‹ãã‚‰ã„) ã«ã—ã¦ãŠãã‚ˆã†ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã¯ã€å¾Œè¿°ã®AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã”ã£ã¡ã‚ƒã«ãªã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹ãŸã‚ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ„è­˜çš„ã«åˆ†å‰²ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ğŸ‘ã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆ†å‰²ã—ãŸçŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚application (Web3å±¤ç³»)auth (èªè¨¼/èªå¯ç³»)monitor (ç›£è¦–ç³»)network (ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç³»)ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜ã¯ä¸€æ–¹å‘æœ€çµ‚çš„ã«ã€networkã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„authã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWS        subgraph tes-bucket            application[\"application-tfstate\u003cbr\u003eWeb3å±¤ã¨å‘¨è¾ºAWSãƒªã‚½ãƒ¼ã‚¹\u003cbr\u003e(ALB, APIGateway, CloudFront, EC2, ECS, EKS, RDS, S3, SNS, ãªã©)\"]            auth[\"auth-tfstate\u003cbr\u003e(IAMãªã©)\"]            monitor[\"monitor-tfstate\u003cbr\u003e(CloudWatch, ãªã©)\"]            network[\"network-tfstate\u003cbr\u003e(Route53, VPC, ãªã©)\"]            application-..-\u003enetwork            application-..-\u003eauth            monitor-..-\u003eapplication        end        subgraph stg-bucket            stg[\"tfstate\"]        end        subgraph prd-bucket            prd[\"tfstate\"]        end        endã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ã¨ãƒªãƒã‚¸ãƒˆãƒªãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ ğŸ“‚ application/â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ alb.tfâ”‚    â”œâ”€â”€ cloudfront.tfâ”‚    â”œâ”€â”€ ec2.tfâ”‚    â”œâ”€â”€ ecs.tfâ”‚    â”œâ”€â”€ eks.tfâ”‚    â”œâ”€â”€ ses.tfâ”‚    â”œâ”€â”€ sns.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ auth/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ iam.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ monitor/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ cloudwatch.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ network      â”œâ”€â”€ provider.tf      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ route53.tf      â”œâ”€â”€ vpc.tf      â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ           â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹           ...ã€ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆã“ã®å ´åˆã§ã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ applicationâ”‚    â””â”€â”€ terraform.tfstate # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ authâ”‚    â””â”€â”€ terraform.tfstate # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ monitorâ”‚    â””â”€â”€ terraform.tfstate # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ network      â””â”€â”€ terraform.tfstate # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ Ã— ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ - â˜…ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã‚’çµ„ã¿åˆã‚ã›ã¦tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸­é–“å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„é‹ç”¨ãƒãƒ¼ãƒ å†…ã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚â–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦ã€ãƒãƒ¼ãƒ åˆ¥ Ã— ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä»¥ä¸‹ã®é‹ç”¨ãƒãƒ¼ãƒ ã«åˆ†å‰²ã—ãŸçŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ã¾ãŸã€å„é‹ç”¨ãƒãƒ¼ãƒ ã§Terraformã‚’å¤‰æ›´ã§ãã‚‹ç®¡ç†è€…ãŒç›¸å½“æ•°ã™ã‚‹ãŸã‚ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã«ã‚‚åˆ†å‰²ã—ãŸã¨ã—ã¾ã™ã€‚frontendãƒãƒ¼ãƒ applicationmonitorbackendãƒãƒ¼ãƒ applicationmonitorsreãƒãƒ¼ãƒ applicationauthmonitornetworkã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜ã¯ä¸€æ–¹å‘æœ€çµ‚çš„ã«ã€sreãƒãƒ¼ãƒ ã®ç®¡ç†ã™ã‚‹ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ Ã— ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWS        subgraph tes-bucket            subgraph frontend-team               frontendApplication[\"application-tfstate\u003cbr\u003e(CloudFront, S3, ãªã©)\"]               frontendMonitor[\"monitor-tfstate\u003cbr\u003e(CloudWatch, ãªã©)\"]            end            subgraph backend-team                backendApplication[\"application-tfstate\u003cbr\u003e(API Gateway, ElastiCache, RDS, SES, SNS, ãªã©)\"]                backendMonitor[\"monitor-tfstate\u003cbr\u003e(CloudWatch, ãªã©)\"]            end            subgraph sre-team                sreApplication[\"application-tfstate\u003cbr\u003eWeb3å±¤ã¨å‘¨è¾ºAWSãƒªã‚½ãƒ¼ã‚¹\u003cbr\u003e(ALB, EC2, ECS, EKS, SNS, ãªã©)\"]                auth[\"auth-tfstate\u003cbr\u003e(IAM, ãªã©)\"]                sreMonitor[\"monitor-tfstate\u003cbr\u003e(CloudWatch, ãªã©)\"]                network[\"network-tfstate\u003cbr\u003e(Route53, VPC, ãªã©)\"]            end            frontendApplication-...-\u003enetwork            sreApplication-...-\u003eauth            sreApplication-...-\u003enetwork            backendApplication-...-\u003eauth            backendApplication-...-\u003enetwork            frontendMonitor-...-\u003efrontendApplication            sreMonitor-...-\u003esreApplication            backendMonitor-...-\u003ebackendApplication        end    subgraph stg-bucket        stg[\"tfstate\"]    end    subgraph prd-bucket        prd[\"tfstate\"]    end    endã€ãƒãƒ¼ãƒ åˆ¥ Ã— ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã‚’çµ„ã¿åˆã‚ã›ã¦åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ğŸ± aws-frontend-team-repository/â”œâ”€â”€ ğŸ“‚ application/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ cloudfront.tfâ”‚    â”œâ”€â”€ ses.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ monitor/      â”œâ”€â”€ provider.tf      â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹      â”œâ”€â”€ cloudwatch.tf      â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ            â”œâ”€â”€ backend.tfvars # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹            ...ğŸ± aws-backend-team-repository/â”œâ”€â”€ ğŸ“‚ application/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ api_gateway.tfâ”‚    â”œâ”€â”€ elasticache.tfâ”‚    â”œâ”€â”€ rds.tfâ”‚    â”œâ”€â”€ ses.tfâ”‚    â”œâ”€â”€ sns.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ monitor/      â”œâ”€â”€ provider.tf      â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹      â”œâ”€â”€ cloudwatch.tf      â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ            â”œâ”€â”€ backend.tfvars # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹            ...ğŸ± aws-sre-team-repository/â”œâ”€â”€ ğŸ“‚ application/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ alb.tfâ”‚    â”œâ”€â”€ ec2.tfâ”‚    â”œâ”€â”€ ecs.tfâ”‚    â”œâ”€â”€ eks.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ auth/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ iam.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ monitor/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ cloudwatch.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ network      â”œâ”€â”€ provider.tf      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ route53.tf      â”œâ”€â”€ vpc.tf      â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ            â”œâ”€â”€ backend.tfvars # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹            ...â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆé‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã‚’çµ„ã¿åˆã‚ã›ã‚‹åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ã¨ãƒªãƒã‚¸ãƒˆãƒªãŒå·¨å¤§ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚ã€ãƒãƒ¼ãƒ åˆ¥ Ã— ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆé‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã‚’çµ„ã¿åˆã‚ã›ã‚‹åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆã“ã®å ´åˆã§ã¯ã€é‹ç”¨ãƒãƒ¼ãƒ è²¬å‹™ç¯„å›²åˆ¥ã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ã‚’çµ„ã¿åˆã‚ã›ã¦åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ frontend-teamâ”‚    â”œâ”€â”€ ğŸ“‚ applicationâ”‚    â”‚    â””â”€â”€ terraform.tfstate # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ monitorâ”‚         â””â”€â”€ terraform.tfstate # frontendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ backend-teamâ”‚    â”œâ”€â”€ ğŸ“‚ applicationâ”‚    â”‚    â””â”€â”€ terraform.tfstate # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ monitorâ”‚          â””â”€â”€ terraform.tfstate # backendãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ sre-team      â”œâ”€â”€ ğŸ“‚ application      â”‚    â””â”€â”€ terraform.tfstate # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤      â”‚      â”œâ”€â”€ ğŸ“‚ auth      â”‚    â””â”€â”€ terraform.tfstate # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤      â”‚      â”œâ”€â”€ ğŸ“‚ monitor      â”‚    â””â”€â”€ terraform.tfstate # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤      â”‚      â””â”€â”€ ğŸ“‚ network            â””â”€â”€ terraform.tfstate # sreãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦åŒã˜ãƒ†ãƒŠãƒ³ãƒˆ (ä¾‹ï¼šåŒã˜AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åŒã˜VPC) å†…ã«è¤‡æ•°ã®å°ã•ãªãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ã§tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸­é–“å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã“ã§ã„ã†ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¯ã€ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã™ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  (ä¾‹ï¼šEKSã€ECSã€AppRunnerã€EC2) ã¨ãã‚Œã‚’å–ã‚Šå·»ãAWSãƒªã‚½ãƒ¼ã‚¹ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚â–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«åˆ†å‰²ã—ãŸçŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆbarãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå…±æœ‰networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (ä¾‹ï¼šVPCã€Route53)ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜ã¯ä¸€æ–¹å‘æœ€çµ‚çš„ã«ã€å…±æœ‰networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWS        subgraph tes-bucket            foo-product[\"foo-product-tfstate\u003cbr\u003e(ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã™ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®AWSãƒªã‚½ãƒ¼ã‚¹)\"]-..-\u003enetwork            bar-product[\"bar-product-tfstate\u003cbr\u003e(ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã™ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®AWSãƒªã‚½ãƒ¼ã‚¹)\"]-..-\u003enetwork            network[\"network-tfstate\u003cbr\u003e(Route53, VPC)\"]        end    subgraph stg-bucket        stg[\"tfstate\"]    end    subgraph prd-bucket        prd[\"tfstate\"]    end    endã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚# fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒã‚¸ãƒˆãƒªğŸ± aws-foo-product-repository/â”œâ”€â”€ provider.tfâ”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ      â”œâ”€â”€ backend.tfvars # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      ...# barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒã‚¸ãƒˆãƒªğŸ± aws-bar-product-repository/â”œâ”€â”€ provider.tfâ”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ      â”œâ”€â”€ backend.tfvars # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      ...# å…±æœ‰networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒã‚¸ãƒˆãƒªğŸ± aws-network-repository/â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”œâ”€â”€ provider.tfâ”œâ”€â”€ route53.tfâ”œâ”€â”€ vpc.tfâ”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    ...â”‚â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ      â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      ...â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ ğŸ“‚ foo-product/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ bar-product/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ network      â”œâ”€â”€ provider.tf      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹      â”œâ”€â”€ route53.tf      â”œâ”€â”€ vpc.tf      â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ           â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹           ...ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆåŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆã“ã®å ´åˆã§ã¯ã€åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚å‰è¿°ã®ä¾å­˜é–¢ä¿‚å›³ã®çŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ foo-productâ”‚    â””â”€â”€ terraform.tfstate # fooãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ bar-productâ”‚    â””â”€â”€ terraform.tfstate # barãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ network      â””â”€â”€ terraform.tfstate # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã§tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸­é–“å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—ã‚‚ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚â–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦terraform_remote_stateãƒ–ãƒ­ãƒƒã‚¯åœ°ç„ã«ãªã£ã¦ã„ããŸã‚ã€é©åˆ‡ãªæ•° (3ã€œ5å€‹ãã‚‰ã„) ã«ã—ã¦ãŠãã‚ˆã†ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ç‰¹ã«ã“ã®åˆ†å‰²æ–¹æ³•ã¯ã€ã‚°ãƒ«ãƒ¼ãƒ—æ•°ãŒã©ã‚“ã©ã‚“å¢—ãˆã¦ã„ãå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ğŸ˜‡ã€ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†å‰²ã—ãŸçŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚application (Webã‚µãƒ¼ãƒãƒ¼ã€Appã‚µãƒ¼ãƒãƒ¼ç³»)auth (èªè¨¼/èªå¯ç³»)datastore (DBã‚µãƒ¼ãƒãƒ¼ç³»)cicd (CI/CDç³»)monitor (ç›£è¦–ç³»)network (ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç³»)ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜ã¯ä¸€æ–¹å‘æœ€çµ‚çš„ã«ã€networkã‚°ãƒ«ãƒ¼ãƒ—ã‚„authã‚°ãƒ«ãƒ¼ãƒ—ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWS        subgraph tes-bucket            application[\"application-tfstate\u003cbr\u003eä¾‹: ALB, API Gateway, CloudFront, EC2, ECS, EKS, SNS, ãªã©\"]            auth[\"auth-tfstate\u003cbr\u003eä¾‹: IAM, ãªã©\"]            cicd[\"cicd-tfstate\u003cbr\u003eä¾‹: Code3å…„å¼Ÿ, ãªã©\"]            monitor[\"monitor-tfstate\u003cbr\u003eä¾‹: CloudWatch, ãªã©\"]            network[\"network-tfstate\u003cbr\u003eä¾‹: Route53, VPC, ãªã©\"]            datastore[\"datastore-tfstate\u003cbr\u003eä¾‹: ElastiCache, RDS, S3, ãªã©\"]            application-....-\u003eauth            application-..-\u003edatastore            application-...-\u003enetwork            cicd-..-\u003eapplication            datastore-..-\u003enetwork            monitor-..-\u003eapplication            monitor-..-\u003edatastore       end    subgraph stg-bucket        stg[\"tfstate\"]    end    subgraph prd-bucket        prd[\"tfstate\"]    end    endã€ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ã¨ãƒªãƒã‚¸ãƒˆãƒªãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ ğŸ“‚ application/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ alb.tfâ”‚    â”œâ”€â”€ api_gateway.tfâ”‚    â”œâ”€â”€ cloudfront.tfâ”‚    â”œâ”€â”€ ec2.tfâ”‚    â”œâ”€â”€ ecs.tfâ”‚    â”œâ”€â”€ eks.tfâ”‚    â”œâ”€â”€ ses.tfâ”‚    â”œâ”€â”€ sns.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ auth/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ iam.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ cicd/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ codebuild.tfâ”‚    â”œâ”€â”€ codecommit.tfâ”‚    â”œâ”€â”€ codedeploy.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # cicdã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # cicdã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # cicdã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ datastore/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ elasticache.tfâ”‚    â”œâ”€â”€ rds.tfâ”‚    â”œâ”€â”€ s3.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # datastoreã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # datastoreã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # datastoreã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ monitor/â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ cloudwatch.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ network      â”œâ”€â”€ provider.tf      â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã€outputãƒ–ãƒ­ãƒƒã‚¯ã‚’å®šç¾©ã™ã‚‹      â”œâ”€â”€ route53.tf      â”œâ”€â”€ vpc.tf      â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒ      â”‚    â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒ           â”œâ”€â”€ backend.tfvars # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹           ...ã€ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆã“ã®å ´åˆã§ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ applicationâ”‚    â””â”€â”€ terraform.tfstate # applicationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ authâ”‚    â””â”€â”€ terraform.tfstate # authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ cicdâ”‚    â””â”€â”€ terraform.tfstate # cicdã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ datastoreâ”‚    â””â”€â”€ terraform.tfstate # datastoreã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ monitorâ”‚    â””â”€â”€ terraform.tfstate # monitorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ network      â””â”€â”€ terraform.tfstate # networkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã“ã®åˆ†å‰²æ–¹æ³•ã«ã¤ã„ã¦AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã§tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã€ä¸­é–“å±¤ã‚‚ã“ã‚Œã«åŸºã¥ã„ã¦è¨­è¨ˆã—ã¾ã™ã€‚ã“ã®åˆ†å‰²æ–¹æ³•ã«ã‚ˆã‚Šã€å„å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—ã®ç®¡ç†è€…ãŒäº’ã„ã«å½±éŸ¿ã‚’å—ã‘ãšã«ã€terraformã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚https://www.reddit.com/r/Terraform/comments/126jwa1/comment/jea9bjk/?utm_source=share\u0026utm_medium=web3x\u0026utm_name=web3xcss\u0026utm_term=1\u0026utm_content=share_buttonâ–¶ ãŠã™ã™ã‚åº¦ã«ã¤ã„ã¦ã€å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ä¾‹ãˆã°ã€ä»¥ä¸‹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†å‰²ã—ãŸçŠ¶æ³ã¨ä»®å®šã—ã¾ã™ã€‚å¤‰æ›´é«˜é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—å¤‰æ›´ä¸­é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—å¤‰æ›´ä½é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—ã“ã“ã§ä»®å®šã—ãŸçŠ¶æ³ã§ã¯ã€å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜ã¯ä¸€æ–¹å‘æœ€çµ‚çš„ã«ã€å¤‰æ›´ä½é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€æƒ³å®šã•ã‚Œã‚‹çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ãªãŠã€ä¾å­˜æ–¹å‘ã¯çŠ¶æ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ãã ã•ã„ã€‚---title: AWSãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥---%%{init:{'theme':'default'}}%%flowchart TB    subgraph AWS        subgraph tes-bucket            high[\"high-freq-tfstate\u003cbr\u003eä¾‹: API Gateway, CloudFront, CloudWatch, IAM\"]            middle[\"middle-freq-tfstate\u003cbr\u003eä¾‹: ALB, EC2, ECS, EKS, ElastiCache, RDS, S3, SES, SNS\"]            low[\"low-freq-tfstate\u003cbr\u003eä¾‹: Route53, VPC\"]            high-...-\u003elow            middle-..-\u003elow        end    subgraph stg-bucket        stg[\"tfstate\"]    end    subgraph prd-bucket        prd[\"tfstate\"]    end    endã€å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ã¨ãƒªãƒã‚¸ãƒˆãƒªãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã“ã®å ´åˆã§ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚ğŸ± aws-repository/â”œâ”€â”€ ğŸ“‚ high-freq # é«˜é »åº¦å¤‰æ›´ã‚°ãƒ«ãƒ¼ãƒ—â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹â”‚    â”œâ”€â”€ api_gateway.tfâ”‚    â”œâ”€â”€ cloudfront.tfâ”‚    â”œâ”€â”€ cloudwatch.tfâ”‚    â”œâ”€â”€ ec2.tfâ”‚    â”œâ”€â”€ ecs.tfâ”‚    â”œâ”€â”€ eks.tfâ”‚    â”œâ”€â”€ iam.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tes/ # Tesç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # high-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stg/ # Stgç’°å¢ƒâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # high-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prd/ # Prdç’°å¢ƒâ”‚          â”œâ”€â”€ backend.tfvars # high-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â”œâ”€â”€ ğŸ“‚ low-freq # ä½é »åº¦å¤‰æ›´ã‚°ãƒ«ãƒ¼ãƒ—â”‚    â”œâ”€â”€ provider.tfâ”‚    â”œâ”€â”€ output.tf # ä»–ã® tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹â”‚    â”œâ”€â”€ route53.tfâ”‚    â”œâ”€â”€ vpc.tfâ”‚    â”œâ”€â”€ ğŸ“‚ tesâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # low-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â”œâ”€â”€ ğŸ“‚ stgâ”‚    â”‚    â”œâ”€â”€ backend.tfvars # low-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚    â”‚    ...â”‚    â”‚â”‚    â””â”€â”€ ğŸ“‚ prdâ”‚          â”œâ”€â”€ backend.tfvars # low-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹â”‚          ...â”‚â””â”€â”€ ğŸ“‚ middle-freq # ä¸­é »åº¦å¤‰æ›´ã‚°ãƒ«ãƒ¼ãƒ— (é«˜é »åº¦ã¨ã‚‚ä½é »åº¦ã¨ã‚‚è¨€ãˆãªã„ãƒªã‚½ãƒ¼ã‚¹)      â”œâ”€â”€ provider.tf      â”œâ”€â”€ remote_state.tf # terraform_remote_state ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹      â”œâ”€â”€ elasticache.tf      â”œâ”€â”€ rds.tf      â”œâ”€â”€ s3.tf      â”œâ”€â”€ ses.tf      â”œâ”€â”€ ğŸ“‚ tes      â”‚    â”œâ”€â”€ backend.tfvars # middle-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â”œâ”€â”€ ğŸ“‚ stg      â”‚    â”œâ”€â”€ backend.tfvars # middle-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹      â”‚    ...      â”‚      â””â”€â”€ ğŸ“‚ prd           â”œâ”€â”€ backend.tfvars # middle-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤ tfstate ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹           ...ã€å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã€‘ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆâ–¼ ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆAWSãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå¢—ãˆéãã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚â–¼ åŒã˜ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å ´åˆã“ã®å ´åˆã§ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´é »åº¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã«åˆ†å‰²ã—ãŸtfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ç•°ãªã‚‹ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€tfstateãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã«åŸºã¥ã„ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚å›³ã¨åŒã˜çŠ¶æ³ã‚’ä»®å®šã—ã¦ã„ã¾ã™ã€‚# Tesç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ tes-bucket/â”œâ”€â”€ ğŸ“‚ high-freqâ”‚    â””â”€â”€ terraform.tfstate # high-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â”œâ”€â”€ ğŸ“‚ middle-freqâ”‚    â””â”€â”€ terraform.tfstate # middle-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤â”‚â””â”€â”€ ğŸ“‚ low-freq      â””â”€â”€ terraform.tfstate # low-freqã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’æŒã¤# Stgç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ stg-bucket/â”‚...# Prdç’°å¢ƒã®çŠ¶æ…‹ã®ã¿ã‚’ç®¡ç†ã™ã‚‹ãƒã‚±ãƒƒãƒˆğŸª£ prd-bucket/â”‚...10. ãŠã‚ã‚Šã«Terraformã®tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¾ã—ãŸã€‚ãœã²æ¡ç”¨ã—ã¦ã¿ãŸã„åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã‚ã£ãŸã§ã—ã‚‡ã†ã‹ã€‚Terraformã®é–‹ç™ºç¾å ´ã®å…·ä½“çš„ãªè¦ä»¶ã¯åƒå·®ä¸‡åˆ¥ã§ã‚ã‚Šã€ç‰¹ã«tfstateãƒ•ã‚¡ã‚¤ãƒ«é–“ã®çŠ¶æ…‹ã®ä¾å­˜é–¢ä¿‚ã¯æ§˜ã€…ã§ã™ã€‚ã‚‚ã—ã€ã“ã®è¨˜äº‹ã‚’å‚è€ƒã«è¨­è¨ˆã—ã¦ãã ã•ã‚‹æ–¹ã¯ã€åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¾å ´ã«è½ã¨ã—è¾¼ã‚“ã§è§£é‡ˆã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ğŸ™‡ğŸ»â€ã€Œè‡ªåˆ†ã‚’ä¿¡ã˜ã¦ã‚‚â€¦ä¿¡é ¼ã«è¶³ã‚‹ä»²é–“ã‚’ä¿¡ã˜ã¦ã‚‚â€¦èª°ã«ã‚‚ã‚ã‹ã‚‰ãªã„â€¦ã€(ãŠå‹é”ã®@nwiizo, 2023, Terraform Modules ã§å†åˆ©ç”¨ã§ãã‚‹ã®ã§æœ€é«˜ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ)è¬è¾ä»Šå›ã€Terraformã®åˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åé›†ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®æ–¹ã€…ã‹ã‚‰ã®æ„è¦‹ãƒ»å®Ÿè£…æ–¹æ³•ã‚‚å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚@kiyo_12_07 ã•ã‚“@masasuzu ã•ã‚“@tozastation ã•ã‚“(ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †)ã“ã®å ´ã§æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ğŸ™‡ğŸ»â€è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±Terraform in Action (English Edition)ä½œè€…:Winkler, ScottManningAmazonTerraform: Up and Running: Writing Infrastructure as Codeä½œè€…:Brikman, YevgeniyO'Reilly MediaAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/07/05/001756","isoDate":"2023-07-04T15:17:56.000Z","dateMiliSeconds":1688483876000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€ArgoCDğŸ™ã€‘ArgoCDã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä»•çµ„ã¿","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸ArgoCDã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ§‹æˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç¨®é¡ã«ã¤ã„ã¦ArgoCDãŒãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ä»•çµ„ã¿ã«ã¤ã„ã¦ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. æ¦‚è¦ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»•çµ„ã¿(1) repo-serverã«ã‚ˆã‚‹ã‚¯ãƒ­ãƒ¼ãƒ³å–å¾—(2) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå–å¾—(3) application-controllerã«ã‚ˆã‚‹Clusterç¢ºèª(4) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœä¿ç®¡(5) argocd-serverã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—(6) ç®¡ç†è€…ã®ãƒ­ã‚°ã‚¤ãƒ³(7) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå§”è­²(8) dex-serverã«ã‚ˆã‚‹èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡(9) argocd-serverã«ã‚ˆã‚‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè¡Œ(10) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤03. repo-serverrepo-serverã¨ã¯ä»•çµ„ã¿(1) InitContainerã«ã‚ˆã‚‹ãŠå¥½ããªãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« \u0026 argocd-cliãƒã‚¤ãƒŠãƒªã‚³ãƒ”ãƒ¼(2) repo-serverã«ã‚ˆã‚‹èªè¨¼æƒ…å ±å–å¾—(3) repo-serverã®ã‚ˆã‚‹ã‚¯ãƒ­ãƒ¼ãƒ³å–å¾—ã¨ãƒãƒ¼ãƒªãƒ³ã‚°(4) repo-serverã«ã‚ˆã‚‹ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ¼ãƒ«(5) repo-serverã«ã‚ˆã‚‹æš—å·åŒ–ã‚­ãƒ¼ã¨æš—å·åŒ–å¤‰æ•°ã®å–å¾—(6) ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‡¦ç†ã®å–å¾—(7) ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‡¦ç†ã®å®Ÿè¡Œ04. application-controllerã€redis-serverapplication-controllerã¨ã¯redis-serverã¨ã¯ä»•çµ„ã¿(1) ArgoCDç”¨Clusterç®¡ç†è€…ã®kubectl applyã‚³ãƒãƒ³ãƒ‰(2) application-controllerã«ã‚ˆã‚‹ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®Reconciliation(3) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå–å¾—(4) application-controllerã«ã‚ˆã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯(5) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå·®åˆ†æ¤œå‡º(6) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœä¿ç®¡(7) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤05. dex-serverdex-serverã¨ã¯ä»•çµ„ã¿(1) ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã®ãƒ­ã‚°ã‚¤ãƒ³(2) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå§”è­²(3) dex-serverã«ã‚ˆã‚‹èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ(4) dex-serverã«ã‚ˆã‚‹èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡(5) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã‚ˆã‚‹èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½(6) argocd-serverã«ã‚ˆã‚‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½06. argocd-server (argocd-apiserver)argocd-serverã¨ã¯ä»•çµ„ã¿(1) application-controllerã«ã‚ˆã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯(2) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå·®åˆ†æ¤œå‡º(3) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœä¿ç®¡(4) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœå–å¾—(5) ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã®ãƒ­ã‚°ã‚¤ãƒ³(6) Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°(7) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå§”è­²(8) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã‚ˆã‚‹èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½(9) argocd-serverã«ã‚ˆã‚‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½(10) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤07. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã¾ã¨ã‚08. ãŠã‚ã‚Šã«è¬è¾è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«ãƒ­ã‚±ãƒƒãƒˆã«ä¹—ã‚‹ã‚¿ã‚³ã®ãƒ„ãƒ©ãŒè…¹ç«‹ã¤ã‚ãƒ¼ã€‚ç”»åƒå¼•ç”¨å…ƒï¼šArgo Projectã•ã¦æœ€è¿‘ã®æ¥­å‹™ã§ã€å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®æŠ€è¡“åŸºç›¤é–‹ç™ºãƒãƒ¼ãƒ ã«æºã‚ã£ã¦ãŠã‚Šã€å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå…±æœ‰ã®ArgoCDğŸ™ã¨AWS EKSã‚’ãƒªãƒ—ãƒ¬ã‚¤ã‚¹ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€æ¡ç”¨ã—ãŸè¨­è¨ˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ç´¹ä»‹ã‚‚å…¼ã­ã¦ã€ArgoCDã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä»•çµ„ã¿ã‚’è¨˜äº‹ã§è§£èª¬ã—ã¾ã—ãŸã€‚ArgoCDã¯ã€kubectlã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ArgoCDã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¯å¤‰é·ãŒã‚ã‚Šã€è§£èª¬ã™ã‚‹ã®ã¯åŸ·ç­†æ™‚ç‚¹ (2023/05/02) ã§æœ€æ–°ã® 2.6 ç³»ã®ArgoCDã§ã™ã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚„ä»•çµ„ã¿ã¯ã‚‚ã¡ã‚ã‚“ã€å€‹ã€…ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®å®Ÿè£…ã«ã‚‚ã¡ã‚‡ã£ã¨ã ã‘è¨€åŠã—ã¾ã™ã€‚ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. æ¦‚è¦ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¾ãšã¯ã€ArgoCDã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã©ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ArgoCDå…¬å¼ã‹ã‚‰ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå›³ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚å›³ã‹ã‚‰ã€æ¬¡ã®ã‚ˆã†ãªã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ğŸ‘‡ä¸‹ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼å‘ãã«ã—ã‹ä¾å­˜æ–¹å‘ãŒãªãã€ä¾‹ãˆã°ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§ä¾å­˜æ€§ã¯é€†è»¢ã•ã›ã¦ã„ãªã„ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç¨®é¡ (UIã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã‚¤ãƒ³ãƒ•ãƒ©) ã¨ãã‚Œã‚‰ã®ä¾å­˜æ–¹å‘ã‹ã‚‰ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚ˆã†ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†ã‘ã¦ã„ã‚‹ã€‚ç‰¹ã«ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆ†å‰²ã•ã‚Œã¦ãŠã‚Šã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã€‚argo-cd/docs/developer-guide/architecture/components.md at v2.8.0 Â· argoproj/argo-cd Â· GitHubâ–¶ ArgoCDã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ†å‰²å˜ä½ã«ã¤ã„ã¦Monolith to Microservices: Evolutionary Patterns to Transform Your Monolith (English Edition)â–¶ ArgoCDã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¨­è¨ˆå›³ã«ã¤ã„ã¦https://microsoft.github.io/code-with-engineering-playbook/design/diagram-types/DesignDiagramsTemplates/componentDiagrams/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¬¡ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç¨®é¡ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ArgoCDã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒçµ„ã¿åˆã‚ã•ã‚Šã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®è‡ªå‹•çš„ãªãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã—ã¾ã™ã€‚ArgoCD (2.6ç³») ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã„ãã¤ã‹ã‚ã‚Šã€ä¸»è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç¨®é¡ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ                       ãƒ¬ã‚¤ãƒ¤ãƒ¼              æ©Ÿèƒ½                                                                                                                                                                                                             argocd-server(argocd-apiserver)  UIãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³  ã¿ã‚“ãªãŒã‚ˆãçŸ¥ã‚‹ArgoCDã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã™ã€‚ã¾ãŸã€ArgoCDã®APIã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã™ã€‚ç¾åœ¨ã€è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™ã‚’æŒã£ã¦ãŠã‚Šã€å°†æ¥çš„ã«UIã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç•°ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆ†å‰²ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚  application-controller               ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³          Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã¾ãŸã€ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã™ã€‚                                                                                            repo-server                          ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³          ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ/ãƒãƒ£ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚ã¾ãŸã€ã‚¯ãƒ­ãƒ¼ãƒ³ã‹ã‚‰ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚                                                                                                        redis-server                         ã‚¤ãƒ³ãƒ•ãƒ©              application-controllerã®å‡¦ç†çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿ç®¡ã—ã¾ã™ã€‚                                                                                                                                                       dex-server                           ã‚¤ãƒ³ãƒ•ãƒ©              SSOã‚’æ¡ç”¨ã™ã‚‹å ´åˆã€argocd-serverã®ä»£ã‚ã‚Šã«èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã€ã¾ãŸIDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€argocd-serverä¸Šã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã‚’IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å§”è­²ã§ãã¾ã™ã€‚                                 GitOps and Kubernetes: Continuous Deployment with Argo CD, Jenkins X, and Fluxä»¥é™ã®å›³ã®å‡¡ä¾‹ã§ã™ã€‚ArgoCDã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (application-controllerã€argocd-serverã€dex-serverã€repo-server) ã¨å„ãƒªã‚½ãƒ¼ã‚¹ (Applicationã€AppProject) ã‚’åŒºåˆ¥ã—ã¦ã„ã¾ã™ã€‚ä»•çµ„ã¿ãã‚Œã§ã¯ã€ArgoCDã¯ã€ã©ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚ã“ã“ã§ã¯ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€… (ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¨ãªã‚‹Clusterã‚’ç®¡ç†ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢) ã¯ã€ArgoCDã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä»‹ã—ã¦ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã—ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯ã€æ¦‚è¦ã‚’èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚(1) repo-serverã«ã‚ˆã‚‹ã‚¯ãƒ­ãƒ¼ãƒ³å–å¾—ArgoCDã®Clusterä¸Šã§ã€repo-serverãŒãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ/ãƒãƒ£ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚(2) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå–å¾—application-controllerã¯ã€repo-serverã‹ã‚‰ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚(3) application-controllerã«ã‚ˆã‚‹Clusterç¢ºèªapplication-controllerã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã®ç¾çŠ¶ã‚’ç¢ºèªã—ã¾ã™ã€‚(4) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœä¿ç®¡application-controllerã¯ã€å‡¦ç†çµæœã‚’redis-serverã«ä¿ç®¡ã—ã¾ã™ã€‚(5) argocd-serverã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—argocd-serverã¯ã€redis-serverã‹ã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å–å¾—ã—ã¾ã™ã€‚(6) ç®¡ç†è€…ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã¯ã€argocd-serverã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚(7) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå§”è­²argocd-serverã¯ã€ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã‚’å§”è­²ã™ã‚‹ãŸã‚ã«ã€dex-serverã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã™ã€‚â–¶ argocd-serverã®ãƒ­ã‚°ã‚¤ãƒ³æ‰‹æ³•ã«ã¤ã„ã¦(8) dex-serverã«ã‚ˆã‚‹èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡dex-serverã¯ã€IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã€ã“ã‚Œã‚’IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚(9) argocd-serverã«ã‚ˆã‚‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè¡Œargocd-serverã§èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ãŒå®Œäº†ã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã¯èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã«å¿œã˜ã¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ“ä½œã§ãã¾ã™ã€‚â–¶ ArgoCDã‚’ã©ã®Clusterã§ç®¡ç†ã™ã‚‹ã‹ã«ã¤ã„ã¦(10) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤application-controllerã¯ã€Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä»•çµ„ã¿ã‚’ã–ã£ãã‚Šç´¹ä»‹ã—ã¾ã—ãŸã€‚ãŸã ã“ã‚Œã ã¨å…¨ãé¢ç™½ããªã„ãŸã‚ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å…·ä½“çš„ãªå‡¦ç†ã¨ã€å„ã€…ãŒã©ã®ã‚ˆã†ã«é€šä¿¡ã—ã¦ã„ã‚‹ã®ã‹ã‚’èª¬æ˜ã—ã¾ã™âœŒï¸03. repo-serverrepo-serverã¨ã¯ã¾ãšã¯ã€ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹repo-serverã§ã™ã€‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ/ãƒãƒ£ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒª (ä¾‹ï¼šGiHubã€GitHub Pagesã€Artifact Hubã€AWS ECRã€Artifact Registryãªã©) ã‹ã‚‰ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚repo-serverã‚’æŒã¤Podã«ã¯ã€ä»–ã«è»½é‡ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ãªã‚‹InitContainerã¨ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ (cmp-server) ãŒãŠã‚Šã€ãã‚Œãã‚Œæ©Ÿèƒ½ãŒåˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ğŸ‘ä»•çµ„ã¿(1) InitContainerã«ã‚ˆã‚‹ãŠå¥½ããªãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« \u0026 argocd-cliãƒã‚¤ãƒŠãƒªã‚³ãƒ”ãƒ¼repo-serverã®èµ·å‹•æ™‚ã«ã€InitContainerã§ãŠå¥½ããªãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ« (Helmã€Kustomizeãªã©) ã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ (helm-secretsã€KSOPSã€SOPSã€argocd-vault-pluginãªã©) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã¾ãŸã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã®cmp-serverã§ã¯èµ·å‹•æ™‚ã«/var/run/argocd/argocd-cmp-serverã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€InitContainer (ã“ã“ã§ã¯copyutilã‚³ãƒ³ãƒ†ãƒŠ) ã‚’ä½¿ç”¨ã—ã¦ã€ArgoCDã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰argocd-cliã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚repo-serverã®ã–ã£ãã‚Šã—ãŸå®Ÿè£…ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã“ã“ã§ã¯ã€ArgoCDã§ä½¿ã„ãŸã„ãƒ„ãƒ¼ãƒ« (Helmã€SOPSã€helm-secrets) ã‚’InitContainerã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚apiVersion: v1kind: Podmetadata:  name: argocd-repo-server  namespace: argocdspec:  containers:    - name: repo-server      image: quay.io/argoproj/argocd:latest  initContainers:    # Helmã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹InitContainer    - name: helm-installer      image: alpine:latest      command:        - /bin/sh        - -c      args:        - |          # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†      volumeMounts:        - mountPath: /custom-tools          name: custom-tools    # SOPSã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹InitContainer    - name: sops-installer      image: alpine:latest      command:        - /bin/sh        - -c      args:        - |          # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†      volumeMounts:        - mountPath: /custom-tools          name: custom-tools    # helm-secretsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹InitContainer    - name: helm-secrets-installer      image: alpine:latest      command:        - /bin/sh        - -c      args:        - |          # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†      volumeMounts:        - mountPath: /helm-working-dir/plugins          name: helm-working-dir    ...    # cmp-serverã«argocd-cliã®ãƒã‚¤ãƒŠãƒªã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹InitContainer    - name: copyutil      image: quay.io/argoproj/argocd:latest      command:        - cp        - -n        - /usr/local/bin/argocd        - /var/run/argocd/argocd-cmp-server      volumeMounts:        - name: var-files          mountPath: /var/run/argocd  # Podã®å…±æœ‰ãƒœãƒªãƒ¥ãƒ¼ãƒ   volumes:    - name: custom-tools      emptyDir: {}    - name: var-files      emptyDir: {}Custom Tooling - Argo CD - Declarative GitOps CD for Kubernetesâ–¶ ArgoCDã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦quay.io/argoproj/argocd) ã«ã¯ã€ã„ãã¤ã‹ã®ãƒ„ãƒ¼ãƒ« (ä¾‹ï¼šHelmã€Kustomizeã€Ksã€Jsonnetãªã©) ã®æ¨å¥¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚‰ã‹ã˜ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ (ä¾‹ï¼šhelm-secrets) ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ä¸Šè¨˜ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ãªã‚‹repo-serverå†…ã®ãƒ„ãƒ¼ãƒ«ã‚’cmp-serverã«ã‚³ãƒ”ãƒ¼ã™ã‚Œã°ã‚ˆã„ã®ã§ã¯ã€ã¨æ€ã£ãŸæ–¹ãŒã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã®æ–¹æ³•ã¯å…¨ãå•é¡Œãªãã€cmp-serverã®/usr/local/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ãƒ„ãƒ¼ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚ˆã†ã«ã€InitContainerã‚’å®šç¾©ã—ã¦ã‚‚ã‚ˆã„ã§ã™ã€‚apiVersion: v1kind: Podmetadata:  name: argocd-repo-server  namespace: foospec:  containers:    - name: repo-server      image: quay.io/argoproj/argocd:latest      volumeMounts:        - mountPath: /usr/local/bin/helm          # Podã®å…±æœ‰ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä»‹ã—ã¦ã€repo-serverã§Helmã‚’ä½¿ç”¨ã™ã‚‹ã€‚          name: custom-tools  initContainers:    - name: copy-helm      image: quay.io/argoproj/argocd:latest      # InitContainerä¸Šã®Helmã‚’Volumeã«ã‚³ãƒ”ãƒ¼ã™ã‚‹      command:        - /bin/cp        - -n        - /usr/local/bin/helm        - /custom-tools/helm      volumeMounts:        - mountPath: /custom-tools          name: custom-tools  # å…±æœ‰ãƒœãƒªãƒ¥ãƒ¼ãƒ   volumes:    - name: custom-tools      emptyDir: {}åå¯¾ã«ã€ã“ã‚Œã‚‰ãƒ„ãƒ¼ãƒ«ã‚’InitContainerã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ç›´ã™å ´åˆã¯ã€ArgoCDä¸Šã§ã®æ¨å¥¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã¡ã‚ƒã‚“ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ğŸ‘2.6ç³»ã§ã¯ã€ArgoCDã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã®tool-versions.shãƒ•ã‚¡ã‚¤ãƒ«ã«ã€Helmã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚spec:  ...  initContainers:    - name: helm-installer      image: alpine:latest      command:        - /bin/sh        - -c      # ArgoCDã®ãƒªãƒã‚¸ãƒˆãƒªä¸Šã®tool-versions.shãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€Helmã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹      args:        - |          apk --update add curl wget          ARGOCD_VERSION=$(curl -s https://raw.githubusercontent.com/argoproj/argo-helm/argo-cd-\u003cArgoCDã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³\u003e/charts/argo-cd/Chart.yaml | grep appVersion | sed -e 's/^[^: ]*: //')          HELM_RECOMMENDED_VERSION=$(curl -s https://raw.githubusercontent.com/argoproj/argo-cd/\"${ARGOCD_VERSION}\"/hack/tool-versions.sh | grep helm3_version | sed -e 's/^[^=]*=//')          wget -q https://get.helm.sh/helm-v\"${HELM_RECOMMENDED_VERSION}\"-linux-amd64.tar.gz          tar -xvf helm-v\"${HELM_RECOMMENDED_VERSION}\"-linux-amd64.tar.gz          cp ./linux-amd64/helm /custom-tools/          chmod +x /custom-tools/helm      volumeMounts:        - mountPath: /custom-tools          name: custom-tools  ...argo-cd/hack/tool-versions.sh at v2.6.0 Â· argoproj/argo-cd Â· GitHub(2) repo-serverã«ã‚ˆã‚‹èªè¨¼æƒ…å ±å–å¾—repo-serverã¯ã€Secret (argocd-repo-creds) ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã®èªè¨¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚argocd-repo-credsã§ã¯ãƒªãƒã‚¸ãƒˆãƒªã®èªè¨¼æƒ…å ±ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‹ã‚‰å§‹ã¾ã‚‹ (æœ€é•·ä¸€è‡´) URLã‚’æŒã¤ãƒªãƒã‚¸ãƒˆãƒªã«æ¥ç¶šã™ã‚‹å ´åˆã€ãã‚Œã‚‰ã®æ¥ç¶šã§èªè¨¼æƒ…å ±ã‚’ä¸€æ‹¬ã—ã¦é©ç”¨ã§ãã¾ã™ã€‚argocd-repo-credsã®ã–ã£ãã‚Šã—ãŸå®Ÿè£…ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã“ã“ã§ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã®SSHå…¬é–‹éµèªè¨¼ã‚’æ¡ç”¨ã—ã€argocd-repo-credsã«å…±é€šã®ç§˜å¯†éµã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚apiVersion: v1kind: Secretmetadata:  name: argocd-repo-creds-github  namespace: argocd  labels:    argocd.argoproj.io/secret-type: repo-credstype: Opaquedata:  type: git  url: https://github.com/hiroki-hasegawa  # ç§˜å¯†éµ  sshPrivateKey: |    MIIC2 ...ã‚ã¨ã¯ã€å„ãƒªãƒã‚¸ãƒˆãƒªã®Secret (argocd-repo) ã«URLã‚’è¨­å®šã—ã¦ãŠãã¾ã™ã€‚ã™ã‚‹ã¨ã€å…ˆã»ã©ã®argocd-repo-credsã®URLã«æœ€é•·ä¸€è‡´ã™ã‚‹URLã‚’æŒã¤Secretã«ã¯ã€ä¸€æ‹¬ã—ã¦ç§˜å¯†éµãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚# foo-repositoryã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®argocd-repoapiVersion: v1kind: Secretmetadata:  namespace: argocd  name: foo-argocd-repo  labels:    argocd.argoproj.io/secret-type: repositorytype: Opaquedata:  # èªè¨¼æƒ…å ±ã¯è¨­å®šã—ãªã„ã€‚  # ãƒãƒ£ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªå  name: bar-repository  # https://github.com/hiroki-hasegawa ã«æœ€é•·ä¸€è‡´ã™ã‚‹ã€‚  url: https://github.com/hiroki-hasegawa/bar-chart.git---# baz-repositoryã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®argocd-repoapiVersion: v1kind: Secretmetadata:  namespace: foo  name: baz-argocd-repo  labels:    argocd.argoproj.io/secret-type: repositorytype: Opaquedata:  # èªè¨¼æƒ…å ±ã¯è¨­å®šã—ãªã„ã€‚  # ãƒãƒ£ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªå  name: baz-repository  # https://github.com/hiroki-hasegawa ã«æœ€é•·ä¸€è‡´ã™ã‚‹ã€‚  url: https://github.com/hiroki-hasegawa/baz-chart.gitDeclarative Setup - Argo CD - Declarative GitOps CD for Kubernetes(3) repo-serverã®ã‚ˆã‚‹ã‚¯ãƒ­ãƒ¼ãƒ³å–å¾—ã¨ãƒãƒ¼ãƒªãƒ³ã‚°repo-serverã¯ã€èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã€ãƒªãƒã‚¸ãƒˆãƒªã«git cloneã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚å–å¾—ã—ãŸã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ã€/tmp/_argocd-repoãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«UUIDã®åå‰ã§ä¿ç®¡ã—ã¾ã™ã€‚ã¾ãŸã€ãƒªãƒã‚¸ãƒˆãƒªã®å¤‰æ›´ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã—ã€å¤‰æ›´ã‚’æ¤œçŸ¥ã—ãŸå ´åˆã¯git fetchã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚# ã‚¯ãƒ­ãƒ¼ãƒ³ãŒä¿ç®¡ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹$ kubectl -it exec argocd-repo-server \\    -c repo-server \\    -n foo \\    -- bash -c \"ls /tmp/_argocd-repo/\u003cURLã«åŸºã¥ãUUID\u003e\"# ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«Chart.yaml  README.md  templates  values.yamlcustom repo-server - where is the local cache kept? Â· argoproj argo-cd Â· Discussion #9889 Â· GitHubâ–¶ repo-serverã§ã®ã‚¯ãƒ­ãƒ¼ãƒ³ä¿ç®¡å…ˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å·®ç•°ã«ã¤ã„ã¦2.3ä»¥å‰ã§ã¯ã€repo-serverã¯/tmpãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«URLã«åŸºã¥ãåå‰ã§ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä¿ç®¡ã—ã¾ã™ã€‚$ kubectl -it exec argocd-repo-server \\    -c repo-server \\    -n foo \\    -- bash -c \"ls /tmp/https___github.com_hiroki-hasegawa_foo-repository\"# ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«Chart.yaml  README.md  templates  values.yaml(4) repo-serverã«ã‚ˆã‚‹ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ¼ãƒ«repo-serverã¯ã€è‡ªèº«ã«ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã„ãã¤ã‹ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ« (ä¾‹ï¼šHelmã€Kustomize) ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€å®Ÿè¡Œã§ããªã„ãƒ„ãƒ¼ãƒ«ã§ã¯ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ (cmp-server) ã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã®æ™‚ã€Applicationã®.spec.source.pluginã‚­ãƒ¼ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã®Applicationã§ã¯ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã™ã€‚é€†ã‚’è¨€ãˆã°ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã‚’æŒ‡å®šã—ã¦ã„ãªã„Applicationã¯ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚’ã‚³ãƒ¼ãƒ«ã—ãªã„ ã§ã™ã€‚apiVersion: argoproj.io/v1alpha1kind: Applicationmetadata:  name: foo-application  namespace: foospec:  source:    plugin:      name: helm-secrets # ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã¯ã€ConfigManagementPluginã®metadata.nameã‚­ãƒ¼ã«è¨­å®šã—ãŸã‚‚ã®  ...ã“ã®ã‚³ãƒ¼ãƒ«ã¯ã€Volumeä¸Šã®Unixãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆã‚’çµŒç”±ã—ã¾ã™ã€‚Unixãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿä½“ã¯.sockãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚$ kubectl exec -it argocd-repo-server -c foo-plugin-cmp-server\\    -- bash -c \"ls /home/argocd/cmp-server/plugins/\"foo-plugin.sockâ–¶ Unixã‚½ã‚±ãƒƒãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¤ã„ã¦ASCII.jpï¼šUnixãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆ (1/2)(5) repo-serverã«ã‚ˆã‚‹æš—å·åŒ–ã‚­ãƒ¼ã¨æš—å·åŒ–å¤‰æ•°ã®å–å¾—cmp-serverã¯ã€æš—å·åŒ–ã‚­ãƒ¼ (ä¾‹ï¼šAWS KMSã€Google CKMãªã©) ã‚’ä½¿ç”¨ã—ã¦Secretã‚¹ãƒˆã‚¢ (ä¾‹ï¼šAWS SecretManagerã€Google SecretManagerã€SOPSã€Vaultãªã©) ã®æš—å·åŒ–å¤‰æ•°ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚â–¶ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®æš—å·åŒ–ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¨¼æ˜æ›¸ã«ã¤ã„ã¦/etc/sslãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯OSã«ã‚ˆã£ã¦ç•°ãªã‚‹) ã«è¨¼æ˜æ›¸ãŒç„¡ãã€cmp-serverãŒHTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã¯ã€ãŠå¥½ããªæ–¹æ³•ã§è¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ğŸ‘apiVersion: v1kind: Podmetadata:  name: argocd-repo-server  namespace: foospec:  containers:    - name: repo-server      image: quay.io/argoproj/argocd:latest  ...    # ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã®cmp-server    - name: helm-secrets-cmp-server      image: ubuntu:latest      ...      volumeMounts:        # ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãŒAWS KMSã‚’ä½¿ç”¨ã™ã‚‹æ™‚ã«HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€è¨¼æ˜æ›¸ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹        - name: certificate          mountPath: /etc/ssl  ...  initContainers:    - name: certificate-installer      image: ubuntu:latest      command:        - /bin/sh        - -c      args:        - |          apt-get update -y          # ãƒ«ãƒ¼ãƒˆè¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹          apt-get install -y ca-certificates          # è¨¼æ˜æ›¸ã‚’æ›´æ–°ã™ã‚‹          update-ca-certificates      volumeMounts:        - mountPath: /etc/ssl          name: certificate  volumes:    - name: certificate      emptyDir: {}(6) ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‡¦ç†ã®å–å¾—cmp-serverã¯ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ (helm-secretsã€argocd-vault-pluginãªã©) ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã®æ™‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ä½œæˆæ™‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ã€ConfigMapé…ä¸‹ã®ConfigManagementPluginã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‡¦ç†ã‚’å®šç¾©ã—ã¾ã™ã€‚ã–ã£ãã‚Šã—ãŸå®Ÿè£…ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã“ã“ã§ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦helm-secretsã‚’æ¡ç”¨ã—ã€helm secrets templateã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã‚’å®šç¾©ã—ã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  name: argocd-cmp-cm  namespace: foodata:  helm-secrets-plugin.yaml: |    apiVersion: argoproj.io/v1alpha1    kind: ConfigManagementPlugin    metadata:      namespace: foo      name: helm-secrets # ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã¯ã€Applicationã®spec.source.pluginã‚­ãƒ¼ã§æŒ‡å®šã—ãŸã‚‚ã®    spec:      generate:        command:          - /bin/bash          - -c        args:          - |            set -o pipefail            helm secrets template -f $ARGOCD_ENV_SECRETS -f $ARGOCD_ENV_VALUES -n $ARGOCD_APP_NAMESPACE $ARGOCD_APP_NAME .  foo-plugin.yaml: |    ...â–¶ ConfigManagementPluginã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã¤ã„ã¦(7) ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‡¦ç†ã®å®Ÿè¡Œcmp-serverã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã€Secretã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ConfigMapé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’plugin.yamlã®åå‰ã§ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€å…ˆã»ã©ã®Unixãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆã®.sockãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã€ cmp-serverãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®å„ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚ã–ã£ãã‚Šã—ãŸå®Ÿè£…ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã“ã“ã§ã¯ã€helm-secretsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ (helm-secrets-cmp-server) ã‚’ä½œæˆã—ã¾ã™ã€‚apiVersion: v1kind: Podmetadata:  name: argocd-repo-serverspec:  containers:    # repo-server    - name: repo-server      image: quay.io/argoproj/argocd:latest    ...    # helm-secretsã®cmp-server    - name: helm-secrets-cmp-server      # ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¯è»½é‡ã«ã™ã‚‹      image: ubuntu:latest      command:        - /var/run/argocd/argocd-cmp-server      env:        # helmãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å ´æ‰€ã‚’è¨­å®šã™ã‚‹        - name: HELM_PLUGINS          value: /helm-working-dir/plugins      securityContext:        runAsNonRoot: true        runAsUser: 999      volumeMounts:        # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹        - name: tmp          mountPath: /tmp        # ConfigManagementPluginã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ (helm-secrets.yaml) ã‚’ \"plugin.yaml\" ã®åå‰ã§ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹        - name: argocd-cmp-cm          mountPath: /home/argocd/cmp-server/config/plugin.yaml          subPath: helm-secrets.yaml        # ã‚³ãƒ³ãƒ†ãƒŠé–“ã§é€šä¿¡ã™ã‚‹ãŸã‚ã®Unixãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹        - name: plugins          mountPath: /home/argocd/cmp-server/plugins        # ä»»æ„ã®ãƒ„ãƒ¼ãƒ«ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹        - name: custom-tools          mountPath: /usr/local/bin        # helmãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒã‚¤ãƒŠãƒªã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹        - name: helm-working-dir          mountPath: /helm-working-dir/plugins      ...  # Podã®å…±æœ‰ãƒœãƒªãƒ¥ãƒ¼ãƒ   volumes:    # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’å«ã‚€    - name: tmp      emptyDir: {}    # Helmãªã©ã®ä»»æ„ã®ãƒ„ãƒ¼ãƒ«ã‚’å«ã‚€    - name: custom-tools      emptyDir: {}    # helmãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å«ã‚€    - name: helm-working-dir      emptyDir: {}â–¶ ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ConfigManagementPluginã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã¤ã„ã¦v2.6ã§ã¯ã€ConfigManagementPluginã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’/home/argocd/cmp-server/configãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã€plugin.yamlã®åå‰ã§ãƒã‚¦ãƒ³ãƒˆã—ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€cmp-serverã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ (/var/run/argocd/argocd-cmp-server) ãŒplugin.yamlã®åå‰ã—ã‹æ‰±ãˆãªã„ãŸã‚ã§ã™ã€‚ArgoCDå…¬å¼ã®è¦‹è§£ã§ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã§ã¯å˜ä¸€ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã—ã‹å®Ÿè¡Œã§ããªã„ã‚ˆã†ã«è¨­è¨ˆã—ã¦ã„ã‚‹ã¨ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã—ãŸã€‚ä»Šå¾Œã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§æ”¹å–„ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€v2.6ã§ã¯ã€ConfigManagementPluginã®æ•°ã ã‘cmp-serverãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ğŸ™‡ğŸ»â€use multiple plugins in sidecar installation method Â· argoproj argo-cd Â· Discussion #12278 Â· GitHubâ–¶ Kustomizeã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œã™ã‚‹ã‹ã«ã¤ã„ã¦â–¶ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®Secretã‚¹ãƒˆã‚¢ã‚’æ¡ç”¨ã™ã‚‹å ´åˆã«ã¤ã„ã¦How to manage Kubernetes secrets with GitOps? | Akuity04. application-controllerã€redis-serverapplication-controllerã¨ã¯ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹application-controllerã§ã™ã€‚Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã¾ãŸã€ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã™ã€‚redis-serverã¨ã¯ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹redis-serverã§ã™ã€‚application-controllerã®å‡¦ç†çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿ç®¡ã—ã¾ã™ã€‚ä»•çµ„ã¿(1) ArgoCDç”¨Clusterç®¡ç†è€…ã®kubectl applyã‚³ãƒãƒ³ãƒ‰ArgoCDç”¨Clusterã®ç®¡ç†è€…ã¯ã€Clusterã«ArgoCDç³»ã®ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ (ä¾‹ï¼šApplicationã€AppProjectãªã©)ã€€ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚â–¶ ArgoCDè‡ªä½“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«argo-helmã‚’æ¡ç”¨ã™ã‚‹å ´åˆã«ã¤ã„ã¦GitHub - argoproj/argo-helm: ArgoProj Helm ChartsãŸã ã—Helmã®é‡è¦ãªä»•æ§˜ã¨ã—ã¦ã€ãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°æ™‚ã«ä½¿ç”¨ã™ã‚‹helm upgradeã‚³ãƒãƒ³ãƒ‰ã¯ã€CRDã‚’ä½œæˆã§ãã‚‹ä¸€æ–¹ã§ã“ã‚Œã‚’å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚Helmã§CRDã‚’ä½œæˆã™ã‚‹ã¨Helmã®ç®¡ç†ãƒ©ãƒ™ãƒ«ãŒæŒ¿å…¥ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ä½œæˆã®æ™‚ç‚¹ã‹ã‚‰CRDãŒHelmã®ç®¡ç†å¤–ã¨ãªã‚‹ã‚ˆã†ã«ã€kubectlã‚³ãƒãƒ³ãƒ‰ã§CRDã‚’ä½œæˆã—ãŸæ–¹ãŒã‚ˆã„ã§ã™ğŸ‘$ kubectl diff -k \"https://github.com/argoproj/argo-cd/manifests/crds?ref=\u003cãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°\u003e\"$ kubectl apply -k \"https://github.com/argoproj/argo-cd/manifests/crds?ref=\u003cãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°\u003e\"ArgoCDä¸Šã§Helmã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã¯ã“ã®ä»•æ§˜ã‚’æ°—ã«ã—ãªãã¦ã‚ˆã„ã®ã‹ãªã€ã¨æ€ã£ãŸæ–¹ãŒã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚ã§ã™ãŒæœ¬è¨˜äº‹ã§è§£èª¬ã—ãŸé€šã‚Šã€ArgoCDã¯cmp-serverã®helm templateã‚³ãƒãƒ³ãƒ‰ (ã“ã®æ™‚ã€--include-crdsã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹) ã‚„ã€application-controllerã®kubectl applyã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹ãŸã‚ã€CRDã‚‚ã¡ã‚ƒã‚“ã¨æ›´æ–°ã—ã¦ãã‚Œã¾ã™ğŸ‘ğŸ»ï¸Helm | Custom Resource Definitions(2) application-controllerã«ã‚ˆã‚‹ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®Reconciliationkube-controller-managerã¯ã€application-controllerã‚’æ“ä½œã—ã€Reconciliationã‚’å®Ÿæ–½ã—ã¾ã™ã€‚application-controllerã¯ã€Etcdä¸Šã«æ°¸ç¶šåŒ–ã•ã‚ŒãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¨åŒã˜çŠ¶æ…‹ã®ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ/å¤‰æ›´ã—ã¾ã™ã€‚â–¶ ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã‚‚ã‚ã‚‹application-controllerã«ã¤ã„ã¦How Operators work in Kubernetes | Red Hat Developer(3) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå–å¾—application-controllerã¯ã€repo-serverã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚å–å¾—ã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¯ã€repo-serverã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã§ã‚ã‚‹cmp-serverãŒä½œæˆã—ãŸã‚‚ã®ã§ã™ã€‚(4) application-controllerã«ã‚ˆã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯application-controllerã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã‚’ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚application-controllerã«ã¯ã€gitops-engineãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå†…è”µã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã¯ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã®åŸºæœ¬çš„ãªå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚â–¶ gitops-engineãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¤ã„ã¦v0.7.0 ã§ã¯ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ãªã‚Šã¾ã™ğŸ‘‡ğŸ± gitops-engine/â”œâ”€â”€ ğŸ“‚ pkgâ”‚    â”œâ”€â”€ cacheâ”‚    â”œâ”€â”€ diff   # ãƒªãƒã‚¸ãƒˆãƒªã¨Clusterã®é–“ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®å·®åˆ†ã‚’æ¤œå‡ºã™ã‚‹ã€‚ArgoCDã®Diffæ©Ÿèƒ½ã«ç›¸å½“ã™ã‚‹ã€‚â”‚    â”œâ”€â”€ engine # ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã„ã€GitOpsã®ä¸€é€£ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã€‚â”‚    â”œâ”€â”€ health # Clusterã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚ArgoCDã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã«ç›¸å½“ã™ã‚‹ã€‚â”‚    â”œâ”€â”€ sync   # Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚ArgoCDã®Syncæ©Ÿèƒ½ã«ç›¸å½“ã™ã‚‹ã€‚â”‚    â””â”€â”€ utils  # ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«æ±ç”¨çš„ãªé–¢æ•°ã‚’æä¾›ã™ã‚‹ã€‚â”‚...gitops-engine/specs/design-top-down.md at v0.7.0 Â· argoproj/gitops-engine Â· GitHub(5) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå·®åˆ†æ¤œå‡ºapplication-controllerã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¨ã€repo-serverã‹ã‚‰å–å¾—ã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®å·®åˆ†ã‚’æ¤œå‡ºã—ã¾ã™ã€‚ã“ã“ã§ã€kubectl diffã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒè‡ªå‹•åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚(6) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœä¿ç®¡application-controllerã¯ã€å‡¦ç†çµæœã‚’redis-serverã«ä¿ç®¡ã—ã¾ã™ã€‚redis-serverã¯ã€Applicationã‚„ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒŸãƒƒãƒˆã®å˜ä½ã§ã€application-controllerã®å‡¦ç†çµæœã‚’ä¿ç®¡ã—ã¦ã„ã¾ã™ã€‚$ kubectl exec -it argocd-redis-server \\    -n foo \\    -- sh -c \"redis-cli --raw\"127.0.0.1:6379\u003e keys *...app|resources-tree|\u003cApplicationå\u003e|\u003cã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³\u003ecluster|info|\u003cãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã®URL\u003e|\u003cã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³\u003egit-refs|\u003cãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ/ãƒãƒ£ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®URL\u003e|\u003cã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³\u003emfst|app.kubernetes.io/instance|\u003cApplicationå\u003e|\u003cæœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥å€¤\u003e|\u003cãƒ‡ãƒ—ãƒ­ã‚¤å…ˆNamespace\u003e|*****|\u003cã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³\u003e...(7) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤application-controllerã¯ã€Applicationã®æ“ä½œã«å¿œã˜ã¦ã€Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ã“ã“ã§ã€kubectl applyã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒè‡ªå‹•åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚â–¶ application-controllerãŒãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ“ä½œã—ãŸè¨¼æ‹ ã«ã¤ã„ã¦metadata.managedFieldsã‚­ãƒ¼ãŒã‚ã‚Šã€ä½•ãŒãã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½œæˆ/å¤‰æ›´ã—ãŸã®ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚å®Ÿéš›ã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€ç¢ºã‹ã«application-controllerãŒãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½œæˆ/å¤‰æ›´ã—ã¦ãã‚ŒãŸã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚apiVersion: apps/v1kind: Deploymentmetadata:  managedFields:    # ArgoCDã®application-controllerã«ã‚ˆã‚‹ç®¡ç†    - manager: argocd-application-controller      apiVersion: apps/v1      # kube-apiserverã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹      operation: Update      time: \"2022-01-01T16:00:00.000Z\"      # ArgoCDã®application-controllerãŒç®¡ç†ã™ã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ã‚­ãƒ¼éƒ¨åˆ†      fields: ...ï¸Server-Side Apply | Kubernetes05. dex-serverdex-serverã¨ã¯ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹dex-serverã§ã™ã€‚SSO (ä¾‹ï¼šOAuth 2.0ã€SAMLã€OIDC) ã‚’æ¡ç”¨ã™ã‚‹å ´åˆã€argocd-serverã®ä»£ã‚ã‚Šã«èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã€ã¾ãŸIDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (ä¾‹ï¼šGitHubã€Keycloakã€AWS Cognitoã€Google Authãªã©) ã«é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€argocd-serverä¸Šã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã‚’IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å§”è­²ã§ãã¾ã™ã€‚GitHub - dexidp/dex: OpenID Connect (OIDC) identity and OAuth 2.0 provider with pluggable connectorsâ–¶ dex-serverã®å¿…è¦æ€§ã«ã¤ã„ã¦2.0ã€SAML) ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€dex-serverã‚’æ¡ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ğŸ‘ï¸Overview - Argo CD - Declarative GitOps CD for Kubernetesä»•çµ„ã¿(1) ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (argocd-server) ã«SSOã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚(2) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå§”è­²argocd-serverã¯ã€èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã‚’IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å§”è­²ã™ã‚‹ãŸã‚ã«ã€dex-serverã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã™ã€‚â–¶ èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã®å§”è­²ã«ã¤ã„ã¦Authentication and Authorization - Argo CD - Declarative GitOps CD for Kubernetes(3) dex-serverã«ã‚ˆã‚‹èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆdex-serverã¯ã€èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿…è¦ãªæƒ…å ±ã¯ã€ConfigMap (argocd-cm) ã§è¨­å®šã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚argocd-cmã®ã–ã£ãã‚Šã—ãŸå®Ÿè£…ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã“ã“ã§ã¯ã€IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’GitHubã¨ã—ã€èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿…è¦ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚apiVersion: v1kind: ConfigMapmetadata:  namespace: foo  name: argocd-cmdata:  dex.config: |    connectors:      - type: github        id: github        name: GitHub SSO        config:          clientID: *****          clientSecret: *****        # dex-serverãŒèªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚ˆã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’å—ä¿¡ã™ã‚‹URLã‚’è¨­å®šã™ã‚‹        redirectURI: https://example.com/api/dex/callbackâ–¶ dex-serverã®è¨­å®šã«ã¤ã„ã¦dex.configã‚­ãƒ¼é…ä¸‹ã®è¨­å®šæ–¹æ³•ã¯ã€dexã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã¿ã‚‹ã¨ã‚ˆã„ã§ã™ğŸ‘Authentication Through GitHub |(4) dex-serverã«ã‚ˆã‚‹èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡dex-serverã¯ã€å‰ã®æ‰‹é †ã§ä½œæˆã—ãŸèªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚(5) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã‚ˆã‚‹èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å´ã§SSOã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®Ÿæ–½ã—ã¾ã™ã€‚IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URL (\u003cArgoCDã®ãƒ‰ãƒ¡ã‚¤ãƒ³å\u003e/api/dex/callback) ã‚’æŒ‡å®šã—ã¦ã€èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã—ã¾ã™ã€‚èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’ç™ºç”Ÿã•ã›ã€argocd-serverã‚’ä»‹ã—ã¦ã€å†ã³dex-serverã«å±Šãã¾ã™ã€‚ã“ã®å¾Œã€dex-serverã¯IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ã¾ãŸIDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ (ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã€IDãƒˆãƒ¼ã‚¯ãƒ³ãªã©) ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚ãŸã ã€SSOã®ç¨®é¡ã«ã‚ˆã£ã¦ä»•çµ„ã¿ãŒç•°ãªã‚‹ãŸã‚ã€è©³ç´°ã¯çœç•¥ã—ã¾ã™ã€‚â–¶ dex-serverã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã«ã¤ã„ã¦Developer settingsã‚¿ãƒ– ã§SSOã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã®æ™‚ã«Authorization callback URLã¨ã„ã†è¨­å®šç®‡æ‰€ãŒã‚ã‚‹ã¯ãšã§ã™ğŸ‘ğŸ»(6) argocd-serverã«ã‚ˆã‚‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½argocd-serverã¯ã€AuthZã§èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ConfigMap (argocd-rbac-cm) ã‚’å‚ç…§ã—ã€IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã«ã€ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«é–¢ã™ã‚‹èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä»˜ä¸ã—ã¾ã™ã€‚ã–ã£ãã‚Šã—ãŸå®Ÿè£…ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã“ã“ã§ã¯ã€developerãƒ­ãƒ¼ãƒ«ã«ã¯devã¨ã„ã†AppProjectã«å±ã™ã‚‹ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«ã®ã¿ã€ã¾ãŸmaintainerãƒ­ãƒ¼ãƒ«ã«ã¯å…¨ã¦ã®AppProjectã®æ“ä½œã‚’è¨±å¯ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã“ã‚Œã‚‰ã®ãƒ­ãƒ¼ãƒ«ã‚’ã€IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§èªè¨¼ã•ã‚ŒãŸã‚°ãƒ«ãƒ¼ãƒ—ã«ç´ã¥ã‘ã¦ã„ã¾ã™ã€‚ç‰¹å®šã®ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚Œã°ã€çµæœã¨ã—ã¦ç‰¹å®šã®Clusterã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã®ã¿ã‚’è¨±å¯ã—ãŸã“ã¨ã«ãªã‚Šã¾ã™ğŸ‘apiVersion: v1kind: ConfigMapmetadata:  name: argocd-rbac-cm  namespace: foodata:  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ­ãƒ¼ãƒ«  policy.default: role:developer  policy.csv: |    p, role:developer, *, *, dev/*/*, allow    p, role:maintainer, *, *, dev/*/*, allow    p, role:maintainer, *, *, prd/*/*, allow    g, developers, role:developer    g, maintainers, role:maintainer  scopes: \"[groups]\"â–¶ AppProjectã®èªå¯å®šç¾©ã®è¨˜æ³•ã«ã¤ã„ã¦Casbin ã®è¨˜æ³•ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»Šå›ã®å®Ÿè£…ä¾‹ã§ä½¿ç”¨ã—ãŸp (ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³) ã¨g (ã‚°ãƒ«ãƒ¼ãƒ—) ã§ã¯ã€ä»¥ä¸‹ã‚’è¨˜æ³•ã‚’ä½¿ç”¨ã§ãã¾ã™ğŸ‘apiVersion: v1kind: ConfigMapmetadata:  name: argocd-rbac-cm  namespace: argocddata:  policy.default: role:readonly  policy.csv: |    # ãƒ­ãƒ¼ãƒ«ã¨ArgoCDç³»ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹    p, role:\u003cãƒ­ãƒ¼ãƒ«å\u003e, \u003cKubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡\u003e, \u003cã‚¢ã‚¯ã‚·ãƒ§ãƒ³å\u003e, \u003cAppProjectå\u003e/\u003cApplicationã®Namespaceå\u003e/\u003cApplicationå\u003e, \u003cè¨±å¦\u003e    # èªè¨¼æ¸ˆã¿ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ­ãƒ¼ãƒ«ã‚’ç´ä»˜ã‘ã‚‹    g, \u003cã‚°ãƒ«ãƒ¼ãƒ—å\u003e, role:\u003cãƒ­ãƒ¼ãƒ«å\u003e  scopes: \"[groups]\"RBAC Configuration - Argo CD - Declarative GitOps CD for Kubernetes06. argocd-server (argocd-apiserver)argocd-serverã¨ã¯æœ€å¾Œã«ã€ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹argocd-serverã§ã™ã€‚ã€argocd-apiserverã€ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚ã¿ã‚“ãªãŒã‚ˆãçŸ¥ã‚‹ArgoCDã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã™ã€‚ã¾ãŸã€ArgoCDã®APIã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã€ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨é€šä¿¡ã—ã¾ã™ğŸ¦„ä»•çµ„ã¿(1) application-controllerã«ã‚ˆã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯application-controllerã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã‚’ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚(2) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå·®åˆ†æ¤œå‡ºapplication-controllerã¯ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¨ã€ãƒãƒ¼ãƒªãƒ³ã‚°å¯¾è±¡ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®å·®åˆ†ã‚’æ¤œå‡ºã—ã¾ã™ã€‚(3) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœä¿ç®¡application-controllerã¯ã€å‡¦ç†çµæœã‚’redis-serverã«ä¿ç®¡ã—ã¾ã™ã€‚(4) application-controllerã«ã‚ˆã‚‹å‡¦ç†çµæœå–å¾—argocd-serverã¯ã€redis-serverã‹ã‚‰å‡¦ç†çµæœã‚’å–å¾—ã—ã¾ã™ã€‚(5) ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (argocd-server) ã«SSOã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚(6) Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯ã€Ingressã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’å‚ç…§ã—ã€argocd-serverã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚(7) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå§”è­²argocd-serverã¯ã€ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã‚’å§”è­²ã™ã‚‹ãŸã‚ã«ã€dex-serverã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã™ã€‚(8) IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã‚ˆã‚‹èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½IDãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä¸Šã§èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºãŒå®Œäº†ã—ã¾ã™ã€‚argocd-serverã¯ã€ConfigMap (argocd-rbac-cm) ã‚’å‚ç…§ã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã«èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä»˜ä¸ã—ã¾ã™ã€‚(9) argocd-serverã«ã‚ˆã‚‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿæ–½argocd-serverã¯ã€èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã«å¿œã˜ã¦ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ãŒApplicationã‚’æ“ä½œå¯èƒ½ã«ã—ã¾ã™ã€‚â–¶ Namespacedã‚¹ã‚³ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ã«ã¤ã„ã¦apiVersion: v1kind: ConfigMapmetadata:  name: argocd-cmd-params-cm  namespace: foodata:  # è¨­å®šã—ã¦ã¯ãƒ€ãƒ¡  # application.namespaces: \"*\" # å…¨ã¦ã®Namespaceã‚’è¨±å¯ã™ã‚‹ã€‚apiVersion: argoproj.io/v1alpha1kind: AppProjectmetadata:  name: dev-foo-project  namespace: foospec:  # è¨­å®šã—ã¦ã¯ãƒ€ãƒ¡  # sourceNamespaces:  #  - \"foo\"ã“ã‚Œã‚‰ã«ã‚ˆã‚Šã€fooã®Namespaceã«å±ã™ã‚‹ArgoCDã¯ã€ä»–ã®Namespaceã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚Šã¾ã™ğŸ‘Installation - Argo CD - Declarative GitOps CD for Kubernetes(10) application-controllerã«ã‚ˆã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆç”¨Clusterç®¡ç†è€…ã¯ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (argocd-server) ã‚’ä½¿ç”¨ã—ã¦ã€Clusterã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’Syncã—ã¾ã™ã€‚ã“ã®æ™‚ã€Applicationã‚’ä»‹ã—ã¦application-controllerã‚’æ“ä½œã—ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚å›³ã§ã¯ã€App Of Appsãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã—ãŸã¨ä»®å®šã—ã¦ã„ã¾ã™ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦â–¶ App Of Appsãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦07. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã¾ã¨ã‚ä»Šã¾ã§ã®å…¨ã¦ã®æƒ…å ±ã‚’ã–ã£ãã‚Šæ•´ç†ã—ã¦ç°¡ç•¥åŒ–ã™ã‚‹ã¨ã€ArgoCDã¯ä»¥ä¸‹ã®ä»•çµ„ã¿ã§ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ğŸ‘‡08. ãŠã‚ã‚Šã«ArgoCDã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä»•çµ„ã¿ã®ä»•çµ„ã¿ã‚’ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¾ã—ãŸã€‚ArgoCDã¯ã€UIãŒä½¿ã„ã‚„ã™ãã€ä»•çµ„ã¿ã®è©³ç´°ã‚’çŸ¥ã‚‰ãšã¨ã‚‚æ¯”è¼ƒçš„ç°¡å˜ã«é‹ç”¨ã§ãã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ„ãƒ¼ãƒ«ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã‚‚ã—ArgoCDã‚’ä½¿ã‚ãšã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹æ–¹ã¯ã€ArgoCDã®æ¡ç”¨ã‚’ãƒã‚¤ãƒ‘ãƒ¼ãƒ»ã‚¦ãƒ«ãƒˆãƒ©ãƒ»ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆãŠã™ã™ã‚ã—ã¾ã™ğŸ‘è¬è¾ArgoCDã®è¨­è¨ˆã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®æ–¹ã«æœ‰ç›Šãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ã”æ•™æˆã„ãŸã ãã¾ã—ãŸã€‚@yaml_villager ã•ã‚“ã“ã®å ´ã§æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ğŸ™‡ğŸ»â€è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±GitOps Cookbook: Kubernetes Automation in Practice (English Edition)ä½œè€…:Vinto, Natale,Bueno, Alex SotoO'Reilly MediaAmazonGitOps and Kubernetes: Continuous Deployment with Argo CD, Jenkins X, and Fluxä½œè€…:Yuen, Billy,Matyushentsev, Alexander,Ekenstam, Todd,Suen, JesseManning PublicationsAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/05/02/145115","isoDate":"2023-05-02T05:42:57.000Z","dateMiliSeconds":1683006177000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€Istioâ›µï¸ã€‘Istioã‚’å®‰å…¨ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã‚«ãƒŠãƒªã‚¢æ–¹å¼ã¨ãã®ä»•çµ„ã¿","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Istioã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®ç¨®é¡ã«ã¤ã„ã¦å®‰å…¨ãªã‚«ãƒŠãƒªã‚¢æ–¹å¼ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. ãªãœå®‰å…¨ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¿…è¦ãªã®ã‹èµ·ã“ã‚Šã†ã‚‹å•é¡Œæ¡ç”¨ã™ã‚‹ã¹ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•03. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã‚’èª¬æ˜ã™ã‚‹å‰ã«ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã¨ã¯ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã®æ‰‹é †(1) æ–°ç’°å¢ƒã®ãƒªãƒªãƒ¼ã‚¹(2) æ–°ç’°å¢ƒã¸ã®é‡ã¿ä»˜ã‘ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°(3) å®Ÿåœ°çš„ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½(4) é‡ã¿ä»˜ã‘ã®æ®µéšçš„å¤‰æ›´ã€ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã€ã®å‘¼ç§°ã®ç”±æ¥04. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦(1) ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã®æ¤œè¨¼(2) æ–°Istiodã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«(3) Webhookã®å®›å…ˆã®Serviceã®å¤‰æ›´(4) Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰(5) ä¸€éƒ¨ã®Namespaceã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰(6) ãƒ¦ãƒ¼ã‚¶ã®æ‰‹ã‚’å€Ÿã‚ŠãŸãƒ†ã‚¹ãƒˆ(7) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®æ®µéšçš„ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰(8) æ—§Istiodã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«05. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®è©³ç´°istioctl ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰æNamespaceIstiodIstio IngressGatewayãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹(1) ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã®æ¤œè¨¼ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨istioctl x precheckã‚³ãƒãƒ³ãƒ‰kubectl getã‚³ãƒãƒ³ãƒ‰â–¼ Istiodã®Deploymentâ–¼ Webhookã®å®›å…ˆã®Serviceâ–¼ å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹MutatingWebhookConfiguration(2) æ–°Istiodã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨istioctl versionã‚³ãƒãƒ³ãƒ‰istioctl installã‚³ãƒãƒ³ãƒ‰kubectl getã‚³ãƒãƒ³ãƒ‰â–¼ Istiodã®Deploymentâ–¼ Webhookã®å®›å…ˆã®Serviceâ–¼ Webhookã®å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹MutatingWebhookConfiguration(3) Webhookã®å®›å…ˆã®Serviceã®å¤‰æ›´ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨istioctl tag setã‚³ãƒãƒ³ãƒ‰(4) Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨kubectl rollout restartã‚³ãƒãƒ³ãƒ‰(5) ä¸€éƒ¨ã®Namespaceã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨kubectl rollout restartã‚³ãƒãƒ³ãƒ‰(6) ãƒ¦ãƒ¼ã‚¶ã®æ‰‹ã‚’å€Ÿã‚ŠãŸãƒ†ã‚¹ãƒˆã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ã‚‚ã—å•é¡ŒãŒèµ·ã“ã£ãŸå ´åˆ(7) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®æ®µéšçš„ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨kubectl rollout restartã‚³ãƒãƒ³ãƒ‰(8) æ—§Istiodã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨istioctl uninstallã‚³ãƒãƒ³ãƒ‰kubectl getã‚³ãƒãƒ³ãƒ‰â–¼ Istiodã®Deploymentâ–¼ Webhookã®å®›å…ˆã®Serviceâ–¼ å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹MutatingWebhookConfiguration06. ãŠã‚ã‚Šã«è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«éš ã—ã¾ã›ã‚“ã€‚æœ‰å‰å¼˜è¡Œã®ã‚µãƒ³ãƒ‡ãƒ¼ãƒŠã‚¤ãƒˆãƒ‰ãƒªãƒ¼ãƒãƒ¼ ã¯äººç”Ÿã®ãƒã‚¤ãƒ–ãƒ«ã§ã™ã€‚ã•ã¦ã€æœ€è¿‘ã®æ¥­å‹™ã§Istioâ›µï¸ã‚’ã²ãŸã™ã‚‰ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã€æ¡ç”¨ã—ãŸã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®ç´¹ä»‹ã‚‚å…¼ã­ã¦ã€Istioã®å®‰å…¨ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®ä»•çµ„ã¿ã‚’è¨˜äº‹ã§è§£èª¬ã—ã¾ã—ãŸã€‚Istioã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã«ã¯å¤‰é·ãŒã‚ã‚Šã€è§£èª¬ã™ã‚‹ã®ã¯åŸ·ç­†æ™‚ç‚¹ (2023/02/26) ã§æœ€æ–°ã® 1.14 ç³»ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã§ã™ã€‚ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. ãªãœå®‰å…¨ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¿…è¦ãªã®ã‹èµ·ã“ã‚Šã†ã‚‹å•é¡Œãã‚‚ãã‚‚ã€ãªãœIstioã§å®‰å…¨ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’æ¡ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚Istioã§å•é¡ŒãŒèµ·ã“ã‚‹ã¨ã€Podå†…ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒæ­£ã—ãç¨¼åƒã›ãšã€ã‚·ã‚¹ãƒ†ãƒ ã«å¤§ããªå½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®Podã¸ã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒãšã£ã¨å®Œäº†ã›ãšã€ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã¸ã®é€šä¿¡ãŒå…¨ã¦é®æ–­ã•ã‚Œã‚‹ã¨ã„ã£ãŸã“ã¨ãŒèµ·ã“ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ¡ç”¨ã™ã‚‹ã¹ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•åŸ·ç­†æ™‚ç‚¹ (2023/02/26) ã§ã¯ã€Istiodã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ (ä»¥é™ã€Istiodã¨ã—ã¾ã™) ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã«ã¯ã€ã€ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹æ–¹å¼ã€ã¨ã€ã‚«ãƒŠãƒªã‚¢æ–¹å¼ã€ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸåˆã‚ã›ã¦ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¿…è¦ãªIstio IngressGatewayã«ã¯ã€ãã®æ‰‹æ³•ã«ã€ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹æ–¹å¼ã€ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã®å®‰å…¨ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã¨ã—ã¦ã€Istiodã§ã¯ã€ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã€Istio IngressGatewayã§ã¯ã€ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã‚’æ¡ç”¨ã—ã¾ã™ã€‚Istio / Canary UpgradesIstio / Installing Gateways03. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã‚’èª¬æ˜ã™ã‚‹å‰ã«ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã¨ã¯Istiodã®ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒç†è§£ã—ã‚„ã™ããªã‚‹ã‚ˆã†ã«ã€ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰èª¬æ˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã¯ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ†ã‚¹ãƒˆã—ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚ã‚‚ã—ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã‚’ã”å­˜çŸ¥ã®æ–¹ã¯ã€ 04. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦ ã¾ã§é£›ã°ã—ã¦ãã ã•ã„ğŸ™‡ğŸ»â€ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã®æ‰‹é †ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã¯ã€ä¸€éƒ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’çŠ ç‰²ã«ã™ã‚‹ã“ã¨ã«ãªã‚‹ä¸€æ–¹ã§ã€ã‚¢ãƒ—ãƒªã‚’å®Ÿåœ°çš„ã«ãƒ†ã‚¹ãƒˆã§ãã‚‹ç‚¹ã§å„ªã‚Œã¦ã„ã¾ã™ã€‚æ‰‹é †ã‚’äº¤ãˆãªãŒã‚‰èª¬æ˜ã—ã¾ã™ã€‚Canary Release(1) æ–°ç’°å¢ƒã®ãƒªãƒªãƒ¼ã‚¹æ—§ç’°å¢ƒã®ã‚¢ãƒ—ãƒªã‚’æ®‹ã—ãŸã¾ã¾ã€æ–°ç’°å¢ƒã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã™ã€‚ã“ã®æ®µéšã§ã¯ã€å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ (100%) ã‚’æ—§ç’°å¢ƒã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚(2) æ–°ç’°å¢ƒã¸ã®é‡ã¿ä»˜ã‘ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã§é‡ã¿ä»˜ã‘ã‚’å¤‰æ›´ã—ã€ä¸€éƒ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ (ã“ã“ã§ã¯10%) ã‚’æ–°ç’°å¢ƒã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚(3) å®Ÿåœ°çš„ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹ã‚’å€Ÿã‚Šã¦æ–°ç’°å¢ƒã‚’å®Ÿåœ°çš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã™ (ä¾‹ï¼šè©²å½“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒåŸºæº–å€¤ã‚’æº€ãŸã™ã‹) ã€‚(4) é‡ã¿ä»˜ã‘ã®æ®µéšçš„å¤‰æ›´æ–°ç’°å¢ƒã«å•é¡ŒãŒèµ·ã“ã‚‰ãªã‘ã‚Œã°ã€é‡ã¿ä»˜ã‘ã‚’æ®µéšçš„ã«å¤‰æ›´ã—ã€æœ€çµ‚çš„ã«ã¯å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ (100%) ã‚’æ–°ç’°å¢ƒã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚ã€ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã€ã®å‘¼ç§°ã®ç”±æ¥ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã«ã¤ã„ã¦ã¯ã€ãã®å‘¼ç§°ã®ç”±æ¥ã‚’çŸ¥ã‚‹ã¨ã€ã‚ˆã‚Šç†è§£ãŒæ·±ã¾ã‚Šã¾ã™ã€‚ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã¯ã€20ä¸–ç´€é ƒã®ç‚­å‘åŠ´åƒè€…ã®å±æ©Ÿå¯ŸçŸ¥æ–¹æ³•ã«ç”±æ¥ã—ã¾ã™ã€‚ç‚­é‰±å†…ã«ã¯æœ‰æ¯’ãªä¸€é…¸åŒ–ç‚­ç´ ãŒç™ºç”Ÿã™ã‚‹å ´æ‰€ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ç„¡è‰²ç„¡è‡­ãªãŸã‚ã€æ°—ã¥ãã“ã¨ã«é…ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§å½“æ™‚ã®ç‚­é‰±åŠ´åƒè€…ã¯ã€ä¸€é…¸åŒ–ç‚­ç´ ã«æ•æ„Ÿãªã€ã‚«ãƒŠãƒªã‚¢ã€ã‚’ç‚­é‰±å†…ã«æŒã¡è¾¼ã¿ã€ã‚«ãƒŠãƒªã‚¢ã®æ§˜å­ã‹ã‚‰ä¸€é…¸åŒ–ç‚­ç´ ã®å­˜åœ¨ã‚’å¯ŸçŸ¥ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ãŸãã†ã§ã™ã€‚ã¤ã¾ã‚Šã€å…ˆã»ã©ã®ã€çŠ ç‰²ã«ãªã‚‹ä¸€éƒ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãŒã€ã“ã“ã§ã„ã†ã‚«ãƒŠãƒªã‚¢ã¨ã„ã†ã‚ã‘ã§ã™ğŸ˜¨ç”»åƒå¼•ç”¨å…ƒï¼šGeorge McCaa, U.S. Bureau of MinesAbout canary deployment in simple words04. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã‚’ç†è§£ã—ãŸã¨ã“ã‚ã§ã€Istioã®å®‰å…¨ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¾ã™ã€‚ãŠãŠã‚ˆãä»¥ä¸‹ã®æ‰‹é †ã‹ã‚‰ãªã‚Šã¾ã™ã€‚ãªãŠå„ç•ªå·ã¯ã€05. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®è©³ç´° ã® (1) ã€œ (8) ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚(1) ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã®æ¤œè¨¼æ—§IstiodãŒç¨¼åƒã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¯èƒ½ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã—ã¦ãŠãã¾ã™ã€‚(2) æ–°Istiodã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–°Istiod (discoveryã‚³ãƒ³ãƒ†ãƒŠ) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚(3) Webhookã®å®›å…ˆã®Serviceã®å¤‰æ›´æ–°Istiodã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã€Webhookã®å®›å…ˆã®Serviceã‚’å¤‰æ›´ã—ã¾ã™ã€‚ã“ã®æ‰‹é †ã¯é‡è¦ã§ã€å¾Œã®  (3) Webhookã®å®›å…ˆã®Serviceã®å¤‰æ›´ ã§è©³ç´°ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚(4) Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚(5) ä¸€éƒ¨ã®Namespaceã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¸€éƒ¨ã®Namespaceã§ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚â–¶ï¸ ã€ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã®å‘¼ç§°ã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ–‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã®ã§ã¯ãªãã€æ®µéšçš„ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã„ãæ§˜å­ã‚’ã€ã‚«ãƒŠãƒªã‚¢ã€ã¨å‘¼ç§°ã—ã¦ã„ã‚‹ã€ã¨å€‹äººçš„ã«æ¨æ¸¬ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã—ã€ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã®ç”±æ¥ã‚’ã”å­˜ã˜ã®æ–¹ã¯ã€ãœã²æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨ğŸ™‡ğŸ»â€(6) ãƒ¦ãƒ¼ã‚¶ã®æ‰‹ã‚’å€Ÿã‚ŠãŸãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹ã‚’å€Ÿã‚Šã¦ã€å®Ÿåœ°çš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã™ (ä¾‹ï¼šè©²å½“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒåŸºæº–å€¤ä»¥ä¸‹ã‚’æº€ãŸã™ã‹) ã€‚(7) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®æ®µéšçš„ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ–°Istiodã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«å•é¡ŒãŒèµ·ã“ã‚‰ãªã‘ã‚Œã°ã€ä»–ã®Namespaceã§ã‚‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’æ®µéšçš„ã«ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã„ãã¾ã™ã€‚ä¸€æ–¹ã§ã‚‚ã—å•é¡ŒãŒèµ·ã“ã‚Œã°ã€Namespaceã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¨Istio IngressGatewayã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚(8) æ—§Istiodã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æœ€å¾Œã«ã€æ—§Istiodã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Istio / Canary Upgrades05. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®è©³ç´°istioctl ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã‹ã‚‰ã¯ã€04. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦ ã‚’æ·±ã¼ã£ã¦ã„ãã¾ã™ã€‚ä»Šå›ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ä¸€ç•ªå„ªå…ˆã—ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ istioctl ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ãŸæ‰‹é † ã‚’èª¬æ˜ã—ã¾ã™ã€‚ãªãŠå„ç•ªå·ã¯ã€04. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦ ã® (1) ã€œ (8) ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚â–¶ï¸ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦istioctlã‚³ãƒãƒ³ãƒ‰ä»¥å¤–ã®ãƒ„ãƒ¼ãƒ« (ä¾‹ï¼šhelmã‚³ãƒãƒ³ãƒ‰ã€helmfileã‚³ãƒãƒ³ãƒ‰ã€ArgoCD) ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚ç´°ã‹ãªæ‰‹é †ãŒç•°ãªã‚‹ã ã‘ã§ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹æ³•ã®æ¦‚è¦ã¯åŒã˜ã§ã™ğŸ™†ğŸ»â€å‰æNamespaceã¾ãšæœ€åˆã«ã€å‰æã¨ãªã‚‹çŠ¶æ³ã‚’è¨­å®šã—ã¦ãŠãã¾ã™ã€‚å„Namespaceã®istio.io/revãƒ©ãƒ™ãƒ«ã«defaultãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚$ kubectl get namespace -L istio.io/revNAME              STATUS   AGE   REVfoo               Active   34d   defaultbar               Active   34d   defaultbaz               Active   34d   defaultistio-ingress     Active   34d   default...â–¶ï¸ istio.io/revãƒ©ãƒ™ãƒ«å€¤ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã¤ã„ã¦istio.io/revãƒ©ãƒ™ãƒ«å€¤ã¯ã€ã©ã‚“ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã‚‚ã‚ˆã„ã§ã™ã€‚ã‚ˆãã‚ã‚‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦defaultã‚„stableã‚’ä½¿ç”¨ã—ã¾ã™ğŸ‘ã•ã‚‰ã«ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«æ›¸ãèµ·ã“ã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚apiVersion: v1kind: Namespacemetadata:  name: foo  labels:    istio.io/rev: defaultã“ã®istio.io/revãƒ©ãƒ™ãƒ«ãŒã‚ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãã®Namespaceã®Podã«istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’è‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚â–¶ï¸ istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ã€ä»Šå›è¨€åŠã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®è¨˜äº‹ã§è§£èª¬ã—ã¦ã„ã¾ã™ãŸã‚ã€ã‚‚ã—æ°—ã«ãªã‚‹æ–¹ã¯ã‚ˆã‚ã—ãã©ã†ãğŸ™‡ğŸ»â€Istiodã™ã§ã«1-14-6ã®IstiodãŒå‹•ã„ã¦ãŠã‚Šã€1-15-4ã«ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚Istiodã¯Deploymenté…ä¸‹ã®Podã§ã‚ã‚Šã€ã“ã®Podã¯Istiodã®å®Ÿä½“ã§ã‚ã‚‹discoveryã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¡ã¾ã™ã€‚$ kubectl get deployment -n istio-system -l app=istiodNAME                   READY   UP-TO-DATE   AVAILABLE   AGEistiod-1-14-6          1/1     1            1           47s # 1-14-6Istio IngressGatewayIstio IngressGatewayã¯Istiodã¨ã¯ç•°ãªã‚‹Namespaceã§å‹•ã„ã¦ãŠã‚Šã€ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚Istio IngressGatewayã¯istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¡ã¾ã™ã€‚$ kubectl get deployment -n istio-ingressNAME                   READY   UP-TO-DATE   AVAILABLE   AGEistio-ingressgateway   1/1     1            1           47sâ–¶ï¸ Istiodã¨Istio IngressGatewayã‚’å‹•ã‹ã™Namespaceã«ã¤ã„ã¦Istio / Installing Gatewaysãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å„Namespaceã§ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒå‹•ã„ã¦ã„ã¾ã™ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®Podã¯istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¡ã¾ã™ã€‚$ kubectl get deployment -n fooNAME   READY   UP-TO-DATE   AVAILABLE   AGEfoo    2/2     1            1           47s...$ kubectl get deployment -n barNAME   READY   UP-TO-DATE   AVAILABLE   AGEbar    2/2     1            1           47s..$ kubectl get deployment -n bazNAME   READY   UP-TO-DATE   AVAILABLE   AGEbaz    2/2     1            1           47s...(1) ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã®æ¤œè¨¼ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«ã€ç¾åœ¨ã®Kubernetes ClusterãŒã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚Before you upgradeistioctl x precheckã‚³ãƒãƒ³ãƒ‰istioctl x precheckã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è¦ä»¶ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚å•é¡ŒãŒãªã‘ã‚Œã°ã€istioctlã‚³ãƒãƒ³ãƒ‰ã¯No issue ...ã®æ–‡è¨€ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚$ istioctl x precheckâœ… No issues found when checking the cluster.Istiois safe to install or upgrade!  To get started, check out https://istio.io/latest/docs/setup/getting-started/â–¶ï¸ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è¦ä»¶ãŒæº€ãŸãªã„å ´åˆã«ã¤ã„ã¦istioctl x precheckã‚³ãƒãƒ³ãƒ‰ã¯ã‚¨ãƒ©ãƒ¼æ–‡è¨€ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€Istioã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯kube-apiserverã¨é€šä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€kube-apiserverã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã™ãã‚‹ã›ã„ã§IstioãŒéå¯¾å¿œã§ã‚ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ğŸ˜­kubectl getã‚³ãƒãƒ³ãƒ‰â–¼ Istiodã®Deploymentkubectl getã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ç¾åœ¨ã®Istiodã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¾ã™ğŸ‘€ã¾ãšã¯Istiodã®Deploymentã‚’ç¢ºèªã™ã‚‹ã¨ã€1-14-6ã®DeploymentãŒã‚ã‚Šã¾ã™ã€‚$ kubectl get deployment -n istio-system -l app=istiodNAME                   READY   UP-TO-DATE   AVAILABLE   AGEistiod-1-14-6          1/1     1            1           47s # 1-14-6istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã§ã„ã†ã¨ã€ä»¥ä¸‹ã®èµ¤æ ã®è¦ç´ ã§ã™ğŸ‘‡â–¼ Webhookã®å®›å…ˆã®Serviceæ¬¡ã«ã€ Serviceã‚’ç¢ºèªã™ã‚‹ã¨ã€1-14-6ã®ServiceãŒã‚ã‚Šã¾ã™ã€‚$ kubectl get service -n istio-system -l app=istiodNAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                 AGEistiod-1-14-6   ClusterIP   10.96.93.151     \u003cnone\u003e        15010/TCP,15012/TCP,443/TCP,15014/TCP   109s # 1-14-6ã“ã®Serviceã¯ã€kube-apiserverã‹ã‚‰Istiodã¸ã®Webhookã‚’ä»²ä»‹ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã§ã„ã†ã¨ã€ä»¥ä¸‹ã®èµ¤æ ã®è¦ç´ ã§ã™ğŸ‘‡â–¼ å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹MutatingWebhookConfigurationæœ€å¾Œã«ã€MutatingWebhookConfigurationã‚’ç¢ºèªã™ã‚‹ã¨ã€istio-revision-tag-\u003cã‚¨ã‚¤ãƒªã‚¢ã‚¹\u003eã¨istio-sidecar-injector-\u003cãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·\u003eã®MutatingWebhookConfigurationãŒã‚ã‚Šã¾ã™ã€‚$ kubectl get mutatingwebhookconfigurationsNAME                            WEBHOOKS   AGEistio-revision-tag-default      2          114s  # ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”¨istio-sidecar-injector-1-14-6   2          2m16s # ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”¨ã®ãŸã‚ä»Šå›ã¯è¨€åŠã—ãªã„istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã§ã„ã†ã¨ã€ä»¥ä¸‹ã®èµ¤æ ã®è¦ç´ ã§ã™ğŸ‘‡ã“ã‚Œã‚‰ã®ã†ã¡ã€å‰è€… (istio-revision-tag-\u003cã‚¨ã‚¤ãƒªã‚¢ã‚¹\u003e) ã‚’ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®MutatingWebhookConfigurationã¯ã€Webhookã®å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹ãŸã‚ã€çµæœçš„ã«istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ±ºã‚ã¾ã™ã€‚ã“ã“ã§ã€MutatingWebhookConfigurationã®istio.io/revãƒ©ãƒ™ãƒ«ã¨istio.io/tagãƒ©ãƒ™ãƒ«ã®å€¤ã‚‚ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚$ kubectl get mutatingwebhookconfiguration istio-revision-tag-default -o yaml \\    | yq '.metadata.labels'...istio.io/rev: 1-14-6istio.io/tag: default...istio.io/revãƒ©ãƒ™ãƒ«ã¯Istiodã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€istio.io/tagãƒ©ãƒ™ãƒ«ã¯ã“ã‚Œã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€.webhooks[].namespaceSelectorã‚­ãƒ¼é…ä¸‹ã®istio.io/revã‚­ãƒ¼ã®æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¾ã™ã€‚$ kubectl get mutatingwebhookconfiguration istio-revision-tag-default -o yaml \\    | yq '.webhooks[]'...namespaceSelector:  matchExpressions:    - key: istio.io/rev      operator: In      values:        - default...åˆã‚ã›ã¦ã€.webhooks[].clientConfig.serviceã‚­ãƒ¼é…ä¸‹ã®Serviceã‚’åå‰ã‚’ç¢ºèªã—ã¾ã™ã€‚$ kubectl get mutatingwebhookconfiguration istio-revision-tag-default -o yaml \\    | yq '.webhooks[].clientConfig'...service:  name: istiod-1-14-6...â–¶ï¸ MutatingWebhookConfigurationã®å½¹å‰²ã«ã¤ã„ã¦istio.io/revãƒ©ãƒ™ãƒ«ã«defaultã‚’è¨­å®šã—ã¦ã‚ã‚‹ã¨ã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€ä¸Šè¨˜ã®MutatingWebhookConfigurationãŒã“ã‚Œã‚’æ¤œçŸ¥ã—ã¾ã™ã€‚MutatingWebhookConfigurationã«ã¯defaultã«å¯¾å¿œã™ã‚‹Istioã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€kube-apiserverãŒç‰¹å®šã®Istioã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Serviceã«Webhookã‚’é€ä¿¡å¯èƒ½ã«ãªã‚Šã¾ã™ğŸ‰Istio / Safely upgrade the Istio control plane with revisions and tags(2) æ–°Istiodã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ãã‚Œã§ã¯ã€æ–°Istiodã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Control planeistioctl versionã‚³ãƒãƒ³ãƒ‰æ–°ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹Istiodã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€istioctlã‚³ãƒãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æ±ºã¾ã‚Šã¾ã™ã€‚ãã“ã§ã€istioctl versionã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ã“ã‚Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¾ã™ã€‚$ istioctl versionclient version: 1.15.4        # ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å…ˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³control plane version: 1.14.6 # ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³data plane version: 1.14.6istioctl installã‚³ãƒãƒ³ãƒ‰ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å ´åˆã€istioctl installã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯revisionã‚­ãƒ¼ã®å€¤ãŒcanaryã§ã™ãŒã€ä»Šå›ã¯1-15-4ã¨ã—ã¾ã™ã€‚ã“ã®å€¤ã¯ã€IstioãŒä½¿ç”¨ã™ã‚‹æ§˜ã€…ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ã®æ¥å°¾è¾ã‚„ã€å„ãƒªã‚½ãƒ¼ã‚¹ã®istio.io/revãƒ©ãƒ™ãƒ«ã®å€¤ã«ãªã‚Šã¾ã™ã€‚$ istioctl install --set revision=1-15-4WARNING: Istio is being upgraded from 1.14.6 -\u003e 1.15.4WARNING: Before upgrading, you may wish to use 'istioctl analyze' to check for IST0002 and IST0135 deprecation warnings.âœ… Istio core installedâœ… Istiod installedâœ… Ingress gateways installedâœ… Installation completeThank you for installing Istio 1.15.  Please take a few minutes to tell us about your install/upgrade experience!â–¶ï¸ ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§æŒ‡å®šã§ãã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³å·®ã«ã¤ã„ã¦revisionã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ã¯ã€2ã¤ã®å…ˆã®ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¾ã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ç¾åœ¨ã®IstioãŒ1.14.6ã§ã‚ã‚‹ãªã‚‰ã€1.16ç³»ã¾ã§å¯¾å¿œã—ã¦ã„ã¾ã™ğŸ‘Istio / Canary Upgradeskubectl getã‚³ãƒãƒ³ãƒ‰â–¼ Istiodã®Deploymentkubectl getã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€istioctl installã‚³ãƒãƒ³ãƒ‰ã§ä½•ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã‹ã‚’ç¢ºèªã—ã¾ã™ğŸ‘€ã¾ãšã¯Istiodã®Deploymentã‚’ç¢ºèªã™ã‚‹ã¨ã€1-15-4ã¨ã„ã†DeploymentãŒæ–°ã—ãå¢—ãˆã¦ã„ã¾ã™ã€‚$ kubectl get deployment -n istio-system -l app=istiodNAME            READY   UP-TO-DATE   AVAILABLE   AGEistiod-1-14-6   1/1     1            1           47s # 1-14-6istiod-1-15-4   1/1     1            1           47s # 1-15-4æ¥å°¾è¾ã®1-15-4ã¯ã€revisionã‚­ãƒ¼ã®å€¤ã§æ±ºã¾ã‚Šã¾ã™ã€‚ã“ã®æ®µéšã§ã¯ã€æ—§Istiodã¨æ–°IstioãŒä¸¦è¡Œçš„ã«ç¨¼åƒã—ã¦ãŠã‚Šã€kube-apiserverã¯ã¾ã æ—§Istiodã¨é€šä¿¡ã—ã¦ã„ã¾ã™ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡â–¼ Webhookã®å®›å…ˆã®Serviceæ¬¡ã« Webhookã®å®›å…ˆã®Serviceã‚’ç¢ºèªã™ã‚‹ã¨ã€istiod-1-15-4ã¨ã„ã†ServiceãŒæ–°ã—ãå¢—ãˆã¦ã„ã¾ã™ã€‚$ kubectl get service -n istio-system -l app=istiodNAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                 AGEistiod-1-14-6   ClusterIP   10.96.93.151     \u003cnone\u003e        15010/TCP,15012/TCP,443/TCP,15014/TCP   109s # 1-14-6istiod-1-15-4   ClusterIP   10.104.186.250   \u003cnone\u003e        15010/TCP,15012/TCP,443/TCP,15014/TCP   87s  # 1-15-4ã“ã®æ®µéšã§ã¯ã€ã¾ã Webhookã®å®›å…ˆã¯istiod-1-14-6ã®Serviceã§ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡â–¼ Webhookã®å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹MutatingWebhookConfigurationæœ€å¾Œã«MutatingWebhookConfigurationã‚’ç¢ºèªã™ã‚‹ã¨ã€istio-sidecar-injector-1-15-4ã¨ã„ã†MutatingWebhookConfigurationãŒæ–°ã—ãå¢—ãˆã¦ã„ã¾ã™ã€‚$ kubectl get mutatingwebhookconfigurationsNAME                            WEBHOOKS   AGEistio-revision-tag-default      2          114s  # ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹istio-sidecar-injector-1-14-6   2          2m16sistio-sidecar-injector-1-15-4   2          2m16sã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ã¯ã€istio-revision-tag-\u003cã‚¨ã‚¤ãƒªã‚¢ã‚¹\u003eã®MutatingWebhookConfigurationã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡â–¶ï¸ ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã¤ã„ã¦(3) Webhookã®å®›å…ˆã®Serviceã®å¤‰æ›´ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ã“ã®æ‰‹é †ã§ã¯ã€ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®istio.io/tagãƒ©ãƒ™ãƒ«ã®å€¤ã¯ãã®ã¾ã¾ã«ã—ã¦ãŠãã€ä¸€æ–¹ã§istio.io/revãƒ©ãƒ™ãƒ«ã®å€¤ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ã•ã‚‰ã«ã€Webhookã®å®›å…ˆã®Serviceã‚’å¤‰æ›´ã—ã¾ã™ã€‚Default tagSafely upgrade the Istio control plane with revisions and tagsistioctl tag setã‚³ãƒãƒ³ãƒ‰istioctl tag setã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€istio.io/revãƒ©ãƒ™ãƒ«ã®å€¤ã¨å®›å…ˆã®Serviceã‚’å¤‰æ›´ã—ã¾ã™ã€‚$ istioctl tag set default --revision 1-15-4 --overwriteå®Ÿè¡Œå¾Œã«ã€ã‚‚ã†ä¸€åº¦MutatingWebhookConfigurationã‚’ç¢ºèªã™ã‚‹ã¨ã€istio.io/revãƒ©ãƒ™ãƒ«ã®å€¤ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚$ kubectl get mutatingwebhookconfiguration istio-revision-tag-default -o yaml \\    | yq '.metadata.labels'...istio.io/rev: 1-15-4istio.io/tag: default...ã¾ãŸã€Webhookã®å®›å…ˆã®Serviceã‚‚å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚$ kubectl get mutatingwebhookconfiguration istio-revision-tag-default -o yaml \\    | yq '.webhooks[].clientConfig'...service:  name: istiod-1-15-4...ã“ã‚Œã‚‰ã«ã‚ˆã‚Šã€Webhookã®å®›å…ˆãŒ 1-15-4 ã®Service ã¨ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ 1-15-4 ã® istio-proxy ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã§ãã‚‹ ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡(4) Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨Webhookã®å®›å…ˆãŒ1-15-4ã®Serviceã«å¤‰ã‚ã£ãŸã¨ã“ã‚ã§ã€Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚In place upgradekubectl rollout restartã‚³ãƒãƒ³ãƒ‰kubectl rollout restartã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€Istio IngressGatewayã‚’ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚$ kubectl rollout restart deployment istio-ingressgateway-n istio-ingresså†ä½œæˆã—ãŸPodã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’1-15-4ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¦ã„ã¾ã™ã€‚$ kubectl get pod bar -n bar -o yaml | yq '.spec.containers[].image'docker.io/istio/proxyv2:1.15.4 # istio-proxyã‚³ãƒ³ãƒ†ãƒŠâ–¶ï¸ istioctl proxy-statusã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦kubectl getã‚³ãƒãƒ³ãƒ‰ã®ä»£ã‚ã‚Šã«ã€istioctl proxy-statusã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å®Œäº†ã‚’ç¢ºèªã—ã¦ã‚‚ã‚ˆã„ã§ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡â–¶ï¸ Istio IngressGatewayã®é€šä¿¡é®æ–­ã«ã¤ã„ã¦(5) ä¸€éƒ¨ã®Namespaceã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ç¶šã‘ã¦ã€ä¸€éƒ¨ã®Namespaceã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚Podã®å†ä½œæˆã«ã‚ˆã‚Šã€æ–°Istiodã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ãŸã‚ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚Data planekubectl rollout restartã‚³ãƒãƒ³ãƒ‰å‰æã«ã‚ã‚‹ã‚ˆã†ã«ã€Namespaceã«ã¯ foo bar baz ãŒã‚ã‚Šã¾ã™ã€‚kubectl rollout restartã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€barã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚$ kubectl rollout restart deployment bar -n barå†ä½œæˆã—ãŸPodã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’1-15-4ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¦ã„ã¾ã™ã€‚$ kubectl get pod bar -n bar -o yaml | yq '.spec.containers[].image'bar-app:1.0 # ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹docker.io/istio/proxyv2:1.15.4 # istio-proxyã‚³ãƒ³ãƒ†ãƒŠâ–¶ï¸ istioctl proxy-statusã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦kubectl getã‚³ãƒãƒ³ãƒ‰ã®ä»£ã‚ã‚Šã«ã€istioctl proxy-statusã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å®Œäº†ã‚’ç¢ºèªã—ã¦ã‚‚ã‚ˆã„ã§ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡(6) ãƒ¦ãƒ¼ã‚¶ã®æ‰‹ã‚’å€Ÿã‚ŠãŸãƒ†ã‚¹ãƒˆã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨Istioã‚’éƒ¨åˆ†çš„ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã¨ã“ã‚ã§ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå®Œäº†ã—ãŸNamespaceã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹ã‚’å€Ÿã‚Šã¦å®Ÿåœ°çš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã™ (ä¾‹ï¼šè©²å½“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒåŸºæº–å€¤ã‚’æº€ãŸã™ã‹) ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡ã‚‚ã—å•é¡ŒãŒèµ·ã“ã£ãŸå ´åˆã‚‚ã—å•é¡ŒãŒèµ·ã“ã£ãŸå ´åˆã€1-14-6ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã„ãã¾ã™ã€‚istioctl tag setã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€istio.io/revãƒ©ãƒ™ãƒ«ã®å€¤ã‚’å…ƒã«æˆ»ã—ã¾ã™ã€‚$ istioctl tag set default --revision 1-14-6 --overwriteãã®å¾Œã€kubectl rollout restartã‚³ãƒãƒ³ãƒ‰ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã¾ã™ã€‚(7) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®æ®µéšçš„ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨å…ˆã»ã©ã®Namespaceã§å•é¡ŒãŒèµ·ã“ã‚‰ãªã‘ã‚Œã°ã€æ®‹ã£ãŸNamespace (fooã€bazã€...) ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚‚æ®µéšçš„ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã„ãã¾ã™ã€‚kubectl rollout restartã‚³ãƒãƒ³ãƒ‰åŒæ§˜ã«kubectl rollout restartã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã™ã€‚$ kubectl rollout restart deployment foo -n foo$ kubectl rollout restart deployment baz -n baz...æœ€çµ‚çš„ã«ã€å…¨ã¦ã®Namespacemã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒæ–°ã—ããªã‚Šã¾ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡(8) æ—§Istiodã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã“ã“ã§å®Ÿæ–½ã™ã‚‹ã“ã¨æœ€å¾Œã«ã€æ—§Istiodã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Uninstall old control planeistioctl uninstallã‚³ãƒãƒ³ãƒ‰istioctl uninstallã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€æ—§Istiodã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚$ istioctl uninstall --revision 1-14-6âœ… Uninstall completeä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡kubectl getã‚³ãƒãƒ³ãƒ‰â–¼ Istiodã®Deploymentkubectl getã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€istioctl uninstallã‚³ãƒãƒ³ãƒ‰ã§ä½•ã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã‹ã‚’ç¢ºèªã—ã¾ã™ğŸ‘€ã¾ãšã¯Istiodã®Deploymentã‚’ç¢ºèªã™ã‚‹ã¨ã€1-14-6ã¨ã„ã†DeploymentãŒç„¡ããªã£ã¦ã„ã¾ã™ã€‚$ kubectl get deployment -n istio-system -l app=istiodNAME            READY   UP-TO-DATE   AVAILABLE   AGEistiod-1-15-4   1/1     1            1           47s # 1-15-4â–¼ Webhookã®å®›å…ˆã®Serviceæ¬¡ã« Webhookã®å®›å…ˆã®Serviceã‚’ç¢ºèªã™ã‚‹ã¨ã€istiod-1-14-6ã¨ã„ã†ServiceãŒç„¡ããªã£ã¦ã„ã¾ã™ã€‚$ kubectl get service -n istio-system -l app=istiodNAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                 AGEistiod-1-15-4   ClusterIP   10.104.186.250   \u003cnone\u003e        15010/TCP,15012/TCP,443/TCP,15014/TCP   87s  # 1-15-4â–¼ å®›å…ˆã®Serviceã‚’æ±ºã‚ã‚‹MutatingWebhookConfigurationæœ€å¾Œã«MutatingWebhookConfigurationã‚’ç¢ºèªã™ã‚‹ã¨ã€istio-sidecar-injector-1-14-6ã¨ã„ã†MutatingWebhookConfigurationãŒç„¡ããªã£ã¦ã„ã¾ã™ã€‚$ kubectl get mutatingwebhookconfigurationsNAME                            WEBHOOKS   AGEistio-revision-tag-default      2          114s  # æ¬¡ã®ã‚«ãƒŠãƒªã‚¢ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ã‚‚ä½¿ç”¨ã™ã‚‹istio-sidecar-injector-1-15-4   2          2m16sã“ã‚Œã§ã€æ–°Istiodã«å®Œå…¨ã«å…¥ã‚Œæ›¿ã‚ã£ãŸãŸã‚ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯å®Œäº†ã§ã™ã€‚ä»Šã®çŠ¶æ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡â–¶ï¸ ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã¤ã„ã¦06. ãŠã‚ã‚Šã«Istioã‚’å®‰å…¨ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã‚«ãƒŠãƒªã‚¢æ–¹å¼ã¨ãã®ä»•çµ„ã¿ã‚’ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¾ã—ãŸã€‚Istioã¸ã®æ„›ãŒæº¢ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã“ã‚Œã‹ã‚‰Istioã‚’æ¡ç”¨äºˆå®šã®æ–¹ã¯ã€Istioã‚’å®‰å…¨ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã«ååˆ†ã«æº–å‚™ã—ã¦ãŠãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ğŸ‘è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±Istio in Action (English Edition)ä½œè€…:Posta, Christian E.,Maloku, RinorManningAmazonIstio: Up and Running: Using a Service Mesh to Connect, Secure, Control, and Observeä½œè€…:Calcote, Lee,Butcher, ZackO'Reilly MediaAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/02/26/202548","isoDate":"2023-02-26T11:25:48.000Z","dateMiliSeconds":1677410748000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€Istioâ›µï¸ã€‘ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ç™»å ´çµŒç·¯ã¨Istioã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸ä»£è¡¨çš„ãªã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ç¨®é¡ã«ã¤ã„ã¦Istioã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ãŸçµŒç·¯ãªãœã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ãŸã®ã‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥03. admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã«ã¤ã„ã¦admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã¨ã¯admissionãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç¨®é¡MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã¯AdmissionReviewã€AdmissionRequestã€AdmissionResponseâ–¼ AdmissionReviewâ–¼ AdmissionRequestâ–¼ AdmissionResponse04. ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿å…¨ä½“ã®ãƒ•ãƒ­ãƒ¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â¡ï¸ kube-apiserverã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€(1) Podã®ä½œæˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆkube-apiserver â¡ï¸ Serviceã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€(2) èªè¨¼/èªå¯å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«(3) ã‚¢ãƒ‰ã‚ªãƒ³ã®å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«(4) AdmissionRequestã«å€¤ã‚’è©°ã‚ã‚‹(5) AdmissionReviewã‚’é€ä¿¡Service â¡ï¸ webhookã‚µãƒ¼ãƒãƒ¼ã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€(6) 15017ç•ªãƒãƒ¼ãƒˆã«ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°kube-apiserver â¬…ï¸ Service â¬…ï¸ webhookã‚µãƒ¼ãƒãƒ¼ (â€»é€†å‘ãã®çŸ¢å°)ã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€(7) patchå‡¦ç†ã‚’å®šç¾©(8) AdmissionResponseã«å€¤ã‚’è©°ã‚ã‚‹(9) AdmissionReviewã‚’è¿”ä¿¡kube-apiserver â¡ï¸ etcdã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€(10) patchå‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«(11) ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ°¸ç¶šåŒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â¬…ï¸ kube-apiserverã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€(12) ã‚³ãƒ¼ãƒ«å®Œäº†ã‚’è¿”ä¿¡ä»¥é™ã®ä»•çµ„ã¿05. ãŠã‚ã‚Šã«è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«æ¨ã— (Istio) ãŒå°Šã„ğŸ™ğŸ™ğŸ™ã•ã¦ã€å‰å›ã®è¨˜äº‹ã®æ™‚ã¨åŒæ§˜ã«ã€æœ€è¿‘ã®æ¥­å‹™ã§ã‚‚ã‚ªãƒ³ãƒ—ãƒ¬ã¨AWSä¸Šã®Istioâ›µï¸ã‚’ã²ãŸã™ã‚‰å­å®ˆã‚Šã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã€å­å®ˆã‚Šã®å‰æçŸ¥è­˜ã®å¾©ç¿’ã‚‚ã‹ã­ã¦ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã‚’å®Ÿè£…ã™ã‚‹Istioã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨˜äº‹ã§è§£èª¬ã—ã¾ã—ãŸã€‚è§£èª¬ã™ã‚‹ã®ã¯ã€åŸ·ç­†æ™‚ç‚¹ (2023/01/14) æ™‚ç‚¹ã§æœ€æ–°ã® 1.14 ç³»ã®Istioã§ã™ã€‚åŸ·ç­†æ™‚ç‚¹ (2023/01/14) ã§ã¯ã€IstioãŒå®Ÿè£…ã™ã‚‹ã‚µãƒ¼ãƒ“ãƒ¡ãƒƒã‚·ãƒ¥ã«ã¯ã€ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥ã€ã¨ã€ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆãƒ¡ãƒƒã‚·ãƒ¥ã€ãŒã‚ã‚Šã¾ã™ã€‚ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥ã®ä»•çµ„ã¿ã®è»¸ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚‹istio-proxyã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚Istioã¯ã€Kubernetesã®Podã®ä½œæˆæ™‚ã«ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’Podå†…ã«è‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ (æ³¨å…¥) ã—ã¾ã™ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ãŸçµŒç·¯ãªãœã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ãŸã®ã‹ãã‚‚ãã‚‚ã€ãªãœã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ãŸã®ã§ã—ã‚‡ã†ã‹ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚·ã‚¹ãƒ†ãƒ ã«ã¯ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›ºæœ‰ã®ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®å•é¡Œ (ä¾‹ï¼šã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®å¿…è¦æ€§ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã®æš—å·åŒ–ã€ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ä½œæˆãªã©) ãŒã‚ã‚Šã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å†…ã«ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®å•é¡Œã«é–¢ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚Œã°ã€ã“ã‚Œã‚‰ã®å•é¡Œã®è§£æ±ºã§ãã¾ã™ã€‚ã—ã‹ã—ã€ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ã‚¢ãƒ—ãƒªé ˜åŸŸã®å•é¡Œã«è²¬å‹™ã‚’æŒã¡ã€ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®å•é¡Œã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§è§£æ±ºã™ã‚‹ã‚ˆã†ã«ã—ãŸæ–¹ãŒã€äº’ã„ã«åŠ¹ç‡çš„ã«é–‹ç™ºã§ãã¾ã™ã€‚ãã“ã§ã€ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã¨ã—ã¦åˆ‡ã‚Šåˆ†ã‘ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®è²¬å‹™ã‚’åˆ†é›¢å¯èƒ½ã«ãªã‚Šã€å‡é›†åº¦ãŒé«˜ããªã‚Šã¾ã™ã€‚ã¾ãŸã€ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã¨ã—ã¦å„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«æä¾›ã§ãã‚‹ãŸã‚ã€å˜ç´”æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚ã“ã†ã„ã£ãŸæµã‚Œã®ä¸­ã§ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ã¾ã—ãŸã€‚servicemesh.es | Service Mesh ComparisonWhat is Service Mesh and why is it needed in Kubernetes?ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ãƒ¢ãƒ‡ãƒ«å‰è¿°ã®é€šã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ç™»å ´å‰ã¯ã€ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å†…ã«ã‚¤ãƒ³ãƒ•ãƒ©é ˜åŸŸã®å•é¡Œã«é–¢ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã‚’ã€ã€å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ãƒ‡ãƒ«ã€ã¨å‘¼ã³ã¾ã™ã€‚ãã®å¾Œã€ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ¢ãƒ‡ãƒ«ã€ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ã¾ã—ãŸã€‚åŸ·ç­†æ™‚ç‚¹ (2023/01/14) ã§ã¯ã€ã€ã‚«ãƒ¼ãƒãƒ«ãƒ¢ãƒ‡ãƒ«ã€ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ•ãƒªãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ãŒç™»å ´ã—ã¦ã„ã¾ã™ã€‚ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥Istioã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ (ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥) ã¯ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ (istio-proxyã‚³ãƒ³ãƒ†ãƒŠ) ãŒç¨¼åƒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ¼ãƒ³ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚’ä¸­å¤®é›†æ¨©çš„ã«ç®¡ç†ã™ã‚‹Istiod (discoveryã‚³ãƒ³ãƒ†ãƒŠ) ãŒç¨¼åƒã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã‹ã‚‰ãªã‚Šã¾ã™ã€‚Istio / Architecture03. admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã«ã¤ã„ã¦admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã¨ã¯Istioã®Podå†…ã¸ã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å‰æçŸ¥è­˜ã¨ã—ã¦ã€admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã—ã€admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã‚’ã”å­˜çŸ¥ã®æ–¹ã¯ã€ 04. ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ ã¾ã§é£›ã°ã—ã¦ãã ã•ã„ğŸ™‡ğŸ»â€kube-apiserverã§ã¯ã€admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã‚’æœ‰åŠ¹åŒ–ã§ãã¾ã™ã€‚æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ã€èªè¨¼ã‚¹ãƒ†ãƒƒãƒ—ã¨èªå¯ã‚¹ãƒ†ãƒƒãƒ—ã®å¾Œã«mutating-admissionã‚¹ãƒ†ãƒƒãƒ—ã¨validating-admissionã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã§ãã€admissionãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç¨®é¡ã«å¿œã˜ãŸå‡¦ç†ã‚’æŒ¿å…¥ã§ãã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (kubectlã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€Kubernetesãƒªã‚½ãƒ¼ã‚¹) ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ä¾‹ï¼šKubernetesãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ä½œæˆ/æ›´æ–°/å‰Šé™¤ã€kube-apiserverã‹ã‚‰ã®ãƒ—ãƒ­ã‚­ã‚·ã¸ã®è»¢é€) æ™‚ã«ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§admissionãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã‚ˆã‚‹å‡¦ç† (ä¾‹ï¼šã‚¢ãƒ‰ã‚ªãƒ³ãƒ“ãƒ«ãƒˆã‚¤ãƒ³å‡¦ç†ã€ç‹¬è‡ªå‡¦ç†) ã‚’ç™ºç«ã•ã›ã‚‰ã‚Œã¾ã™ã€‚Admission Controllers Reference | KubernetesKubernetes Best Practices: Blueprints for Building Successful Applications on Kubernetesadmissionãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç¨®é¡admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã®admissionãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã¯ã€ãŸãã•ã‚“ã®ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚IstioãŒPodå†…ã«ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã™ã‚‹æ™‚ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã¯ã€ã€MutatingAdmissionWebhookã€ã§ã™ã€‚CertificateApprovalCertificateSigningCertificateSubjectRestrictionDefaultIngressClassDefaultStorageClassDefaultTolerationSecondsLimitRanger\"MutatingAdmissionWebhook\" ğŸ‘ˆ ã“ã‚ŒNamespaceLifecyclePersistentVolumeClaimResizePodSecurityPriorityResourceQuotaRuntimeClassServiceAccountStorageObjectInUseProtectionTaintNodesByConditionValidatingAdmissionWebhookAdmission Controllers Reference | KubernetesMutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã¯MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€mutating-admissionã‚¹ãƒ†ãƒƒãƒ—æ™‚ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’å¤‰æ›´ã™ã‚‹å‡¦ç†ã‚’ãƒ•ãƒƒã‚¯ã§ãã¾ã™ã€‚ãƒ•ãƒƒã‚¯ã™ã‚‹å…·ä½“çš„ãªå‡¦ç†ã¨ã—ã¦ã€webhookã‚µãƒ¼ãƒãƒ¼ã«AdmissionRequestãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦é€ä¿¡ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®AdmissionResponseã«å¿œã˜ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’å‹•çš„ã«å¤‰æ›´ã—ã¾ã™ã€‚MutatingWebhookConfigurationã§ã€MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™ºç«æ¡ä»¶ã‚„webhookã‚µãƒ¼ãƒãƒ¼ã®å®›å…ˆæƒ…å ±ã‚’è¨­å®šã—ã¾ã™ã€‚MutatingWebhookConfigurationã®å…·ä½“çš„ãªå®Ÿè£…ã«ã¤ã„ã¦ã¯ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã®ä¸­ã§èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚Diving into Kubernetes MutatingAdmissionWebhook | by Morven Cao | IBM Cloud | MediumKubernetes Admission Webhookè¦šæ›¸ã - gashirar's blogAdmission Webhookã‚’ä½œã£ã¦éŠã‚“ã§ã€ãã®ä»•çµ„ã¿ã‚’ç†è§£ã—ã‚ˆã†ï¼ˆèª¬æ˜ç·¨ï¼‰AdmissionReviewã€AdmissionRequestã€AdmissionResponseâ–¼ AdmissionReviewAdmissionReviewã¯ä»¥ä¸‹ã®ã‚ˆã†ãªJSONã§ã‚ã‚Šã€kube-apiserverã¨webhookã‚µãƒ¼ãƒãƒ¼ã®é–“ã§AdmissionRequestã¨AdmissionResponseã‚’é‹ã³ã¾ã™ã€‚{  \"apiVersion\": \"admission.k8s.io/v1\",  \"kind\": \"AdmissionReview\",  # AdmissionRequest  \"request\": {},  # AdmissionResponse  \"response\": {},}v1 package - k8s.io/api/admission/v1 - Go Packagesâ–¼ AdmissionRequestAdmissionRequestã¯ä»¥ä¸‹ã®ã‚ˆã†ãªJSONã§ã™ã€‚kube-apiserverãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å—ä¿¡ã—ãŸæ“ä½œå†…å®¹ãŒæŒã¤ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ä¾‹ã§æŒ™ã’ãŸAdmissionRequestã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒDeploymentã‚’CREATEæ“ä½œã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’kube-apiserverã«é€ä¿¡ã—ãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚{  \"apiVersion\": \"admission.k8s.io/v1\",  \"kind\": \"AdmissionReview\",  # AdmissionRequest  \"request\": {    ...    # å¤‰æ›´ã•ã‚Œã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚’è¡¨ã™ã€‚    \"resource\": {      \"group\": \"apps\",      \"version\": \"v1\",      \"resource\": \"deployments\"    },    # kube-apiserverã®æ“ä½œã®ç¨®é¡ã‚’è¡¨ã™ã€‚    \"operation\": \"CREATE\",    ...  }}Dynamic Admission Control | Kubernetesâ–¼ AdmissionResponseä¸€æ–¹ã§AdmissionResponseã¯ã€ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªJSONã§ã™ã€‚AdmissionResponseã¯ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå¤‰æ›´å‡¦ç†ã‚’patchã‚­ãƒ¼ã®å€¤ã«æŒã¡ã€ã“ã‚Œã¯base64æ–¹å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚{  \"apiVersion\": \"admission.k8s.io/v1\",  \"kind\": \"AdmissionReview\",  # AdmissionResponse  \"response\": {      \"uid\": \"\u003cvalue from request.uid\u003e\",      # å®›å…ˆã®webhookã‚µãƒ¼ãƒãƒ¼ãŒå—ä¿¡ã—ãŸã‹å¦ã‹ã‚’è¡¨ã™ã€‚      \"allowed\": true,      # Pathã«ã‚ˆã‚‹Patchå‡¦ç†ã‚’è¡Œã†ã€‚      \"patchType\": \"JSONPatch\",      # Patchå‡¦ç†ã®å¯¾è±¡ã¨ãªã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ã¨å‡¦ç†å†…å®¹ã‚’è¡¨ã™ã€‚base64æ–¹å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã€‚      \"patch\": \"W3sib3AiOiAiYWRkIiwgInBhdGgiOiAiL3NwZWMvcmVwbGljYXMiLCAidmFsdWUiOiAzfV0=\",    },}ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å€¤ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹ã¨ã€ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªpatchå‡¦ç†ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚# patchã‚­ãƒ¼ã‚’base64æ–¹å¼ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸå ´åˆ[{\"op\": \"add\", \"path\": \"/spec/replicas\", \"value\": 3}]ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«å¯¾ã™ã‚‹æ“ä½œ (op) ã€ã‚­ãƒ¼ (path) ã€å€¤ (value) ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚kube-apiserverãŒã“ã‚Œã‚’å—ä¿¡ã™ã‚‹ã¨ã€æŒ‡å®šã•ã‚ŒãŸã‚­ãƒ¼ (.spec.replicas) ã«å€¤ (3) ã«è¿½åŠ ã—ã¾ã™ã€‚Dynamic Admission Control | Kubernetes04. ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿å…¨ä½“ã®ãƒ•ãƒ­ãƒ¼å‰æçŸ¥è­˜ã‚’è¸ã¾ãˆãŸä¸Šã§ã€admission-controllersã‚¢ãƒ‰ã‚ªãƒ³ã®ä»•çµ„ã¿ã®ä¸­ã§ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒã©ã®ã‚ˆã†ã«Podã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ã®ã‹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚æœ€åˆã«ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ãƒ­ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã£ã¦ã„ã¾ã™ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)Istio in Action (English Edition)ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â¡ï¸ kube-apiserverã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â¡ï¸ kube-apiserverã€ã®ç®‡æ‰€ã‚’èª¬æ˜ã—ã¾ã™ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)(1) Podã®ä½œæˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ãšã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒkube-apiserverã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ã“ã‚ã§ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (Deploymentã€DaemonSetã€StatefulSetã€ã‚’å«ã‚€) ã¯ã€Podã®ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’kube-apiserverã«é€ä¿¡ã—ã¾ã™ã€‚ã“ã®æ™‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã¨ã—ã¾ã™ã€‚# Podã‚’ä½œæˆã™ã‚‹ã€‚$ kubectl apply -f foo-pod.yaml# foo-pod.yamlãƒ•ã‚¡ã‚¤ãƒ«apiVersion: v1kind: Podmetadata:  name: foo-pod  namespace: foo-namespacespec:  containers:    - name: foo      image: foo:1.0.0      ports:        - containerPort: 80ã¾ãŸNamespaceã§ã¯ã€ã‚ã‚‰ã‹ã˜ã‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚Istioã§ã¯v1.10ä»¥é™ã€ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã®ç•ªå·ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚apiVersion: v1kind: Namespacemetadata:  name: foo-namespace  labels:    # istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã€‚    # ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯è‡ªç”±    istio.io/rev: \u003cã‚¨ã‚¤ãƒªã‚¢ã‚¹\u003eIstio / Announcing Support for 1.8 to 1.10 Direct Upgradesâ–¶ istio.io/revãƒ©ãƒ™ãƒ«å€¤ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã¤ã„ã¦istio.io/revãƒ©ãƒ™ãƒ«å€¤ã¯ã€ã©ã‚“ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã‚‚ã‚ˆã„ã§ã™ã€‚ã‚ˆãã‚ã‚‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦defaultã‚„stableã‚’ä½¿ç”¨ã—ã¾ã™ğŸ‘kube-apiserver â¡ï¸ Serviceã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€ã€kube-apiserver â¡ï¸ Serviceã€ã®ç®‡æ‰€ã‚’èª¬æ˜ã—ã¾ã™ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)(2) èªè¨¼/èªå¯å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«kube-apiserverã¯ã€èªè¨¼ã‚¹ãƒ†ãƒƒãƒ—ã¨èªå¯ã‚¹ãƒ†ãƒƒãƒ—ã«ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ã¾ã™ã€‚(3) ã‚¢ãƒ‰ã‚ªãƒ³ã®å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«kube-apiserverã¯ã€mutating-admissionã‚¹ãƒ†ãƒƒãƒ—ã«ã¦ã€MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«ã—ã¾ã™ã€‚å‰æçŸ¥è­˜ã®éƒ¨åˆ†ã§å…·ä½“çš„ãªå®Ÿè£…ã‚’çœç•¥ã—ã¾ã—ãŸãŒã€Istioã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.14.3æ™‚ç‚¹ã§ã€MutatingWebhookConfigurationã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚Namespaceã§ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹æ™‚ã«ä½¿ç”¨ã—ãŸã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯ã€ã“ã®MutatingWebhookConfigurationã§å®Ÿä½“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã¨ç´ã¥ã„ã¦ã„ã¾ã™ã€‚$ kubectl get mutatingwebhookconfiguration istio-revision-tag-default -o yamlapiVersion: admissionregistration.k8s.io/v1beta1kind: MutatingWebhookConfigurationmetadata:  name: istio-revision-tag-default  labels:    app: sidecar-injector    # ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®å®Ÿä½“    istio.io/rev: \u003cãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·\u003e    # ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹    istio.io/tag: \u003cã‚¨ã‚¤ãƒªã‚¢ã‚¹\u003ewebhooks:  - name: rev.namespace.sidecar-injector.istio.io    # MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‡¦ç†ã®ç™ºç«æ¡ä»¶ã‚’ç™»éŒ²ã™ã‚‹ã€‚    rules:      - apiGroups: [\"\"]        apiVersions: [\"v1\"]        operations: [\"CREATE\"]        resources: [\"pods\"]        scope: \"*\"    # Webhookã®å‰æ®µã«ã‚ã‚‹Serviceã®æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹ã€‚    clientConfig:      service:        name: istiod-\u003cãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·\u003e        namespace: istio-system        path: \"/inject\" # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ        port: 443      caBundle: Ci0tLS0tQk ...    # Namespaceå˜ä½ã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³    # ç‰¹å®šã®Namespaceã§MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‡¦ç†ã‚’ç™ºç«ã•ã›ã‚‹ã€‚    namespaceSelector:      matchExpressions:        - key: istio.io/rev          operator: DoesNotExist        - key: istio-injection          operator: DoesNotExist    # Podå˜ä½ã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³    # ç‰¹å®šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‡¦ç†ã‚’ç™ºç«ã•ã›ã‚‹ã€‚    objectSelector:      matchExpressions:        - key: sidecar.istio.io/inject          operator: NotIn          values:            - \"false\"        - key: istio.io/rev          operator: In          values:            - \u003cã‚¨ã‚¤ãƒªã‚¢ã‚¹\u003e    ...MutatingWebhookConfigurationã«ã¯ã€MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™ºç«æ¡ä»¶ã‚„webhookã‚µãƒ¼ãƒãƒ¼ã®å®›å…ˆæƒ…å ±ã‚’å®šç¾©ã—ã¾ã™ã€‚MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™ºç«æ¡ä»¶ã«é–¢ã—ã¦ã€ä¾‹ãˆã°Istioã§ã¯ã€ Namespaceã‚„Pod.metadata.labelsã‚­ãƒ¼ã«å¿œã˜ã¦ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹åŒ–/ç„¡åŠ¹åŒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã‚’MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚webhookã‚µãƒ¼ãƒãƒ¼ã®å®›å…ˆæƒ…å ±ã«é–¢ã—ã¦ã€Istioã§ã¯webhookã‚µãƒ¼ãƒãƒ¼ã®å‰æ®µã«Serviceã‚’é…ç½®ã—ã¦ã„ã¾ã™ã€‚MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒç™ºç«ã—ãŸå ´åˆã€Serviceã®/inject:443ã«HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€å®›å…ˆã®Serviceã®åå‰ãŒistiod-\u003cãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·\u003eã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã‚‚ã‚ã‹ã‚‹ã‚ˆã†ã«ã€Serviceã¯ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Istiodã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã«å¯¾å¿œã—ã¦ãŠã‚Šã€æƒ³å®šå¤–ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Istiodã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ãªã„ã‚ˆã†ã«åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚ä¸€æ–¹ã§ç™ºç«ã—ãªã‹ã£ãŸå ´åˆã«ã¯ã€ä»¥é™ã®AdmissionReviewã®å‡¦ç†ã«ã¯é€²ã¿ã¾ã›ã‚“ã€‚(4) AdmissionRequestã«å€¤ã‚’è©°ã‚ã‚‹kube-apiserverã¯ã€mutating-admissionã‚¹ãƒ†ãƒƒãƒ—ã«ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ (Podã®ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ) ã‚’AdmissionReveiewæ§‹é€ ä½“ã®AdmissionRequestã«è©°ã‚ã¾ã™ã€‚{  \"apiVersion\": \"admission.k8s.io/v1\",  \"kind\": \"AdmissionReview\",  # AdmissionRequest  \"request\": {    ...    # å¤‰æ›´ã•ã‚Œã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚’è¡¨ã™ã€‚    \"resource\": {      \"group\": \"core\",      \"version\": \"v1\",      \"resource\": \"pods\"    },    # kube-apiserverã®æ“ä½œã®ç¨®é¡ã‚’è¡¨ã™ã€‚    \"operation\": \"CREATE\",    ...  }}(5) AdmissionReviewã‚’é€ä¿¡kube-apiserverã¯ã€mutating-admissionã‚¹ãƒ†ãƒƒãƒ—ã«ã¦ã€Serviceã®/inject:443ã«AdmissionReviewæ§‹é€ ä½“ã‚’é€ä¿¡ã—ã¾ã™ã€‚Service â¡ï¸ webhookã‚µãƒ¼ãƒãƒ¼ã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€ã€Service â¡ï¸ webhookã‚µãƒ¼ãƒãƒ¼ã€ã®ç®‡æ‰€ã‚’èª¬æ˜ã—ã¾ã™ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)(6) 15017ç•ªãƒãƒ¼ãƒˆã«ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°Serviceã¯ã€/inject:443ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã€discoveryã‚³ãƒ³ãƒ†ãƒŠã®15017ç•ªãƒãƒ¼ãƒˆã«ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚Istioã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.14.3æ™‚ç‚¹ã§ã€Serviceã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚$ kubectl get svc istiod-service -n istio-system -o yamlapiVersion: v1kind: Servicemetadata:  labels:    app: istiod  name: istiod-\u003cãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·\u003e  namespace: istio-systemspec:  type: ClusterIP  selector:    app: istiod    istio.io/rev: \u003cãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·\u003e  ports:    - name: grpc-xds      port: 15010      protocol: TCP      targetPort: 15010    - name: https-dns      port: 15012      protocol: TCP      targetPort: 15012    # webhookã‚µãƒ¼ãƒãƒ¼ã«ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã€‚    - name: https-webhook      port: 443      protocol: TCP      targetPort: 15017    - name: http-monitoring      port: 15014      protocol: TCP      targetPort: 15014.spec.selector.istio.io/revã‚­ãƒ¼ã«ã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å…ˆã®Podã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€ã“ã®Podã¯discoveryã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¡ã¾ã™ã€‚Istioã¯ã€discoveryã‚³ãƒ³ãƒ†ãƒŠå†…ã§webhookã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã—ã€15017ç•ªãƒãƒ¼ãƒˆã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¾…ã¡å—ã‘ã¾ã™ã€‚â–¶ istio.io/rev`discovery`ã‚³ãƒ³ãƒ†ãƒŠã®å¾…ã¡å—ã‘ãƒãƒ¼ãƒˆã«ã¤ã„ã¦discoveryã‚³ãƒ³ãƒ†ãƒŠãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¾…ã¡å—ã‘ã¦ã„ã‚‹ãƒãƒ¼ãƒˆç•ªå·ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€15017ç•ªãƒãƒ¼ãƒˆã§ãƒªãƒƒã‚¹ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ğŸ‘$ kubectl exec foo-istiod -n istio-system -- netstat -tulpnActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program nametcp        0      0 127.0.0.1:9876          0.0.0.0:*               LISTEN      1/pilot-discoverytcp6       0      0 :::15017                :::*                    LISTEN      1/pilot-discoverytcp6       0      0 :::8080                 :::*                    LISTEN      1/pilot-discoverytcp6       0      0 :::15010                :::*                    LISTEN      1/pilot-discoverytcp6       0      0 :::15012                :::*                    LISTEN      1/pilot-discoverytcp6       0      0 :::15014                :::*                    LISTEN      1/pilot-discovery\u003e - istio/pkg/kube/inject/webhook.go at 1.14.3 Â· istio/istio Â· GitHub\u003e - https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istiokube-apiserver â¬…ï¸ Service â¬…ï¸ webhookã‚µãƒ¼ãƒãƒ¼ (â€»é€†å‘ãã®çŸ¢å°)ã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€ã€kube-apiserver â¬…ï¸ Service â¬…ï¸ webhookã‚µãƒ¼ãƒãƒ¼ã€ã®ç®‡æ‰€ã‚’èª¬æ˜ã—ã¾ã™ã€‚çŸ¢å°ãŒé€†å‘ããªã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)(7) patchå‡¦ç†ã‚’å®šç¾©ä»•çµ„ã¿ã®ä¸­ã§ã‚‚ã€ã“ã“ã¯é‡è¦ãªéƒ¨åˆ†ã§ã™ã€‚discoveryã‚³ãƒ³ãƒ†ãƒŠå†…ã®webhookã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’æ›¸ãæ›ãˆã‚‹ãŸã‚ã®patchå‡¦ç†ã‚’å®šç¾©ã—ã¾ã™ã€‚webhookã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®.spec.containers[1]ãƒ‘ã‚¹ã«istio-proxyã‚­ãƒ¼ã‚’è¿½åŠ ã•ã›ã‚‹ã‚ˆã†ãªpatchå‡¦ç†ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã®å®šç¾©ã«ã‚ˆã£ã¦ã€çµæœçš„ã«ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒèµ·ã“ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚[  ...  {    \"op\": \"add\",    # .spec.initContainers[1] ã‚’æŒ‡å®šã™ã‚‹ã€‚    \"path\": \"/spec/initContainers/1\",    # ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹æ§‹é€ ã‚’è¡¨ã™ã€‚    \"value\": {      \"name\": \"istio-init\",      \"resources\": {                     ...      }    }  },  {    \"op\": \"add\",    # .spec.containers[1] ã‚’æŒ‡å®šã™ã‚‹ã€‚    \"path\": \"/spec/containers/1\",    # ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹æ§‹é€ ã‚’è¡¨ã™ã€‚    \"value\": {      \"name\": \"istio-proxy\",      \"resources\": {                     ...      }    }  }  ...]istio/pkg/kube/inject/webhook.go at 1.14.3 Â· istio/istio Â· GitHubistio/pkg/kube/inject/webhook_test.go at 1.14.3 Â· istio/istio Â· GitHubã“ã®æ™‚ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå€¤ãŒã€patchå‡¦ç†ã‚’å†…å®¹ã‚’æ±ºã‚ã¾ã™ã€‚type SidecarTemplateData struct {    TypeMeta             metav1.TypeMeta    DeploymentMeta       metav1.ObjectMeta    ObjectMeta           metav1.ObjectMeta    Spec                 corev1.PodSpec    ProxyConfig          *meshconfig.ProxyConfig    MeshConfig           *meshconfig.MeshConfig    Values               map[string]interface{}    Revision             string    EstimatedConcurrency int    ProxyImage           string}...istio/pkg/kube/inject/inject.go at 1.14.3 Â· istio/istio Â· GitHubâ–¶ patchå‡¦ç†ã§ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã«ã¤ã„ã¦istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ä»–ã«ã€InitContainerã®istio-initã‚³ãƒ³ãƒ†ãƒŠã‚‚ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã®istio-initã‚³ãƒ³ãƒ†ãƒŠã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¤Podã§ã™ã€‚ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰/ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã®çµŒè·¯ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«ã€Podå†…ã«iptablesã®ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã™ã‚‹è²¬å‹™ã‚’æ‹…ã£ã¦ã„ã¾ã™ğŸ’ªğŸ»Istio Sidecar's interception mechanism for traffic - SoByte(8) AdmissionResponseã«å€¤ã‚’è©°ã‚ã‚‹discoveryã‚³ãƒ³ãƒ†ãƒŠå†…ã®webhookã‚µãƒ¼ãƒãƒ¼ã¯ã€patchå‡¦ç†ã®å®šç¾©ã‚’AdmissionReveiewæ§‹é€ ä½“ã®AdmissionResponseã«è©°ã‚ã¾ã™ã€‚patchã‚­ãƒ¼ã®å€¤ã«ã€å…ˆã»ã©ã®patchå‡¦ç†ã®å®šç¾©ã‚’base64æ–¹å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚{  \"apiVersion\": \"admission.k8s.io/v1\",  \"kind\": \"AdmissionReview\",  # AdmissionResponse  \"response\": {      \"uid\": \"*****\",      \"allowed\": true,      \"patchType\": \"JSONPatch\",      # Patchå‡¦ç†ã®å¯¾è±¡ã¨ãªã‚‹Kubernetesãƒªã‚½ãƒ¼ã‚¹ã¨å‡¦ç†å†…å®¹ã‚’è¡¨ã™ã€‚base64æ–¹å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã€‚      \"patch\": \"\u003cå…ˆã»ã©ã®patchå‡¦ç†ã®å®šç¾©ã‚’base64æ–¹å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—\u003e\",    },}istio/pkg/kube/inject/webhook.go at 1.14.3 Â· istio/istio Â· GitHub(9) AdmissionReviewã‚’è¿”ä¿¡discoveryã‚³ãƒ³ãƒ†ãƒŠå†…ã®webhookã‚µãƒ¼ãƒãƒ¼ã¯ã€AdmissionReviewæ§‹é€ ä½“ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦kube-apiserverã«è¿”ä¿¡ã—ã¾ã™ã€‚kube-apiserver â¡ï¸ etcdã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€ã€kube-apiserver â¡ï¸ etcdã€ã®ç®‡æ‰€ã‚’èª¬æ˜ã—ã¾ã™ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)(10) patchå‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«kube-apiserverã¯ã€AdmissionReviewæ§‹é€ ä½“ã‚’å—ä¿¡ã—ã€AdmissionResponseã«å¿œã˜ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚patchå‡¦ç†ã®å®šç¾©ã‚’AdmissionReviewæ§‹é€ ä½“ã‹ã‚‰å–ã‚Šå‡ºã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¨istio-initã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®è©²å½“ç®‡æ‰€ã«ã‚­ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚apiVersion: v1kind: Podmetadata:  name: foo-pod  namespace: foo-namespacespec:  containers:    - name: foo      image: foo:1.0.0      ports:        - containerPort: 80    # kube-apiserverãŒè¿½åŠ     - name: istio-proxy      ...  # kube-apiserverãŒè¿½åŠ   initContainers:    - name: istio-init    ...(11) ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ°¸ç¶šåŒ–kube-apiserverã¯ã€etcdã«Podã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ°¸ç¶šåŒ–ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â¬…ï¸ kube-apiserverã“ã“ã§èª¬æ˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼ç®‡æ‰€ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â¬…ï¸ kube-apiserverã€ã®ç®‡æ‰€ã‚’èª¬æ˜ã—ã¾ã™ã€‚(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)(12) ã‚³ãƒ¼ãƒ«å®Œäº†ã‚’è¿”ä¿¡kube-apiserverã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ã¾ã™ã€‚$ kubectl apply -f foo-pod.yaml# kube-apiserverã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹pod \"foo-pod\" createdä»¥é™ã®ä»•çµ„ã¿(ç”»åƒã¯ã‚¿ãƒ–é–‹ãé–²è¦§ã‚’æ¨å¥¨)kube-apiserverã¯ã€ä»–ã®Nodeã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (kube-controlleretcdã€kube-schedulerã€kubeletãªã©) ã¨é€šä¿¡ã—ã€Podã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®Podã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¯ã€ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã®ä»–ã«ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¨istio-initã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¡ã¾ã™ã€‚çµæœã¨ã—ã¦ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸã“ã¨ã«ãªã‚Šã¾ã™ã€‚â–¶ kube-apiserverã¨ä»–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é€šä¿¡ã«ã¤ã„ã¦Kubernetes Master Components: Etcd, API Server, Controller Manager, and Scheduler | by Jorge Acetozi | jorgeacetozi | Medium05. ãŠã‚ã‚Šã«ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã®ç™»å ´ã¨Istioã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã‚’ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¾ã—ãŸã€‚Istioã¸ã®æ„›ãŒæº¢ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ä»Šå›ç™»å ´ã—ãŸMutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«é–¢ã—ã¦ã€ç§ã®é–¢ã‚ã£ã¦ã„ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ã¯Istioä»¥å¤– (ä¾‹ï¼šCertManagerã€Prometheusã€AWSã®aws-eks-vpc-cniã‚¢ãƒ‰ã‚ªãƒ³ãªã©) ã§ã‚‚ä½¿ç”¨ã—ã¦ã„ã¾ã™âœŒï¸ãã®ãŸã‚ã€MutatingAdmissionWebhookãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã©ã®ã‚ˆã†ã«ä½¿ã£ã¦ã„ã‚‹ã®ã‹ã‚’ä¸€åº¦çŸ¥ã‚Œã°ã€çŸ¥è­˜ã®æ±ç”¨æ€§ãŒé«˜ã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯Istioã§ã‚‚åŸºæœ¬çš„ãªæ©Ÿèƒ½ã§ã‚ã‚Šã€ã‚‚ã—æœªä½“é¨“ã®æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã‚Œã°ã€ãŠæ‰‹å…ƒã§ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ãŸã ãã¨ã‚ˆã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ğŸ‘è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±Istio in Action (English Edition)ä½œè€…:Posta, Christian E.,Maloku, RinorManningAmazonIstio: Up and Running: Using a Service Mesh to Connect, Secure, Control, and Observeä½œè€…:Calcote, Lee,Butcher, ZackO'ReillyAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2023/01/14/223815","isoDate":"2023-01-14T13:38:15.000Z","dateMiliSeconds":1673703495000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€Istioâ›µï¸ã€‘Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿","contentSnippet":"ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ç¨®é¡ã«ã¤ã„ã¦Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿ã«ã¤ã„ã¦è¨˜äº‹ã®ã–ã£ãã‚Šã—ãŸå†…å®¹ã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã§ãã¡ã‚ƒã„ã¾ã™ï¼    ã“ã®è¨˜äº‹ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜01. ã¯ã˜ã‚ã«02. ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã«ã¤ã„ã¦ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã¨ã¯ãªãœã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ãŒå¿…è¦ãªã®ã‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®è¦ç´ ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³03. Istioã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿å…¨ä½“åƒ(1) kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡(2) discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡(3) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±å–å¾—(4) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡(5) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°discoveryã‚³ãƒ³ãƒ†ãƒŠã®ä»•çµ„ã¿(1) kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡(2) discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡(3) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±å–å¾—istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ä»•çµ„ã¿(1) kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡(2) discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡(3) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±å–å¾—(4) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡(5) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡04. istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã®ä»•çµ„ã¿å…¨ä½“åƒ(1) é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡(2) Envoyã«ã‚ˆã‚‹ãƒªã‚¹ãƒŠãƒ¼é¸æŠ(3) Envoyã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒˆé¸æŠ(4) Envoyã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠ(5) Envoyã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé¸æŠ(6) å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡EnvoyãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸå®›å…ˆæƒ…å ±ã‚’è¦‹ã¦ã¿ã‚ˆã†config_dumpã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼â–¼ ç¢ºèªæ–¹æ³•â–¼ çµæœãƒ«ãƒ¼ãƒˆâ–¼ ç¢ºèªæ–¹æ³•â–¼ çµæœã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼â–¼ ç¢ºèªæ–¹æ³•â–¼ çµæœã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆâ–¼ ç¢ºèªæ–¹æ³•â–¼ çµæœEnvoyã®å‡¦ç†ã®æµã‚Œã®ã¾ã¨ã‚(1) é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡(2) Envoyã«ã‚ˆã‚‹ãƒªã‚¹ãƒŠãƒ¼é¸æŠ(3) Envoyã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒˆé¸æŠ(4) Envoyã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠ(5) Envoyã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠ(6) å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡05. ãŠã‚ã‚Šã«è¬è¾è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±01. ã¯ã˜ã‚ã«æ¨ã— (Istio) ãŒå°Šã„ğŸ™ğŸ™ğŸ™3-shake Advent Calender 2022 æœ€çµ‚æ—¥ã®è¨˜äº‹ã§ã™ğŸ…æ™®æ®µã€ç§ã¯ ä¿ºã®æŠ€è¡“ãƒãƒ¼ãƒˆ ã«çŸ¥è¦‹ã‚’è¨˜éŒ²ã—ã¦ãŠã‚Šã€ã¯ã¦ãªãƒ–ãƒ­ã‚°ã¯ãƒ‡ãƒ“ãƒ¥ãƒ¼æˆ¦ã¨ãªã‚Šã¾ã™ã€‚æœ€è¿‘ã®æ¥­å‹™ã§ã€ã‚ªãƒ³ãƒ—ãƒ¬ã¨AWSä¸Šã®Istioâ›µï¸ã‚’ã²ãŸã™ã‚‰å­å®ˆã‚Šã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã€å­å®ˆã‚Šã®å‰æçŸ¥è­˜ã®å¾©ç¿’ã‚‚ã‹ã­ã¦ã€Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿ã‚’è¨˜äº‹ã§è§£èª¬ã—ã¾ã—ãŸã€‚Istioã®æ©Ÿèƒ½ã®1ã¤ã§ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã¯ã€ãã®ä»•çµ„ã¿ã®å¤šãã‚’Envoyã«é ¼ã£ã¦ã„ã‚‹ãŸã‚ã€åˆã‚ã›ã¦Envoyã®ä»•çµ„ã¿ã‚‚èª¬æ˜ã—ã¾ã™ã€‚ãã‚Œã§ã¯ã€ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¦ã„ãã¾ã™ğŸ˜—02. ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã«ã¤ã„ã¦ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã¨ã¯å¹³æ˜“ãªè¨€è‘‰ã§è¨€ã„æ›ãˆã‚‹ã¨ ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ ã§ã™ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´é¢ãŒã‚ã‚Šã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã¨ã¯ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®å®›å…ˆæƒ…å ± (ä¾‹ï¼šIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åãªã©) ã‚’æ¤œå‡ºã—ã€é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒå®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¶™ç¶šçš„ã«é€ä¿¡å¯èƒ½ã«ã™ã‚‹ä»•çµ„ã¿ã®ã“ã¨ã§ã™ã€‚ãªãœã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ãŒå¿…è¦ãªã®ã‹ãã‚‚ãã‚‚ã€ãªãœã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ãŒå¿…è¦ãªã®ã§ã—ã‚‡ã†ã‹ã€‚ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®ä¿¡é ¼æ€§ (å®šã‚ã‚‰ã‚ŒãŸæ¡ä»¶ä¸‹ã§å®šã‚ã‚‰ã‚ŒãŸæœŸé–“ã«ã‚ãŸã‚Šã€éšœå®³ã‚’ç™ºç”Ÿã•ã›ã‚‹ã“ã¨ãªãå®Ÿè¡Œã™ã‚‹ç¨‹åº¦) ã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã«ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’æ¡ç”¨ã—ã¾ã™ã€‚ã“ã®æ™‚ã€è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã§ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒå¢—åŠ ã™ã‚‹ãŸã³ã«ã€å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯æ–°ã—ã„å®›å…ˆæƒ…å ±ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã¾ãŸã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒä½œã‚Šç›´ã•ã‚ŒãŸå ´åˆã«ã‚‚ã€å®›å…ˆæƒ…å ±ã¯æ›´æ–°ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã€ãŸã¨ãˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å®›å…ˆæƒ…å ±ãŒæ›´æ–°ã•ã‚ŒãŸã¨ã—ã¦ã‚‚ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ãªã„ä»•çµ„ã¿ãŒå¿…è¦ã§ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®è¦ç´ ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿ã¯ã€æ¬¡ã®è¦ç´ ã‹ã‚‰ãªã‚Šã¾ã™ã€‚åå‰è§£æ±ºã¯ã€DNSãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ (ä¾‹ï¼šCoreDNS + Service + kube-proxyã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼) ã§å¿…è¦ã¨ãªã‚Šã€Istioã§ã¯ä½¿ã„ã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯è¨€åŠã—ãªã„ã“ã¨ã¨ã—ã¾ã™ğŸ™‡ğŸ»â€ è¦ç´                     è²¬å‹™                                                              é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹  ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã€‚                                            å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹    ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ã€‚                                            ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒª      å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®å®›å…ˆæƒ…å ±ã‚’ä¿ç®¡ã™ã‚‹ã€‚                        ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼        å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã™ã‚‹ã€‚      åå‰è§£æ±º                å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡æ™‚ã«ã€åå‰è§£æ±ºå¯èƒ½ã«ã™ã‚‹ã€‚ ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®å®Ÿè£…æ–¹æ³•ã«ã¯ã„ãã¤ã‹ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚Istioã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã¯ã€ã“ã®ã†ã¡ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã€å•ã„åˆã‚ã›ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã®è²¬å‹™ãŒåˆ‡ã‚Šé›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¯ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®å®›å…ˆã‚’ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å•ã„åˆã‚ã›ã€ã¾ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã™ã‚‹è²¬å‹™ã‚’æ‹…ã£ã¦ã„ã¾ã™ğŸ’ªğŸ»(ä¾‹) Istioã€Linkerdã€CoreDNSã€AWS ALBãªã©Cloud Native Patterns: Designing change-tolerant software (English Edition)Pattern: Server-side service discoveryã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³é€šä¿¡ã®é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®å®›å…ˆã‚’ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å•ã„åˆã‚ã›ã€ã•ã‚‰ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã™ã‚‹è²¬å‹™ã‚’æ‹…ã„ã¾ã™ã€‚(ä¾‹) Netflixã®Eurekaãªã©Cloud Native Patterns: Designing change-tolerant software (English Edition)Pattern: Client-side service discoveryService Discovery in Kubernetes: Combining the Best of Two Worlds03. Istioã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿IstioãŒå®Ÿè£…ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ã«ã¯ã€ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥ã¨ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆãƒ¡ãƒƒã‚·ãƒ¥ãŒã‚ã‚Šã€ä»Šå›ã¯ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ—ãƒ­ã‚­ã‚·ãƒ¡ãƒƒã‚·ãƒ¥ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã‚’å–ã‚Šä¸Šã’ã¾ã™ã€‚Istioã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã¯ã€discoveryã‚³ãƒ³ãƒ†ãƒŠã¨istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒè»¸ã¨ãªã‚Šã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ã€‚å…¨ä½“åƒ(1) ã€œ (6) ã®å…¨ä½“åƒã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®å•ã„åˆã‚ã›ã¨ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã™ã‚‹è²¬å‹™ã‚’æ‹…ã£ã¦ã„ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚(1) kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡kube-apiserverã¯ã€Podç­‰ã®å®›å…ˆæƒ…å ±ã‚’etcdç­‰ã«ä¿ç®¡ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€Kubernetesã®é€šå¸¸ã®ä»•çµ„ã¿ã§ã™ã€‚(2) discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡discoveryã‚³ãƒ³ãƒ†ãƒŠã¯ã€kube-apiserverã‹ã‚‰Podç­‰ã®å®›å…ˆæƒ…å ±ã‚’å–å¾—ã—ã€è‡ªèº«ã«ä¿ç®¡ã—ã¾ã™ã€‚(3) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±å–å¾—istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€discoveryã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰Podç­‰ã®å®›å…ˆæƒ…å ±ã‚’åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°RPCã§å–å¾—ã—ã¾ã™ã€‚(4) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®è²¬å‹™é€šã‚Šã€é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¯ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ (ã“ã“ã§ã¯istio-proxyã‚³ãƒ³ãƒ†ãƒŠ) ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã®æ™‚ã€é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒistio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ç›´æ¥çš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã‚‹ã¨ã„ã†ã‚ˆã‚Šã¯ã€iptablesãŒistio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã“ã‚Œã‚’å—ä¿¡ã—ã¾ã™ã€‚(5) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã€ã¾ãŸå®›å…ˆPodã«é€ä¿¡ã—ã¾ã™ã€‚Istio in ActionJimmy SongTech-èµµåŒ–å†°çš„åšå®¢ | Zhaohuabing Blogdiscoveryã‚³ãƒ³ãƒ†ãƒŠã®ä»•çµ„ã¿å…¨ä½“åƒã®ä¸­ã‹ã‚‰ã€discoveryã‚³ãƒ³ãƒ†ãƒŠã‚’è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚discoveryã‚³ãƒ³ãƒ†ãƒŠã¯ã€åˆ¥åIstiodã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚XDS-APIã¨ã„ã†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¬é–‹ã—ã¦ãŠã‚Šã€XDS-APIã®ã†ã¡ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã«é–¢ä¿‚ã™ã‚‹APIã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ä»Šå›ã¯è©³ã—ãè¨€åŠã—ã¾ã›ã‚“ãŒã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ã€è¨¼æ˜æ›¸ã‚’é…å¸ƒã™ã‚‹ãŸã‚ã®SDS-APIã‚‚ã‚ã‚Šã¾ã™ã€‚ APIã®ç¨®é¡  èª¬æ˜                                                   LDS-API    Envoyã®ãƒªã‚¹ãƒŠãƒ¼ã‚’å–å¾—ã§ãã‚‹ã€‚                          RDS-API    Envoyã®ãƒ«ãƒ¼ãƒˆã‚’å–å¾—ã§ãã‚‹ã€‚                            CDS-API    Envoyã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å–å¾—ã§ãã‚‹ã€‚                        EDS-API    Envoyã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãã‚‹ã€‚                          ADS-API    å„XDS-APIã‹ã‚‰å–å¾—ã§ãã‚‹å®›å…ˆæƒ…å ±ã‚’æ•´ç†ã—ã¦å–å¾—ã§ãã‚‹ã€‚ Istio in Action(1) kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡ ã¨åŒã˜ã§ã™ã€‚(2) discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡ ã¨åŒã˜ã§ã™ã€‚(3) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±å–å¾—XDS-APIã¨istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®é–“ã§ã¯ã€gRPCã®åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°RPCã®æ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦å®›å…ˆæƒ…å ±ã‚’è¿”å´ã™ã‚‹ã ã‘ã§ãªãã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãªãã¨ã‚‚ã€XDS-APIã‹ã‚‰ã‚‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦å®›å…ˆæƒ…å ±ã‚’é€ä¿¡ã—ã¾ã™ã€‚XDS-APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒã„ãã¤ã‹ã‚ã‚Šã€å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å®›å…ˆæƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚ä¸€æ–¹ã§ã€å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ãƒãƒ©ãƒãƒ©ã«å®›å…ˆæƒ…å ±ã‚’å–å¾—ã™ã‚‹ã¨ã€Envoyä¸Šã§ã“ã‚Œã‚’æ•´ç†ã™ã‚‹æ™‚ã«ã€å®›å…ˆæƒ…å ±ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸æ•´åˆãŒèµ·ã“ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€Istioã¯å®Ÿéš›ã«ã¯ADS-APIã‚’ä½¿ç”¨ã—ã¦å®›å…ˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠã®ä»•çµ„ã¿å…¨ä½“åƒã®ä¸­ã‹ã‚‰ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠã‚’è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Istio in ActionJimmy SongTech-èµµåŒ–å†°çš„åšå®¢ | Zhaohuabing Blog(1) kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡kube-apiserverã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡ ã¨åŒã˜ã§ã™ã€‚(2) discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡discoveryã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±ä¿ç®¡ ã¨åŒã˜ã§ã™ã€‚(3) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹å®›å…ˆæƒ…å ±å–å¾—istio-proxyã‚³ãƒ³ãƒ†ãƒŠã§ã¯ã€pilot-agentã¨EnvoyãŒç¨¼åƒã—ã¦ã„ã¾ã™ã€‚å…ˆã»ã©istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°RPCã§ADS-APIã‹ã‚‰å®›å…ˆæƒ…å ±ã‚’å–å¾—ã™ã‚‹ã¨èª¬æ˜ã—ã¾ã—ãŸã€‚å³å¯†ã«ã¯EnvoyãŒã€pilot-agentã‚’ä»‹ã—ã¦ã€ADS-APIã‹ã‚‰åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°RPCã§å®›å…ˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚(4) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡ ã¨åŒã˜ã§ã™ã€‚(5) istio-proxyã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡Envoyã¯ADS-APIã‹ã‚‰å–å¾—ã—ãŸå®›å…ˆæƒ…å ±ã«åŸºã¥ã„ã¦ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ã€‚04. istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã®ä»•çµ„ã¿å…¨ä½“åƒEnvoyãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸå®›å…ˆæƒ…å ±ã‚’è¦‹ã¦ã„ãå‰ã«ã€Envoyã®å‡¦ç†ã®æµã‚Œã‚’è§£èª¬ã—ã¾ã™ã€‚istio-proxyã‚³ãƒ³ãƒ†ãƒŠå†…ã®Envoyã§ã¯ã€ä»¥ä¸‹ã®ä»•çµ„ã¿ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã¾ã™ã€‚(1) ã€œ (6) ã®å…¨ä½“åƒã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ğŸ‘‡Istio in Action (English Edition)Istio: Up and Running: Using a Service Mesh to Connect, Secure, Control, and ObserveArchitecture Analysis of Istio: The Most Popular Service Mesh Project - Alibaba Cloud Community(1) é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã€é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã¾ã™ã€‚(2) Envoyã«ã‚ˆã‚‹ãƒªã‚¹ãƒŠãƒ¼é¸æŠEnvoyã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆæƒ…å ± (ä¾‹ï¼šå®›å…ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒãƒ¼ãƒˆç•ªå·ã€ãƒ‘ã‚¹ã€ãƒ›ã‚¹ãƒˆãªã©) ã«å¿œã˜ã¦ãƒªã‚¹ãƒŠãƒ¼ã‚’é¸ã³ã¾ã™ã€‚(3) Envoyã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒˆé¸æŠEnvoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã«ç´ã¥ããƒ«ãƒ¼ãƒˆã‚’é¸ã³ã¾ã™ã€‚â–¶ TCPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«ã¤ã„ã¦Debugging Your Debugging Tools: What to do When Your Service Mesh Goes Down | PPT(4) Envoyã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠEnvoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ç´ã¥ãã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’é¸ã³ã¾ã™ã€‚(5) Envoyã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé¸æŠEnvoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ç´ã¥ãã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é¸ã³ã¾ã™ã€‚(6) å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚Envoyã§ç¢ºèªã—ãŸå®›å…ˆæƒ…å ±ã‚’ğŸ‘†ã«å½“ã¦ã¯ã‚ã¦è¦‹ã¦ã„ãã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚EnvoyãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸå®›å…ˆæƒ…å ±ã‚’è¦‹ã¦ã¿ã‚ˆã†config_dumpã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿéš›ã«Envoyã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å®›å…ˆæƒ…å ±ã¯ã€istio-proxyã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã®localhost:15000/config_dumpã‹ã‚‰JSONå½¢å¼ã§å–å¾—ã§ãã¾ã™ã€‚ã‚‚ã—ãŠæ‰‹å…ƒã«IstioãŒã‚ã‚‹å ´åˆã¯ã€Envoyã«ã©ã‚“ãªå®›å…ˆæƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ã€Envoyã‚’å†’é™ºã—ã¦ã¿ã¦ãã ã•ã„ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump\" | yq -Pâ–¶ å®›å…ˆæƒ…å ±ã‚’è¦‹ã‚„ã™ãã™ã‚‹yqã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦yqã‚³ãƒãƒ³ãƒ‰ã§YAMLã«å¤‰æ›ã™ã‚‹ã¨è¦‹ã‚„ã™ããªã‚Šã¾ã™ğŸ‘ãƒªã‚¹ãƒŠãƒ¼â–¼ ç¢ºèªæ–¹æ³•istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸãƒªã‚¹ãƒŠãƒ¼ã¯ã€/config_dump?resource={dynamic_listeners}ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€foo-podå†…ã§bar-podã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ç¢ºèªã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_listeners}\" | yq -Pâ–¼ çµæœä»¥ä¸‹ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚å®›å…ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„å®›å…ˆãƒãƒ¼ãƒˆç•ªå·ã«å¿œã˜ã¦ãƒªã‚¹ãƒŠãƒ¼ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ã“ã“ã§ã¯\u003cä»»æ„ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\u003e:50002ã€‚ãƒªã‚¹ãƒŠãƒ¼ã«ç´ã¥ããƒ«ãƒ¼ãƒˆã®åå‰configs:  - \"@type\": type.googleapis.com/envoy.admin.v3.ListenersConfigDump.DynamicListener    # ãƒªã‚¹ãƒŠãƒ¼å    name: 0.0.0.0_50002    active_state:      version_info: 2022-11-24T12:13:05Z/468      listener:        \"@type\": type.googleapis.com/envoy.config.listener.v3.Listener        name: 0.0.0.0_50002        address:          socket_address:            # å—ä¿¡ã—ãŸãƒ‘ã‚±ãƒƒãƒˆã®ã†ã¡ã§ã€å®›å…ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°            address: 0.0.0.0            # å—ä¿¡ã—ãŸãƒ‘ã‚±ãƒƒãƒˆã®ã†ã¡ã§ã€å®›å…ˆãƒãƒ¼ãƒˆç•ªå·ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°            port_value: 50002        filter_chains:          - filter_chain_match:              transport_protocol: raw_buffer              application_protocols:                - http/1.1                - h2c            filters:              - name: envoy.filters.network.http_connection_manager                typed_config:                  \"@type\": type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager                  stat_prefix: outbound_0.0.0.0_50001                  rds:                    config_source:                      ads: {}                      initial_fetch_timeout: 0s                      resource_api_version: V3                    # æœ¬ãƒªã‚¹ãƒŠãƒ¼ã«ç´ã¥ããƒ«ãƒ¼ãƒˆã®åå‰                    route_config_name: 50002  ...  - \"@type\": type.googleapis.com/envoy.admin.v3.ListenersConfigDump.DynamicListener  ...Administration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationãƒ«ãƒ¼ãƒˆâ–¼ ç¢ºèªæ–¹æ³•istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸãƒªã‚¹ãƒŠãƒ¼ã¯ã€/config_dump?resource={dynamic_route_configs}ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€foo-podå†…ã§bar-podã®ãƒ«ãƒ¼ãƒˆã‚’ç¢ºèªã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_route_configs}\" | yq -Pâ–¼ çµæœã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨YAMLã‚’å–å¾—ã§ãã€ä»¥ä¸‹ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚ãƒªã‚¹ãƒŠãƒ¼ã‚’å–å¾—ã—ãŸæ™‚ã«ç¢ºèªã§ããŸãƒ«ãƒ¼ãƒˆã®åå‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ã‚¹ã‚„Hostãƒ˜ãƒƒãƒ€ãƒ¼ã«å¿œã˜ã¦ãƒ«ãƒ¼ãƒˆã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ãƒ«ãƒ¼ãƒˆã«ç´ã¥ãã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åå‰configs:  - \"@type\": type.googleapis.com/envoy.admin.v3.RoutesConfigDump.DynamicRouteConfig    version_info: 2022-11-24T12:13:05Z/468    route_config:      \"@type\": type.googleapis.com/envoy.config.route.v3.RouteConfiguration      # ãƒ«ãƒ¼ãƒˆã®åå‰      name: 50002      virtual_hosts:        - name: bar-service.bar-namespace.svc.cluster.local:50002          # ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°          domains:            - bar-service.bar-namespace.svc.cluster.local            - bar-service.bar-namespace.svc.cluster.local:50002            - bar-service            - bar-service:50002            - bar-service.bar-namespace.svc            - bar-service.bar-namespace.svc:50002            - bar-service.bar-namespace            - bar-service.bar-namespace:50002            - 172.16.0.2            - 172.16.0.2:50002          routes:            - match:                # ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°                prefix: /              route:                # æœ¬ãƒ«ãƒ¼ãƒˆã«ç´ã¥ãã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åå‰                cluster: outbound|50002|v1|bar-service.bar-namespace.svc.cluster.local                timeout: 0s                retry_policy:                  retry_on: connect-failure,refused-stream,unavailable,cancelled,retriable-status-codes                  num_retries: 2                  retry_host_predicate:                    - name: envoy.retry_host_predicates.previous_hosts                  host_selection_retry_max_attempts: \"5\"                  retriable_status_codes:                    - 503                max_stream_duration:                  max_stream_duration: 0s                  grpc_timeout_header_max: 0s              decorator:                operation: bar-service.bar-namespace.svc.cluster.local:50002/*  ...  - '@type': type.googleapis.com/envoy.admin.v3.RoutesConfigDump.DynamicRouteConfig  ...Administration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼â–¼ ç¢ºèªæ–¹æ³•istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯ã€/config_dump?resource={dynamic_active_clusters}ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€foo-podå†…ã§bar-podã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ç¢ºèªã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?resource={dynamic_active_clusters}\" | yq -Pâ–¼ çµæœã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨YAMLã‚’å–å¾—ã§ãã€ä»¥ä¸‹ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚ãƒ«ãƒ¼ãƒˆã‚’å–å¾—ã—ãŸæ™‚ã«ç¢ºèªã§ããŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åå‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ç´ã¥ãã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¦ªåconfigs:  - \"@type\": type.googleapis.com/envoy.admin.v3.ClustersConfigDump.DynamicCluster    version_info: 2022-11-24T12:13:05Z/468    cluster:      \"@type\": type.googleapis.com/envoy.config.cluster.v3.Cluster      # ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åå‰      name: outbound|50002|v1|bar-service.bar-namespace.svc.cluster.local      type: EDS      eds_cluster_config:        eds_config:          ads: {}          initial_fetch_timeout: 0s          resource_api_version: V3        # æœ¬ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ç´ã¥ãã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¦ªå        service_name: outbound|50002|v1|bar-service.bar-namespace.svc.cluster.local  ...  - \"@type\": type.googleapis.com/envoy.admin.v3.ClustersConfigDump.DynamicCluster  ...Administration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆâ–¼ ç¢ºèªæ–¹æ³•istio-proxyã‚³ãƒ³ãƒ†ãƒŠãŒADS-APIã‹ã‚‰å–å¾—ã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯ã€/config_dump?include_edsã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€foo-podå†…ã§bar-podã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ç¢ºèªã—ãŸã¨ä»®å®šã—ã¾ã™ã€‚$ kubectl exec \\    -it foo-pod \\    -n foo-namespace \\    -c istio-proxy \\    -- bash -c \"curl http://localhost:15000/config_dump?include_eds\" | yq -Pâ–¼ çµæœã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨YAMLã‚’å–å¾—ã§ãã€ä»¥ä¸‹ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å–å¾—ã—ãŸæ™‚ã«ç¢ºèªã§ããŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¦ªåbar-podã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒ3å€‹ã‚ã‚‹ãŸã‚ã€3å€‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™configs:  dynamic_endpoint_configs:    - endpoint_config:        \"@type\": type.googleapis.com/envoy.config.endpoint.v3.ClusterLoadAssignment        # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¦ªå        cluster_name: outbound|50002|v1|bar-service.bar-namespace.svc.cluster.local        endpoints:          - locality:              region: ap-northeast-1              zone: ap-northeast-1a            lb_endpoints:              - endpoint:                  address:                    socket_address:                      # å†—é•·åŒ–ã•ã‚ŒãŸbar-podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹                      address: 11.0.0.1                      # bar-podå†…ã®ã‚³ãƒ³ãƒ†ãƒŠãŒå¾…ã¡å—ã‘ã¦ã„ã‚‹ãƒãƒ¼ãƒˆç•ªå·                      port_value: 50002                  health_check_config: {}                health_status: HEALTHY                metadata:                  filter_metadata:                    istio:                      workload: bar                    envoy.transport_socket_match:                      tlsMode: istio                # ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ±ºã‚ã‚‹æ•°å€¤                load_balancing_weight: 1          - locality:              region: ap-northeast-1              zone: ap-northeast-1d            lb_endpoints:              - endpoint:                  address:                    socket_address:                      # å†—é•·åŒ–ã•ã‚ŒãŸbar-podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹                      address: 11.0.0.2                      # bar-podå†…ã®ã‚³ãƒ³ãƒ†ãƒŠãŒå¾…ã¡å—ã‘ã¦ã„ã‚‹ãƒãƒ¼ãƒˆç•ªå·                      port_value: 50002                  health_check_config: {}                health_status: HEALTHY                metadata:                  filter_metadata:                    istio:                      workload: bar                    envoy.transport_socket_match:                      tlsMode: istio                # ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ±ºã‚ã‚‹æ•°å€¤                load_balancing_weight: 1          - locality:              region: ap-northeast-1              zone: ap-northeast-1d            lb_endpoints:              - endpoint:                  address:                    socket_address:                      # å†—é•·åŒ–ã•ã‚ŒãŸbar-podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹                      address: 11.0.0.3                      # bar-podå†…ã®ã‚³ãƒ³ãƒ†ãƒŠãŒå¾…ã¡å—ã‘ã¦ã„ã‚‹ãƒãƒ¼ãƒˆç•ªå·                      port_value: 50002                  health_check_config: {}                health_status: HEALTHY                metadata:                  filter_metadata:                    istio:                      workload: bar                    envoy.transport_socket_match:                      tlsMode: istio                # ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ±ºã‚ã‚‹æ•°å€¤                load_balancing_weight: 1        policy:          overprovisioning_factor: 140    ...    - endpoint_config:    ...Administration interface â€” envoy 1.32.0-dev-c091ca documentationConfigDump (proto) â€” envoy 1.32.0-dev-c091ca documentationâ–¶ Envoyã®è² è·åˆ†æ•£æ–¹å¼ã«ã¤ã„ã¦load_balancing_weightã‚­ãƒ¼å€¤ãŒç­‰ã—ã„å ´åˆã€Envoyã¯P2Cã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«åŸºã¥ã„ã¦ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã—ã¾ã™ğŸ‘Envoyã®å‡¦ç†ã®æµã‚Œã®ã¾ã¨ã‚ç¢ºèªã§ããŸå®›å…ˆæƒ…å ±ã‚’ã€Envoyã®å‡¦ç†ã®æµã‚Œã«å½“ã¦ã¯ã‚ã¦ã¿ã¾ã—ãŸã€‚(1) é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡é€ä¿¡å…ƒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ (\u003cä»»æ„ã®IP\u003e/:50002) ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã®istio-proxyã‚³ãƒ³ãƒ†ãƒŠã¯ã“ã‚Œã‚’å—ä¿¡ã—ã¾ã™ã€‚(2) Envoyã«ã‚ˆã‚‹ãƒªã‚¹ãƒŠãƒ¼é¸æŠEnvoyã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®›å…ˆ (IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒãƒ¼ãƒˆç•ªå·ã€ãƒ‘ã‚¹) ã‹ã‚‰Podã®ãƒªã‚¹ãƒŠãƒ¼ (0.0.0.0_50002) ã‚’é¸ã³ã¾ã™ã€‚(3) Envoyã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒˆé¸æŠEnvoyã¯ã€ãƒªã‚¹ãƒŠãƒ¼ã«ç´ã¥ãPodã®ãƒ«ãƒ¼ãƒˆ (50002) ã‚’é¸ã³ã¾ã™ã€‚(4) Envoyã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠEnvoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ç´ã¥ãPodã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ (outbound|50002|v1|bar-service.bar-namespace.svc.cluster.local) ã‚’é¸ã³ã¾ã™ã€‚(5) Envoyã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠEnvoyã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ç´ã¥ãPodã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (11.0.0.X/:50002) ã‚’é¸ã³ã¾ã™ã€‚(6) å®›å…ˆãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡Envoyã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®›å…ˆã«Podã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®å†’é™ºã¯ä»¥ä¸Šã§ã™â›µ05. ãŠã‚ã‚Šã«Istioã®æ©Ÿèƒ½ã®1ã¤ã§ã‚ã‚‹ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã€ã®ä»•çµ„ã¿ã‚’ã€Envoyã‚’äº¤ãˆãªãŒã‚‰ã‚‚ã‚Šã‚‚ã‚Šå¸ƒæ•™ã—ã¾ã—ãŸã€‚æ„›ãŒæº¢ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚Istioã®æ©Ÿèƒ½ã‚’1ã¤ã¨ã£ã¦ã‚‚ã€è¤‡é›‘ãªä»•çµ„ã¿ã§å®Ÿç¾ã—ã¦ã„ã‚‹ã“ã¨ãŒãŠåˆ†ã‹ã‚Šã„ãŸã ã‘ãŸã‹ã¨æ€ã„ã¾ã™ã€‚Istioã‚ã‚ŠãŒã¨ã†ğŸ™ğŸ™ğŸ™è¬è¾3-shake SRE Tech Talk ã§ã®ç™ºè¡¨å‰å¾Œã«ã€ä»¥ä¸‹ã®æ–¹ã€…ã«ç™ºè¡¨å†…å®¹ã«ã¤ã„ã¦åŠ©è¨€ã‚’ã„ãŸã ãã¾ã—ãŸã€‚@ido_kara_deru ã•ã‚“@yosshi_ ã•ã‚“@yteraoka ã•ã‚“(ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †)ã¾ãŸã€ä»Šå›ã® 3-shake Advent Calender 2022 ã¯ã€ä»¥ä¸‹ã®æ–¹ã€…ã«ä¼ç”»ã„ãŸã ãã¾ã—ãŸã€‚@jigyakkuma_ ã•ã‚“@nwiizo ã•ã‚“(ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †)çš†æ§˜ã«æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ğŸ™‡ğŸ»â€è¨˜äº‹é–¢é€£ã®ãŠã™ã™ã‚æ›¸ç±Istio in Action (English Edition)ä½œè€…:Posta, Christian E.,Maloku, RinorManningAmazonIstio: Up and Running: Using a Service Mesh to Connect, Secure, Control, and Observeä½œè€…:Calcote, Lee,Butcher, ZackO'ReillyAmazon","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2022/12/25/060000","isoDate":"2022-12-24T21:00:00.000Z","dateMiliSeconds":1671915600000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"â›µï¸ Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿","contentSnippet":"ã€3-shake SRE Tech Talkã€ã®ç™»å£‡è³‡æ–™ã§ã™\r\rIstioã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã€Envoyã‚’äº¤ãˆãªãŒã‚‰è§£èª¬ã—ã¾ã—ãŸã€‚\r\rã‚¹ãƒ©ã‚¤ãƒ‰ã§ã¯ä»•çµ„ã¿ã®è©³ç´°ã‚’è§£èª¬ã§ãã¾ã›ã‚“ã§ã—ãŸã®ã§ã€ãœã²å…ƒè¨˜äº‹ (Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿) ã‚‚å‚ç…§ãã ã•ã„ğŸ‘\r\rğŸ¦ ãƒ„ã‚¤ãƒ¼ãƒˆï¼šhttps://x.com/Hiroki__IT/status/1603344099368570880","link":"https://speakerdeck.com/hiroki_hasegawa/istioniyorusahisuteisukaharinoshi-zu-mi","isoDate":"2022-12-15T05:00:00.000Z","dateMiliSeconds":1671080400000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ã€Istioâ›µï¸ã€‘\"3-shake SRE Tech Talk\" ã«ç™»å£‡","contentSnippet":"ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã‚’ \"å®Œå…¨ã«ç†è§£\" ã§ãã¾ã™âœŒï¸Istioã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥è­˜ã‚¤ãƒ™ãƒ³ãƒˆåç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆåã‚ªãƒƒã‚¹ï¼ã‚ªãƒ©é•·è°·å·ï¼âœ‹ğŸ»ã€Istioã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ã®ä»•çµ„ã¿ã€ã¦ã„ã†ãƒ†ãƒ¼ãƒã§ã€ 3-shake SRE Tech Talk ã«ç™»å£‡ã—ãŸãï¼ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ã¿ã‚“ãªï¼ã‚¹ãƒ©ã‚¤ãƒ‰ãœã£ã¦ã‡è¦‹ã¦ãã‚Œã‚ˆãªï¼æœ¬æ—¥ã®ç™ºè¡¨è³‡æ–™ã§ã™ï¼â›µï¸#SRETThttps://t.co/0MKMYVa77uâ€” é•·è°·å· åºƒæ¨¹ (åœ°ä¸‹å¼·åˆ¶åŠ´åƒè€…) (@Hiroki__IT) December 15, 2022 ã¡ãªã€ç™ºè¡¨å†…å®¹ã®è©³ç´°ã¯ã“ã®è¨˜äº‹ã‚’ã¿ã¦ãã‚Œã‚ˆãªï¼","link":"https://hiroki-hasegawa.hatenablog.jp/entry/2022/12/15/025523","isoDate":"2022-12-15T03:00:00.000Z","dateMiliSeconds":1671073200000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ” å¯è¦³æ¸¬æ€§ã«å…¥é–€ã—ã‚ˆã†","contentSnippet":"ç¤¾å†…LTã«ã¦ã€å¯è¦³æ¸¬æ€§ã‚’å¸ƒæ•™ã—ã‚ˆã†ã¨è©¦ã¿ã¾ã—ãŸÊ•â—”Ï–â—”Ê”\r\ré–¢é€£ãƒ†ãƒ¼ãƒï¼ˆSREã«å…¥é–€ã—ã‚ˆã†ï¼‰ï¼š\rhttps://speakerdeck.com/hiroki_hasegawa/sreniru-men-siyou","link":"https://speakerdeck.com/hiroki_hasegawa/ke-guan-ce-xing-niru-men-siyou","isoDate":"2021-10-22T04:00:00.000Z","dateMiliSeconds":1634875200000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ—ï¸ ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã¨ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡","contentSnippet":"ç¤¾å†…LTã«ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã¨ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ã‚’å¸ƒæ•™ã—ã¾ã—ãŸÊ•â—”Ï–â—”Ê”\r\rã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚‚ã©ã†ãï¼\r\rãªãŠã€ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã¯ã€ä¾å­˜ã«ã¤ã„ã¦ã‚‚çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\ræ˜¯éã€ä¾å­˜é–¢ä¿‚ã¨ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ã‚‚ã”å‚ç…§ãã ã•ã„ğŸ‘ğŸ»","link":"https://speakerdeck.com/hiroki_hasegawa/domeinqu-dong-she-ji-toyi-cun-xing-ni-zhuan-falseyuan-ze","isoDate":"2021-08-06T04:00:00.000Z","dateMiliSeconds":1628222400000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ¤ğŸ» ä¾å­˜é–¢ä¿‚ã¨ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥","contentSnippet":"ç¤¾å†…LTã«ã¦ã€ä¾å­˜é–¢ä¿‚ã¨ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ã‚’å¸ƒæ•™ã—ã‚ˆã†ã¨è©¦ã¿ã¾ã—ãŸÊ•â—”Ï–â—”Ê”\r\ré–¢é€£ãƒ†ãƒ¼ãƒï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã¨ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼‰ï¼š\rhttps://speakerdeck.com/hiroki_hasegawa/domeinqu-dong-she-ji-toyi-cun-xing-ni-zhuan-falseyuan-ze","link":"https://speakerdeck.com/hiroki_hasegawa/yi-cun-guan-xi-toyi-cun-obuziekutozhu-ru","isoDate":"2021-06-25T04:00:00.000Z","dateMiliSeconds":1624593600000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ­ Goã«å…¥é–€ã—ã‚ˆã†","contentSnippet":"ç¤¾å†…LTã«ã¦ã€Goã‚’å¸ƒæ•™ã—ã‚ˆã†ã¨è©¦ã¿ã¾ã—ãŸÊ•â—”Ï–â—”Ê”","link":"https://speakerdeck.com/hiroki_hasegawa/goniru-men-siyou","isoDate":"2021-05-27T04:00:00.000Z","dateMiliSeconds":1622088000000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"â™¾ï¸ SREã«å…¥é–€ã—ã‚ˆã†","contentSnippet":"ç¤¾å†…LTã«ã¦ã€SREç”¨èªã‚’å¸ƒæ•™ã—ã‚ˆã†ã¨è©¦ã¿ã¾ã—ãŸÊ•â—”Ï–â—”Ê”","link":"https://speakerdeck.com/hiroki_hasegawa/sreniru-men-siyou","isoDate":"2021-05-07T04:00:00.000Z","dateMiliSeconds":1620360000000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"},{"title":"ğŸ­ Lambdaé–¢æ•°ã‚’Goã§å®Ÿè£…ã—ã¦ã¿ãŸè©±","contentSnippet":"ç¤¾å†…LTã«ã¦ã€Goã‚’å¸ƒæ•™ã—ã‚ˆã†ã¨è©¦ã¿ã¾ã—ãŸÊ•â—”Ï–â—”Ê”","link":"https://speakerdeck.com/hiroki_hasegawa/lambdaguan-shu-wogodeshi-zhuang-sitemitahua","isoDate":"2021-03-26T04:00:00.000Z","dateMiliSeconds":1616731200000,"authorName":"é•·è°·å· åºƒæ¨¹","authorId":"hiroki-hasegawa"}]},"__N_SSG":true},"page":"/members/[id]","query":{"id":"hiroki-hasegawa"},"buildId":"3JhdoGcpT3YqpAgsKOghX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>